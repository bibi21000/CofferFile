<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 15.0.1"/>
    <title>cofferfile API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:.75rem center;margin-bottom:1rem;}.pdoc .alert > em{display:none;}.pdoc .alert > *:last-child{margin-bottom:0;}.pdoc .alert.note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .alert.warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .alert.danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .decorator-deprecated{color:#842029;}.pdoc .decorator-deprecated ~ span{filter:grayscale(1) opacity(0.8);}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>

            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>

            <h2>Contents</h2>
            <ul>
  <li><a href="#cofferfile">CofferFile</a></li>
</ul>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#EncryptFile">EncryptFile</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#EncryptFile.__init__">EncryptFile</a>
                        </li>
                        <li>
                                <a class="variable" href="#EncryptFile.myfileobj">myfileobj</a>
                        </li>
                        <li>
                                <a class="variable" href="#EncryptFile.chunk_size">chunk_size</a>
                        </li>
                        <li>
                                <a class="variable" href="#EncryptFile.fileobj">fileobj</a>
                        </li>
                        <li>
                                <a class="function" href="#EncryptFile.cryptor_factory">cryptor_factory</a>
                        </li>
                        <li>
                                <a class="function" href="#EncryptFile.tell">tell</a>
                        </li>
                        <li>
                                <a class="function" href="#EncryptFile.write">write</a>
                        </li>
                        <li>
                                <a class="function" href="#EncryptFile.read">read</a>
                        </li>
                        <li>
                                <a class="function" href="#EncryptFile.read1">read1</a>
                        </li>
                        <li>
                                <a class="function" href="#EncryptFile.peek">peek</a>
                        </li>
                        <li>
                                <a class="variable" href="#EncryptFile.closed">closed</a>
                        </li>
                        <li>
                                <a class="function" href="#EncryptFile.close">close</a>
                        </li>
                        <li>
                                <a class="function" href="#EncryptFile.flush">flush</a>
                        </li>
                        <li>
                                <a class="function" href="#EncryptFile.fileno">fileno</a>
                        </li>
                        <li>
                                <a class="function" href="#EncryptFile.rewind">rewind</a>
                        </li>
                        <li>
                                <a class="function" href="#EncryptFile.readable">readable</a>
                        </li>
                        <li>
                                <a class="function" href="#EncryptFile.writable">writable</a>
                        </li>
                        <li>
                                <a class="function" href="#EncryptFile.seekable">seekable</a>
                        </li>
                        <li>
                                <a class="function" href="#EncryptFile.seek">seek</a>
                        </li>
                        <li>
                                <a class="function" href="#EncryptFile.readline">readline</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Cryptor">Cryptor</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Cryptor.__init__">Cryptor</a>
                        </li>
                        <li>
                                <a class="variable" href="#Cryptor.chunk_size">chunk_size</a>
                        </li>
                        <li>
                                <a class="variable" href="#Cryptor.eof">eof</a>
                        </li>
                        <li>
                                <a class="variable" href="#Cryptor.needs_input">needs_input</a>
                        </li>
                        <li>
                                <a class="variable" href="#Cryptor.unused_data">unused_data</a>
                        </li>
                        <li>
                                <a class="variable" href="#Cryptor.unsent_data">unsent_data</a>
                        </li>
                        <li>
                                <a class="variable" href="#Cryptor.pos">pos</a>
                        </li>
                        <li>
                                <a class="function" href="#Cryptor.encode_meta">encode_meta</a>
                        </li>
                        <li>
                                <a class="function" href="#Cryptor.decode_meta">decode_meta</a>
                        </li>
                        <li>
                                <a class="function" href="#Cryptor.crypt">crypt</a>
                        </li>
                        <li>
                                <a class="function" href="#Cryptor.flush">flush</a>
                        </li>
                        <li>
                                <a class="function" href="#Cryptor.decrypt">decrypt</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="function" href="#_open_t">_open_t</a>
            </li>
            <li>
                    <a class="function" href="#_open_cls">_open_cls</a>
            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
cofferfile    </h1>

                        <div class="docstring"><p><a href="https://codecov.io/gh/bibi21000/CofferFile"><img src="https://codecov.io/gh/bibi21000/CofferFile/graph/badge.svg?token=4124GIOJAK" alt="codecov" /></a>
<img src="https://img.shields.io/pypi/dm/cofferfile" alt="PyPI - Downloads" /></p>

<h1 id="cofferfile">CofferFile</h1>

<p>A python xxxFile like (ie TarFile, GzipFile, BZ2File, pyzstd.ZstdFile, ...)
for encrypting files with Fernet, Nacl, ...</p>

<ul>
<li>encrypting / decrypting data using chunks to reduce memory footprint</li>
<li>chainable with other python xxxFile interfaces (stream mode)</li>
<li>interface to compress/encrypt and decrypt/decompress (with pyzstd) in stream mode</li>
<li>look at BENCHMARK.md ... and chain :)</li>
<li>look at tests for examples</li>
</ul>

<p>This is the main library.
Look at <a href="https://github.com/bibi21000/NaclFile">https://github.com/bibi21000/NaclFile</a> and <a href="https://github.com/bibi21000/FernetFile">https://github.com/bibi21000/FernetFile</a>.</p>

<p>Look at documentation : <a href="https://bibi21000.github.io/CofferFile">https://bibi21000.github.io/CofferFile</a>.</p>
</div>

                        <input id="mod-cofferfile-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-cofferfile-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="c1"># -*- encoding: utf-8 -*-</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a><span class="sd">.. include:: ../README.md</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a><span class="sd">   :start-line: 1</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a><span class="n">__author__</span> <span class="o">=</span> <span class="s1">&#39;bibi21000 aka SÃ©bastien GALLET&#39;</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a><span class="n">__email__</span> <span class="o">=</span> <span class="s1">&#39;bibi21000@gmail.com&#39;</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">struct</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">builtins</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">io</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a><span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a>    <span class="kn">from</span><span class="w"> </span><span class="nn">importlib_metadata</span><span class="w"> </span><span class="kn">import</span> <span class="n">entry_points</span>  <span class="c1"># noqa</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a><span class="k">else</span><span class="p">:</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a>    <span class="kn">from</span><span class="w"> </span><span class="nn">importlib.metadata</span><span class="w"> </span><span class="kn">import</span> <span class="n">entry_points</span>  <span class="c1"># noqa</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a><span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;EncryptFile&quot;</span><span class="p">,</span> <span class="s2">&quot;Cryptor&quot;</span><span class="p">,</span> <span class="s2">&quot;_open_t&quot;</span><span class="p">,</span> <span class="s2">&quot;_open_cls&quot;</span><span class="p">]</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a><span class="n">READ</span> <span class="o">=</span> <span class="s1">&#39;rb&#39;</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a><span class="n">WRITE</span> <span class="o">=</span> <span class="s1">&#39;wb&#39;</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a><span class="n">APPEND</span> <span class="o">=</span> <span class="s1">&#39;ab&#39;</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a><span class="n">EXCLUSIVE</span> <span class="o">=</span> <span class="s1">&#39;xb&#39;</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a><span class="c1"># Changing these constants will break current format !!!</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a><span class="c1"># what size for meta information ?</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a><span class="c1"># For example, AES GCM nonce, with a length of 12 bytes</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a><span class="c1"># and 4 bytes for chunck length</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a><span class="c1"># 32 bytes seem a reasonable value</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a><span class="n">META_CHUNK</span> <span class="o">=</span> <span class="mi">4</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a><span class="n">META_RESERV</span> <span class="o">=</span> <span class="mi">7</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a><span class="n">META_SIZE</span> <span class="o">=</span> <span class="n">META_RESERV</span> <span class="o">*</span> <span class="n">META_CHUNK</span> <span class="o">+</span> <span class="n">META_CHUNK</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a><span class="c1"># These one are default for class instanciation</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a><span class="n">BUFFER_SIZE</span> <span class="o">=</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">64</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a><span class="n">CHUNK_SIZE</span> <span class="o">=</span> <span class="n">BUFFER_SIZE</span> <span class="o">-</span> <span class="n">META_SIZE</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a><span class="n">WRITE_BUFFER_SIZE</span> <span class="o">=</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">BUFFER_SIZE</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a><span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;fernetfile&#39;</span><span class="p">)</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a><span class="k">class</span><span class="w"> </span><span class="nc">BaseStream</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">BufferedIOBase</span><span class="p">):</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Mode-checking helper functions.&quot;&quot;&quot;</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_check_not_closed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">closed</span><span class="p">:</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;I/O operation on closed file&quot;</span><span class="p">)</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_check_can_read</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">readable</span><span class="p">():</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a>            <span class="k">raise</span> <span class="n">io</span><span class="o">.</span><span class="n">UnsupportedOperation</span><span class="p">(</span><span class="s2">&quot;File not open for reading&quot;</span><span class="p">)</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_check_can_write</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">writable</span><span class="p">():</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a>            <span class="k">raise</span> <span class="n">io</span><span class="o">.</span><span class="n">UnsupportedOperation</span><span class="p">(</span><span class="s2">&quot;File not open for writing&quot;</span><span class="p">)</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a>    <span class="c1"># ~ def _check_can_seek(self):</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a>        <span class="c1"># ~ if not self.readable():</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a>            <span class="c1"># ~ raise io.UnsupportedOperation(&quot;Seeking is only supported &quot;</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a>              <span class="c1"># ~ &quot;on files open for reading&quot;)</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a>        <span class="c1"># ~ if not self.seekable():</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a>            <span class="c1"># ~ raise io.UnsupportedOperation(&quot;The underlying file object &quot;</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a>              <span class="c1"># ~ &quot;does not support seeking&quot;)</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a><span class="k">class</span><span class="w"> </span><span class="nc">DecryptReader</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">BufferedIOBase</span><span class="p">):</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Adapts the decryptor API to a RawIOBase reader API&quot;&quot;&quot;</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">decrypt_factory</span><span class="p">,</span> <span class="n">buffer_size</span><span class="o">=</span><span class="n">BUFFER_SIZE</span><span class="p">,</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a>            <span class="n">trailing_error</span><span class="o">=</span><span class="p">(),</span> <span class="o">**</span><span class="n">decrypt_args</span><span class="p">):</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_fp</span> <span class="o">=</span> <span class="n">fp</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">buffer_size</span> <span class="o">=</span> <span class="n">buffer_size</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_eof</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pos</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Current offset in decrypted stream</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a>        <span class="c1"># Set to size of decrypted stream once it is known, for SEEK_END</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_size</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a>        <span class="c1"># Save the decryptor factory and arguments.</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a>        <span class="c1"># If the file contains multiple compressed streams, each</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a>        <span class="c1"># stream will need a separate decryptor object. A new decryptor</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a>        <span class="c1"># object is also needed when implementing a backwards seek().</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_decrypt_factory</span> <span class="o">=</span> <span class="n">decrypt_factory</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_decrypt_args</span> <span class="o">=</span> <span class="n">decrypt_args</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_decryptor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_decrypt_factory</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_decrypt_args</span><span class="p">)</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a>        <span class="c1"># Exception class to catch from decryptor signifying invalid</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a>        <span class="c1"># trailing data to ignore</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_trailing_error</span> <span class="o">=</span> <span class="n">trailing_error</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_marks</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a>        <span class="c1"># ~ self._old_data = None</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_decryptor</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a>        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">seekable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fp</span><span class="o">.</span><span class="n">seekable</span><span class="p">()</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">readable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fp</span><span class="o">.</span><span class="n">readable</span><span class="p">()</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">readinto</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a>        <span class="c1"># ~ print(type(b))</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a>        <span class="k">with</span> <span class="nb">memoryview</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="k">as</span> <span class="n">view</span><span class="p">,</span> <span class="n">view</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">&quot;B&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">byte_view</span><span class="p">:</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">byte_view</span><span class="p">))</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a>            <span class="c1"># ~ if self._old_data == data:</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a>                <span class="c1"># ~ log.warning(&#39;duplicate&#39;)</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a>            <span class="c1"># ~ self._old_data = data</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a>            <span class="c1"># ~ log.debug(&#39;readinto : %s, byte_view size %s mark %s&#39; %</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a>                <span class="c1"># ~ (len(data), len(byte_view), self._marks))</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a>            <span class="c1"># ~ log.debug(&#39;readinto : %s&#39; %(byte_view))</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a>            <span class="n">byte_view</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)]</span> <span class="o">=</span> <span class="n">data</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a>        <span class="k">if</span> <span class="n">size</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">readall</span><span class="p">()</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">size</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eof</span><span class="p">:</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a>            <span class="k">return</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Default if EOF is encountered</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a>        <span class="c1"># Depending on the input data, our call to the decryptor may not</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a>        <span class="c1"># return any data. In this case, try again after reading another block.</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a>        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_decryptor</span><span class="o">.</span><span class="n">eof</span><span class="p">:</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a>                <span class="c1"># ~ log.debug(&#39;here self._decryptor.eof %s&#39;%size)</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a>                <span class="n">rawblock</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_decryptor</span><span class="o">.</span><span class="n">unused_data</span> <span class="ow">or</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_fp</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">buffer_size</span><span class="p">))</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">rawblock</span><span class="p">:</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a>                    <span class="k">break</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a>                <span class="c1"># Continue to next stream.</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_decryptor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_decrypt_factory</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_decrypt_args</span><span class="p">)</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a>                    <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_decryptor</span><span class="o">.</span><span class="n">decrypt</span><span class="p">(</span><span class="n">rawblock</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_marks</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a>                <span class="k">except</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trailing_error</span><span class="p">:</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a>                    <span class="c1"># Trailing data isn&#39;t a valid compressed stream; ignore it.</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_marks</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a>                    <span class="k">break</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a>                <span class="c1"># ~ log.debug(&#39;here %s&#39;%size)</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_decryptor</span><span class="o">.</span><span class="n">needs_input</span><span class="p">:</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a>                    <span class="n">rawblock</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fp</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">buffer_size</span><span class="p">)</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="n">rawblock</span><span class="p">:</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a>                        <span class="k">raise</span> <span class="ne">EOFError</span><span class="p">(</span><span class="s2">&quot;Compressed file ended before the &quot;</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a>                                       <span class="s2">&quot;end-of-stream marker was reached&quot;</span><span class="p">)</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a>                    <span class="n">rawblock</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a>                <span class="c1"># ~ log.debug(&#39;rawblock %s&#39;%len(rawblock))</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a>                <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_decryptor</span><span class="o">.</span><span class="n">decrypt</span><span class="p">(</span><span class="n">rawblock</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_marks</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a>            <span class="c1"># ~ log.debug(&quot;read : data %s, len data %s, unused_data %s, unsent_data %s&quot; %</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a>            <span class="c1"># ~ (type(data), len(data) if data is not None else 0, len(self._decryptor.unused_data) if self._decryptor.unused_data is not None else 0, len(self._decryptor.unsent_data)))</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a>            <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a>                <span class="k">break</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_eof</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pos</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a>            <span class="k">return</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pos</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a>        <span class="c1"># ~ log.debug(&quot;read : data %s, len data %s&quot; % (type(data), len(data)))</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a>        <span class="k">return</span> <span class="n">data</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">readall</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a>        <span class="n">chunks</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a>        <span class="c1"># sys.maxsize means the max length of output buffer is unlimited,</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a>        <span class="c1"># so that the whole input buffer can be decrypted within one</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a>        <span class="c1"># .decrypt() call.</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a>        <span class="k">while</span> <span class="n">data</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">maxsize</span><span class="p">):</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a>            <span class="n">chunks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a>        <span class="k">return</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">chunks</span><span class="p">)</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a>    <span class="c1"># Rewind the file to the beginning of the data stream.</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">rewind</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_fp</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_eof</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pos</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_decryptor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_decrypt_factory</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_decrypt_args</span><span class="p">)</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">seek</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">whence</span><span class="o">=</span><span class="n">io</span><span class="o">.</span><span class="n">SEEK_SET</span><span class="p">):</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a>        <span class="c1"># Recalculate offset as an absolute file position.</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a>        <span class="k">if</span> <span class="n">whence</span> <span class="o">==</span> <span class="n">io</span><span class="o">.</span><span class="n">SEEK_SET</span><span class="p">:</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a>            <span class="k">pass</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a>        <span class="k">elif</span> <span class="n">whence</span> <span class="o">==</span> <span class="n">io</span><span class="o">.</span><span class="n">SEEK_CUR</span><span class="p">:</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a>            <span class="n">offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pos</span> <span class="o">+</span> <span class="n">offset</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a>        <span class="k">elif</span> <span class="n">whence</span> <span class="o">==</span> <span class="n">io</span><span class="o">.</span><span class="n">SEEK_END</span><span class="p">:</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a>            <span class="c1"># Seeking relative to EOF - we need to know the file&#39;s size.</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_size</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a>                <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">DEFAULT_BUFFER_SIZE</span><span class="p">):</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a>                    <span class="k">pass</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a>            <span class="n">offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_size</span> <span class="o">+</span> <span class="n">offset</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid value for whence: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">whence</span><span class="p">))</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a>        <span class="c1"># Make it so that offset is the number of bytes to skip forward.</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a>        <span class="k">if</span> <span class="n">offset</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pos</span><span class="p">:</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">rewind</span><span class="p">()</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a>            <span class="n">offset</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pos</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a>
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a>        <span class="c1"># Read and discard data until we reach the desired position.</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a>        <span class="k">while</span> <span class="n">offset</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">DEFAULT_BUFFER_SIZE</span><span class="p">,</span> <span class="n">offset</span><span class="p">))</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a>                <span class="k">break</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a>            <span class="n">offset</span> <span class="o">-=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a>
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pos</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a>
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">tell</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the current file position.&quot;&quot;&quot;</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pos</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a>
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a>
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a><span class="k">class</span><span class="w"> </span><span class="nc">Cryptor</span><span class="p">():</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chunk_size</span><span class="o">=</span><span class="n">CHUNK_SIZE</span><span class="p">):</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">chunk_size</span> <span class="o">=</span> <span class="n">chunk_size</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_marks</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">eof</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">needs_input</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">unused_data</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">unsent_data</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a>        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Cryptor initialized&quot;</span><span class="p">)</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a>
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_encrypt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chunk</span><span class="p">):</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a>        <span class="k">return</span> <span class="n">chunk</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a>
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">encode_meta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chunk_size</span><span class="p">):</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a>        <span class="s2">&quot;always return 32 (META_SIZE) bytes string&quot;</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a>        <span class="n">ret</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a>        <span class="n">ret</span> <span class="o">+=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&lt;I&#39;</span><span class="p">,</span> <span class="n">chunk_size</span><span class="p">)</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a>        <span class="c1"># We add blank data for later</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">META_RESERV</span><span class="p">):</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a>            <span class="n">ret</span> <span class="o">+=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&lt;I&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a>        <span class="k">return</span> <span class="n">ret</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a>
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">decode_meta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a>        <span class="s2">&quot;Only accept 0 or 32 (META_SIZE) bytes string&quot;</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a>        <span class="n">meta</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:</span><span class="n">META_SIZE</span><span class="p">]</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a>        <span class="n">size_chunk</span> <span class="o">=</span> <span class="n">meta</span><span class="p">[:</span><span class="n">META_CHUNK</span><span class="p">]</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">size_chunk</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a>            <span class="k">return</span> <span class="mi">0</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos">252</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">meta</span><span class="p">)</span> <span class="o">!=</span> <span class="n">META_SIZE</span><span class="p">:</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos">253</span></a>            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;Meta informations corrupted : </span><span class="si">%s</span><span class="s2"> != </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">meta</span><span class="p">),</span> <span class="n">META_SIZE</span><span class="p">))</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos">254</span></a>        <span class="n">size</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;&lt;I&#39;</span><span class="p">,</span> <span class="n">size_chunk</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos">255</span></a>        <span class="k">return</span> <span class="n">size</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos">256</span></a>
</span><span id="L-257"><a href="#L-257"><span class="linenos">257</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">crypt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos">258</span></a>        <span class="n">ret</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos">259</span></a>        <span class="n">beg</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos">260</span></a>        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos">261</span></a>            <span class="n">chunk</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">beg</span><span class="p">:</span><span class="n">beg</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">chunk_size</span><span class="p">]</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos">262</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos">263</span></a>                <span class="k">break</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos">264</span></a>            <span class="n">enc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_encrypt</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos">265</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_marks</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos">266</span></a>            <span class="c1"># ~ log.debug(&quot;len enc %s, chunk size %s&quot; %</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos">267</span></a>                <span class="c1"># ~ (len(enc), self.chunk_size))</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos">268</span></a>            <span class="n">ret</span> <span class="o">+=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&lt;I&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">enc</span><span class="p">))</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos">269</span></a>            <span class="c1"># ~ # We add blank data for later</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos">270</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">META_RESERV</span><span class="p">):</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos">271</span></a>                <span class="n">ret</span> <span class="o">+=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&lt;I&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos">272</span></a>            <span class="c1"># ~ ret += self.encode_meta(len(enc))</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos">273</span></a>            <span class="n">ret</span> <span class="o">+=</span> <span class="n">enc</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos">274</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">chunk_size</span><span class="p">:</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos">275</span></a>                <span class="k">break</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos">276</span></a>            <span class="n">beg</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chunk_size</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos">277</span></a>
</span><span id="L-278"><a href="#L-278"><span class="linenos">278</span></a>        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;CofferEncryptor.compress : len ret </span><span class="si">%s</span><span class="s2">, chunk size </span><span class="si">%s</span><span class="s2">, marks </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos">279</span></a>            <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ret</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">chunk_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_marks</span><span class="p">))</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos">280</span></a>        <span class="k">return</span> <span class="n">ret</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos">281</span></a>
</span><span id="L-282"><a href="#L-282"><span class="linenos">282</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">flush</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos">283</span></a>        <span class="k">return</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos">284</span></a>
</span><span id="L-285"><a href="#L-285"><span class="linenos">285</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_decrypt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chunk</span><span class="p">):</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos">286</span></a>        <span class="k">return</span> <span class="n">chunk</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos">287</span></a>
</span><span id="L-288"><a href="#L-288"><span class="linenos">288</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">decrypt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">size</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos">289</span></a>        <span class="n">beg</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos">290</span></a>        <span class="n">ret</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos">291</span></a>        <span class="n">size_data</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos">292</span></a>        <span class="c1"># ~ len_data = len(data)</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos">293</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">eof</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos">294</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">needs_input</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos">295</span></a>        <span class="c1"># ~ log.debug(&quot;len data %s dat %s, size %s&quot; % (len(data), data[:15], size))</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos">296</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">unused_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos">297</span></a>            <span class="c1"># ~ log.debug(&quot;len self.unused_data %s&quot; % (len(self.unused_data)))</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos">298</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unused_data</span> <span class="o">+</span> <span class="n">data</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos">299</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">unused_data</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos">300</span></a>        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos">301</span></a>            <span class="c1"># ~ size_data = self.decode_meta(data[beg:])</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos">302</span></a>            <span class="c1"># ~ size_meta = data[beg:beg + META_SIZE]</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos">303</span></a>            <span class="n">size_struct</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">beg</span><span class="p">:</span><span class="n">beg</span> <span class="o">+</span> <span class="n">META_CHUNK</span><span class="p">]</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos">304</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">size_struct</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos">305</span></a>            <span class="c1"># ~ if size_data == 0:</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos">306</span></a>                <span class="c1"># ~ log.debug(&#39;len %s&#39;%len(size_struct))</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos">307</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">needs_input</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos">308</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">eof</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos">309</span></a>                <span class="k">break</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos">310</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">size_struct</span><span class="p">)</span> <span class="o">!=</span> <span class="n">META_CHUNK</span><span class="p">:</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos">311</span></a>                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;Meta informations corrupted : </span><span class="si">%s</span><span class="s2"> != </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">size_struct</span><span class="p">),</span> <span class="n">META_CHUNK</span><span class="p">))</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos">312</span></a>            <span class="n">size_data</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;&lt;I&#39;</span><span class="p">,</span> <span class="n">size_struct</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos">313</span></a>            <span class="c1"># ~ size_data2 = self.decode_meta(data[beg:])</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos">314</span></a>            <span class="c1"># ~ print(size_data, &#39; = &#39;, size_data2)</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos">315</span></a>            <span class="n">chunk</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">beg</span> <span class="o">+</span> <span class="n">META_SIZE</span><span class="p">:</span><span class="n">beg</span> <span class="o">+</span> <span class="n">size_data</span> <span class="o">+</span> <span class="n">META_SIZE</span><span class="p">]</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos">316</span></a>
</span><span id="L-317"><a href="#L-317"><span class="linenos">317</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">size_data</span><span class="p">:</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos">318</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">unused_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">beg</span><span class="p">:]</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos">319</span></a>                <span class="k">break</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos">320</span></a>            <span class="n">ret</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_decrypt</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos">321</span></a>            <span class="n">beg</span> <span class="o">+=</span> <span class="n">size_data</span> <span class="o">+</span> <span class="n">META_SIZE</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos">322</span></a>
</span><span id="L-323"><a href="#L-323"><span class="linenos">323</span></a>        <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unsent_data</span> <span class="o">+</span> <span class="n">ret</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos">324</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eof</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos">325</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">eof</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos">326</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eof</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos">327</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">needs_input</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos">328</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos">329</span></a>        <span class="k">if</span> <span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">size</span><span class="p">:</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos">330</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">unsent_data</span> <span class="o">=</span> <span class="n">ret</span><span class="p">[</span><span class="n">size</span><span class="p">:]</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos">331</span></a>            <span class="n">ret</span> <span class="o">=</span> <span class="n">ret</span><span class="p">[:</span><span class="n">size</span><span class="p">]</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos">332</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos">333</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">unsent_data</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos">334</span></a>        <span class="k">return</span> <span class="n">ret</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos">335</span></a>
</span><span id="L-336"><a href="#L-336"><span class="linenos">336</span></a><span class="k">class</span><span class="w"> </span><span class="nc">_WriteBufferStream</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">RawIOBase</span><span class="p">):</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos">337</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Minimal object to pass WriteBuffer flushes into CofferFile&quot;&quot;&quot;</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos">338</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fernet_file</span><span class="p">):</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos">339</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fernet_file</span> <span class="o">=</span> <span class="n">fernet_file</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos">340</span></a>
</span><span id="L-341"><a href="#L-341"><span class="linenos">341</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos">342</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fernet_file</span><span class="o">.</span><span class="n">_write_raw</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos">343</span></a>
</span><span id="L-344"><a href="#L-344"><span class="linenos">344</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">seekable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos">345</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos">346</span></a>
</span><span id="L-347"><a href="#L-347"><span class="linenos">347</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">writable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos">348</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos">349</span></a>
</span><span id="L-350"><a href="#L-350"><span class="linenos">350</span></a>
</span><span id="L-351"><a href="#L-351"><span class="linenos">351</span></a><span class="k">class</span><span class="w"> </span><span class="nc">EncryptFile</span><span class="p">(</span><span class="n">BaseStream</span><span class="p">):</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos">352</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The CofferFile class simulates most of the methods of a file object with</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos">353</span></a><span class="sd">    the exception of the truncate() method.</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos">354</span></a>
</span><span id="L-355"><a href="#L-355"><span class="linenos">355</span></a><span class="sd">    This class only supports opening files in binary mode.</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos">356</span></a>
</span><span id="L-357"><a href="#L-357"><span class="linenos">357</span></a><span class="sd">    `cofferfile.decorator`</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos">358</span></a><span class="sd">    `cofferfile.aes`</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos">359</span></a>
</span><span id="L-360"><a href="#L-360"><span class="linenos">360</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos">361</span></a>
</span><span id="L-362"><a href="#L-362"><span class="linenos">362</span></a>    <span class="n">myfileobj</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos">363</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot; Overridden with internal file object to be closed, if only a filename</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos">364</span></a><span class="sd">    is passed in &quot;&quot;&quot;</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos">365</span></a>
</span><span id="L-366"><a href="#L-366"><span class="linenos">366</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fileobj</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos">367</span></a>            <span class="n">chunk_size</span><span class="o">=</span><span class="n">CHUNK_SIZE</span><span class="p">,</span> <span class="n">write_buffer_size</span><span class="o">=</span><span class="n">WRITE_BUFFER_SIZE</span><span class="p">,</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos">368</span></a>            <span class="n">cryptor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">cryptor_args</span><span class="p">):</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos">369</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Constructor for the CofferFile class.</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos">370</span></a>
</span><span id="L-371"><a href="#L-371"><span class="linenos">371</span></a><span class="sd">        At least one of fileobj and filename must be given a</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos">372</span></a><span class="sd">        non-trivial value.</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos">373</span></a>
</span><span id="L-374"><a href="#L-374"><span class="linenos">374</span></a><span class="sd">        The new class instance is based on fileobj, which can be a regular</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos">375</span></a><span class="sd">        file, an io.BytesIO object, or any other object which simulates a file.</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos">376</span></a><span class="sd">        It defaults to None, in which case filename is opened to provide</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos">377</span></a><span class="sd">        a file object.</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos">378</span></a>
</span><span id="L-379"><a href="#L-379"><span class="linenos">379</span></a><span class="sd">        When fileobj is not None, the filename argument is only used to be</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos">380</span></a><span class="sd">        included in the gzip file header, which may include the original</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos">381</span></a><span class="sd">        filename of the uncompressed file.  It defaults to the filename of</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos">382</span></a><span class="sd">        fileobj, if discernible; otherwise, it defaults to the empty string,</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos">383</span></a><span class="sd">        and in this case the original filename is not included in the header.</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos">384</span></a>
</span><span id="L-385"><a href="#L-385"><span class="linenos">385</span></a><span class="sd">        The mode argument can be any of &#39;r&#39;, &#39;rb&#39;, &#39;a&#39;, &#39;ab&#39;, &#39;w&#39;, &#39;wb&#39;, &#39;x&#39;, or</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos">386</span></a><span class="sd">        &#39;xb&#39; depending on whether the file will be read or written.  The default</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos">387</span></a><span class="sd">        is the mode of fileobj if discernible; otherwise, the default is &#39;rb&#39;.</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos">388</span></a><span class="sd">        A mode of &#39;r&#39; is equivalent to one of &#39;rb&#39;, and similarly for &#39;w&#39; and</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos">389</span></a><span class="sd">        &#39;wb&#39;, &#39;a&#39; and &#39;ab&#39;, and &#39;x&#39; and &#39;xb&#39;.</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos">390</span></a>
</span><span id="L-391"><a href="#L-391"><span class="linenos">391</span></a><span class="sd">        The fernet_key argument is the Coffer key used to crypt/decrypt data.</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos">392</span></a>
</span><span id="L-393"><a href="#L-393"><span class="linenos">393</span></a><span class="sd">        Encryption is done by chunks to reduce memory footprint. The default</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos">394</span></a><span class="sd">        chunk_size is 64KB.</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos">395</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos">396</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">chunk_size</span> <span class="o">=</span> <span class="n">chunk_size</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos">397</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chunk_size</span> <span class="o">!=</span> <span class="n">CHUNK_SIZE</span> <span class="ow">and</span> <span class="n">write_buffer_size</span> <span class="o">==</span> <span class="n">WRITE_BUFFER_SIZE</span><span class="p">:</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos">398</span></a>            <span class="n">write_buffer_size</span> <span class="o">=</span> <span class="mi">5</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chunk_size</span> <span class="o">+</span> <span class="n">META_SIZE</span><span class="p">)</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos">399</span></a>        <span class="k">if</span> <span class="n">mode</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;t&#39;</span> <span class="ow">in</span> <span class="n">mode</span> <span class="ow">or</span> <span class="s1">&#39;U&#39;</span> <span class="ow">in</span> <span class="n">mode</span><span class="p">):</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos">400</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid mode: </span><span class="si">{!r}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mode</span><span class="p">))</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos">401</span></a>        <span class="k">if</span> <span class="n">mode</span> <span class="ow">and</span> <span class="s1">&#39;b&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">mode</span><span class="p">:</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos">402</span></a>            <span class="n">mode</span> <span class="o">+=</span> <span class="s1">&#39;b&#39;</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos">403</span></a>        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos">404</span></a>            <span class="n">filename</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">fileobj</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos">405</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">)):</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos">406</span></a>                <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos">407</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos">408</span></a>            <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">fspath</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos">409</span></a>        <span class="k">if</span> <span class="n">fileobj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos">410</span></a>            <span class="n">fileobj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">myfileobj</span> <span class="o">=</span> <span class="n">builtins</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span> <span class="ow">or</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos">411</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos">412</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">myfileobj</span> <span class="o">=</span> <span class="n">fileobj</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos">413</span></a>        <span class="k">if</span> <span class="n">mode</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos">414</span></a>            <span class="n">mode</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">fileobj</span><span class="p">,</span> <span class="s1">&#39;mode&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos">415</span></a>
</span><span id="L-416"><a href="#L-416"><span class="linenos">416</span></a>        <span class="n">cryptor_cls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cryptor_factory</span><span class="p">(</span><span class="n">cryptor</span><span class="p">)</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos">417</span></a>
</span><span id="L-418"><a href="#L-418"><span class="linenos">418</span></a>        <span class="k">if</span> <span class="n">mode</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">):</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos">419</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">READ</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos">420</span></a>            <span class="n">raw</span> <span class="o">=</span> <span class="n">DecryptReader</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">myfileobj</span><span class="p">,</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos">421</span></a>                <span class="n">cryptor_cls</span><span class="p">,</span> <span class="n">trailing_error</span><span class="o">=</span><span class="ne">OSError</span><span class="p">,</span> <span class="o">**</span><span class="n">cryptor_args</span><span class="p">)</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos">422</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BufferedReader</span><span class="p">(</span><span class="n">raw</span><span class="p">)</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos">423</span></a>
</span><span id="L-424"><a href="#L-424"><span class="linenos">424</span></a>        <span class="k">elif</span> <span class="n">mode</span><span class="o">.</span><span class="n">startswith</span><span class="p">((</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">)):</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos">425</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">WRITE</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos">426</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_init_write</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos">427</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">crypt</span> <span class="o">=</span> <span class="n">cryptor_cls</span><span class="p">(</span><span class="n">chunk_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">chunk_size</span><span class="p">,</span> <span class="o">**</span><span class="n">cryptor_args</span><span class="p">)</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos">428</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_buffer_size</span> <span class="o">=</span> <span class="n">write_buffer_size</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos">429</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BufferedWriter</span><span class="p">(</span><span class="n">_WriteBufferStream</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos">430</span></a>                                             <span class="n">buffer_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_buffer_size</span><span class="p">)</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos">431</span></a>
</span><span id="L-432"><a href="#L-432"><span class="linenos">432</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos">433</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid mode: </span><span class="si">{!r}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mode</span><span class="p">))</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos">434</span></a>
</span><span id="L-435"><a href="#L-435"><span class="linenos">435</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fileobj</span> <span class="o">=</span> <span class="n">fileobj</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos">436</span></a>        <span class="c1"># ~ log.debug(&quot;Init CofferFile&quot;)</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos">437</span></a>
</span><span id="L-438"><a href="#L-438"><span class="linenos">438</span></a>    <span class="c1"># ~ @property</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos">439</span></a>    <span class="c1"># ~ def mtime(self):</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos">440</span></a>        <span class="c1"># ~ &quot;&quot;&quot;Last modification time read from stream, or None&quot;&quot;&quot;</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos">441</span></a>        <span class="c1"># ~ return self._buffer.raw._last_mtime</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos">442</span></a>
</span><span id="L-443"><a href="#L-443"><span class="linenos">443</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos">444</span></a>        <span class="n">s</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">myfileobj</span><span class="p">)</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos">445</span></a>        <span class="k">return</span> <span class="s1">&#39;&lt;EncryptFile &#39;</span> <span class="o">+</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nb">hex</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;&gt;&#39;</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos">446</span></a>
</span><span id="L-447"><a href="#L-447"><span class="linenos">447</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos">448</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">cryptor_factory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos">449</span></a>        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos">450</span></a>            <span class="k">return</span> <span class="n">entry_points</span><span class="p">(</span><span class="n">group</span><span class="o">=</span><span class="s1">&#39;cofferfile.cryptor&#39;</span><span class="p">)</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos">451</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos">452</span></a>            <span class="n">crpt</span> <span class="o">=</span> <span class="n">entry_points</span><span class="p">(</span><span class="n">group</span><span class="o">=</span><span class="s1">&#39;cofferfile.cryptor&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos">453</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">crpt</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos">454</span></a>                <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s2">&quot;Problem loading </span><span class="si">%s</span><span class="s2"> : found </span><span class="si">%s</span><span class="s2"> matches&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">crpt</span><span class="p">)))</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos">455</span></a>            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">crpt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos">456</span></a>
</span><span id="L-457"><a href="#L-457"><span class="linenos">457</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_init_write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos">458</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">filename</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos">459</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos">460</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">writebuf</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos">461</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">bufsize</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos">462</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Current file offset for seek(), tell(), etc</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos">463</span></a>
</span><span id="L-464"><a href="#L-464"><span class="linenos">464</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">tell</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos">465</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the current file position.&quot;&quot;&quot;</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos">466</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_not_closed</span><span class="p">()</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos">467</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos">468</span></a>        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos">469</span></a>
</span><span id="L-470"><a href="#L-470"><span class="linenos">470</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos">471</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Write a byte string to the file.</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos">472</span></a>
</span><span id="L-473"><a href="#L-473"><span class="linenos">473</span></a><span class="sd">        Returns the number of uncompressed bytes written, which is</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos">474</span></a><span class="sd">        always the length of data in bytes. Note that due to buffering,</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos">475</span></a><span class="sd">        the file on disk may not reflect the data written until close()</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos">476</span></a><span class="sd">        is called.</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos">477</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos">478</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_can_write</span><span class="p">()</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos">479</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos">480</span></a>
</span><span id="L-481"><a href="#L-481"><span class="linenos">481</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_write_raw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos">482</span></a>        <span class="c1"># Called by our self._buffer underlying WriteBufferStream.</span>
</span><span id="L-483"><a href="#L-483"><span class="linenos">483</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="nb">bytes</span><span class="p">,</span> <span class="nb">bytearray</span><span class="p">)):</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos">484</span></a>            <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos">485</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos">486</span></a>            <span class="c1"># ~ print(type(data))</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos">487</span></a>            <span class="c1"># accept any data that supports the buffer protocol</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos">488</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="nb">memoryview</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos">489</span></a>            <span class="n">length</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">nbytes</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos">490</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">tobytes</span><span class="p">()</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos">491</span></a>
</span><span id="L-492"><a href="#L-492"><span class="linenos">492</span></a>        <span class="k">if</span> <span class="n">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos">493</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">fileobj</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">crypt</span><span class="o">.</span><span class="n">crypt</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos">494</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">+=</span> <span class="n">length</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos">495</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">+=</span> <span class="n">length</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos">496</span></a>
</span><span id="L-497"><a href="#L-497"><span class="linenos">497</span></a>        <span class="k">return</span> <span class="n">length</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos">498</span></a>
</span><span id="L-499"><a href="#L-499"><span class="linenos">499</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos">500</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Read up to size uncompressed bytes from the file.</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos">501</span></a>
</span><span id="L-502"><a href="#L-502"><span class="linenos">502</span></a><span class="sd">        If size is negative or omitted, read until EOF is reached.</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos">503</span></a><span class="sd">        Returns b&#39;&#39; if the file is already at EOF.</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos">504</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos">505</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_can_read</span><span class="p">()</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos">506</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos">507</span></a>
</span><span id="L-508"><a href="#L-508"><span class="linenos">508</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">read1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos">509</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Read up to size uncompressed bytes, while trying to avoid</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos">510</span></a><span class="sd">        making multiple reads from the underlying stream. Reads up to a</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos">511</span></a><span class="sd">        buffer&#39;s worth of data if size is negative.</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos">512</span></a>
</span><span id="L-513"><a href="#L-513"><span class="linenos">513</span></a><span class="sd">        Returns b&#39;&#39; if the file is at EOF.</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos">514</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos">515</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_can_read</span><span class="p">()</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos">516</span></a>        <span class="k">if</span> <span class="n">size</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos">517</span></a>            <span class="n">size</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">DEFAULT_BUFFER_SIZE</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos">518</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read1</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos">519</span></a>
</span><span id="L-520"><a href="#L-520"><span class="linenos">520</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">peek</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos">521</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return buffered data without advancing the file position.</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos">522</span></a>
</span><span id="L-523"><a href="#L-523"><span class="linenos">523</span></a><span class="sd">        Always returns at least one byte of data, unless at EOF.</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos">524</span></a><span class="sd">        The exact number of bytes returned is unspecified.</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos">525</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-526"><a href="#L-526"><span class="linenos">526</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_can_read</span><span class="p">()</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos">527</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">peek</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos">528</span></a>
</span><span id="L-529"><a href="#L-529"><span class="linenos">529</span></a>    <span class="nd">@property</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos">530</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">closed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos">531</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;True if this file is closed.&quot;&quot;&quot;</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos">532</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fileobj</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos">533</span></a>
</span><span id="L-534"><a href="#L-534"><span class="linenos">534</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos">535</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Flush and close the file.</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos">536</span></a>
</span><span id="L-537"><a href="#L-537"><span class="linenos">537</span></a><span class="sd">        May be called more than once without error. Once the file is</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos">538</span></a><span class="sd">        closed, any other operation on it will raise a ValueError.</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos">539</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-540"><a href="#L-540"><span class="linenos">540</span></a>        <span class="n">fileobj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fileobj</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos">541</span></a>        <span class="k">if</span> <span class="n">fileobj</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">closed</span><span class="p">:</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos">542</span></a>            <span class="k">return</span>
</span><span id="L-543"><a href="#L-543"><span class="linenos">543</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos">544</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="n">WRITE</span><span class="p">:</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos">545</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos">546</span></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="n">READ</span><span class="p">:</span>
</span><span id="L-547"><a href="#L-547"><span class="linenos">547</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos">548</span></a>        <span class="k">finally</span><span class="p">:</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos">549</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">fileobj</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-550"><a href="#L-550"><span class="linenos">550</span></a>            <span class="n">myfileobj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">myfileobj</span>
</span><span id="L-551"><a href="#L-551"><span class="linenos">551</span></a>            <span class="k">if</span> <span class="n">myfileobj</span><span class="p">:</span>
</span><span id="L-552"><a href="#L-552"><span class="linenos">552</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">myfileobj</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-553"><a href="#L-553"><span class="linenos">553</span></a>                <span class="n">myfileobj</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-554"><a href="#L-554"><span class="linenos">554</span></a>
</span><span id="L-555"><a href="#L-555"><span class="linenos">555</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">flush</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-556"><a href="#L-556"><span class="linenos">556</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Flush buffers to disk.&quot;&quot;&quot;</span>
</span><span id="L-557"><a href="#L-557"><span class="linenos">557</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_not_closed</span><span class="p">()</span>
</span><span id="L-558"><a href="#L-558"><span class="linenos">558</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="n">WRITE</span><span class="p">:</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos">559</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="L-560"><a href="#L-560"><span class="linenos">560</span></a>            <span class="c1"># Ensure the compressor&#39;s buffer is flushed</span>
</span><span id="L-561"><a href="#L-561"><span class="linenos">561</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">fileobj</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">crypt</span><span class="o">.</span><span class="n">flush</span><span class="p">())</span>
</span><span id="L-562"><a href="#L-562"><span class="linenos">562</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">fileobj</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="L-563"><a href="#L-563"><span class="linenos">563</span></a>
</span><span id="L-564"><a href="#L-564"><span class="linenos">564</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">fileno</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-565"><a href="#L-565"><span class="linenos">565</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Invoke the underlying file object&#39;s fileno() method.</span>
</span><span id="L-566"><a href="#L-566"><span class="linenos">566</span></a>
</span><span id="L-567"><a href="#L-567"><span class="linenos">567</span></a><span class="sd">        This will raise AttributeError if the underlying file object</span>
</span><span id="L-568"><a href="#L-568"><span class="linenos">568</span></a><span class="sd">        doesn&#39;t support fileno().</span>
</span><span id="L-569"><a href="#L-569"><span class="linenos">569</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-570"><a href="#L-570"><span class="linenos">570</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_not_closed</span><span class="p">()</span>
</span><span id="L-571"><a href="#L-571"><span class="linenos">571</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fileobj</span><span class="o">.</span><span class="n">fileno</span><span class="p">()</span>
</span><span id="L-572"><a href="#L-572"><span class="linenos">572</span></a>
</span><span id="L-573"><a href="#L-573"><span class="linenos">573</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">rewind</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-574"><a href="#L-574"><span class="linenos">574</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;Return the uncompressed stream file position indicator to the</span>
</span><span id="L-575"><a href="#L-575"><span class="linenos">575</span></a><span class="sd">        beginning of the file</span>
</span><span id="L-576"><a href="#L-576"><span class="linenos">576</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="L-577"><a href="#L-577"><span class="linenos">577</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">!=</span> <span class="n">READ</span><span class="p">:</span>
</span><span id="L-578"><a href="#L-578"><span class="linenos">578</span></a>            <span class="k">raise</span> <span class="n">io</span><span class="o">.</span><span class="n">UnsupportedOperation</span><span class="p">(</span><span class="s2">&quot;Can&#39;t rewind in write mode&quot;</span><span class="p">)</span>
</span><span id="L-579"><a href="#L-579"><span class="linenos">579</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-580"><a href="#L-580"><span class="linenos">580</span></a>
</span><span id="L-581"><a href="#L-581"><span class="linenos">581</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">readable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-582"><a href="#L-582"><span class="linenos">582</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return whether the file was opened for reading.&quot;&quot;&quot;</span>
</span><span id="L-583"><a href="#L-583"><span class="linenos">583</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_not_closed</span><span class="p">()</span>
</span><span id="L-584"><a href="#L-584"><span class="linenos">584</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="n">READ</span>
</span><span id="L-585"><a href="#L-585"><span class="linenos">585</span></a>
</span><span id="L-586"><a href="#L-586"><span class="linenos">586</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">writable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-587"><a href="#L-587"><span class="linenos">587</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return whether the file was opened for writing.&quot;&quot;&quot;</span>
</span><span id="L-588"><a href="#L-588"><span class="linenos">588</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_not_closed</span><span class="p">()</span>
</span><span id="L-589"><a href="#L-589"><span class="linenos">589</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="n">WRITE</span>
</span><span id="L-590"><a href="#L-590"><span class="linenos">590</span></a>
</span><span id="L-591"><a href="#L-591"><span class="linenos">591</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">seekable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-592"><a href="#L-592"><span class="linenos">592</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return whether the file supports seeking.&quot;&quot;&quot;</span>
</span><span id="L-593"><a href="#L-593"><span class="linenos">593</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">readable</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">seekable</span><span class="p">()</span>
</span><span id="L-594"><a href="#L-594"><span class="linenos">594</span></a>
</span><span id="L-595"><a href="#L-595"><span class="linenos">595</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">seek</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">whence</span><span class="o">=</span><span class="n">io</span><span class="o">.</span><span class="n">SEEK_SET</span><span class="p">):</span>
</span><span id="L-596"><a href="#L-596"><span class="linenos">596</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Change the file position.</span>
</span><span id="L-597"><a href="#L-597"><span class="linenos">597</span></a>
</span><span id="L-598"><a href="#L-598"><span class="linenos">598</span></a><span class="sd">        The new position is specified by offset, relative to the</span>
</span><span id="L-599"><a href="#L-599"><span class="linenos">599</span></a><span class="sd">        position indicated by whence. Values for whence are:</span>
</span><span id="L-600"><a href="#L-600"><span class="linenos">600</span></a>
</span><span id="L-601"><a href="#L-601"><span class="linenos">601</span></a><span class="sd">            0: start of stream (default); offset must not be negative</span>
</span><span id="L-602"><a href="#L-602"><span class="linenos">602</span></a><span class="sd">            1: current stream position</span>
</span><span id="L-603"><a href="#L-603"><span class="linenos">603</span></a><span class="sd">            2: end of stream; offset must not be positive</span>
</span><span id="L-604"><a href="#L-604"><span class="linenos">604</span></a>
</span><span id="L-605"><a href="#L-605"><span class="linenos">605</span></a><span class="sd">        Returns the new file position.</span>
</span><span id="L-606"><a href="#L-606"><span class="linenos">606</span></a>
</span><span id="L-607"><a href="#L-607"><span class="linenos">607</span></a><span class="sd">        Note that seeking is emulated, so depending on the parameters,</span>
</span><span id="L-608"><a href="#L-608"><span class="linenos">608</span></a><span class="sd">        this operation may be extremely slow.</span>
</span><span id="L-609"><a href="#L-609"><span class="linenos">609</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-610"><a href="#L-610"><span class="linenos">610</span></a>        <span class="c1"># ~ self._check_can_seek()</span>
</span><span id="L-611"><a href="#L-611"><span class="linenos">611</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="n">WRITE</span><span class="p">:</span>
</span><span id="L-612"><a href="#L-612"><span class="linenos">612</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_check_not_closed</span><span class="p">()</span>
</span><span id="L-613"><a href="#L-613"><span class="linenos">613</span></a>            <span class="c1"># Flush buffer to ensure validity of self.offset</span>
</span><span id="L-614"><a href="#L-614"><span class="linenos">614</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="L-615"><a href="#L-615"><span class="linenos">615</span></a>            <span class="k">if</span> <span class="n">whence</span> <span class="o">!=</span> <span class="n">io</span><span class="o">.</span><span class="n">SEEK_SET</span><span class="p">:</span>
</span><span id="L-616"><a href="#L-616"><span class="linenos">616</span></a>                <span class="k">if</span> <span class="n">whence</span> <span class="o">==</span> <span class="n">io</span><span class="o">.</span><span class="n">SEEK_CUR</span><span class="p">:</span>
</span><span id="L-617"><a href="#L-617"><span class="linenos">617</span></a>                    <span class="n">offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">+</span> <span class="n">offset</span>
</span><span id="L-618"><a href="#L-618"><span class="linenos">618</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-619"><a href="#L-619"><span class="linenos">619</span></a>                    <span class="k">raise</span> <span class="n">io</span><span class="o">.</span><span class="n">UnsupportedOperation</span><span class="p">(</span><span class="s1">&#39;Seek from end not supported&#39;</span><span class="p">)</span>
</span><span id="L-620"><a href="#L-620"><span class="linenos">620</span></a>            <span class="k">if</span> <span class="n">offset</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">:</span>
</span><span id="L-621"><a href="#L-621"><span class="linenos">621</span></a>                <span class="k">raise</span> <span class="n">io</span><span class="o">.</span><span class="n">UnsupportedOperation</span><span class="p">(</span><span class="s1">&#39;Negative seek in write mode not supported&#39;</span><span class="p">)</span>
</span><span id="L-622"><a href="#L-622"><span class="linenos">622</span></a>            <span class="n">count</span> <span class="o">=</span> <span class="n">offset</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span>
</span><span id="L-623"><a href="#L-623"><span class="linenos">623</span></a>            <span class="n">chunk</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\0</span><span class="s1">&#39;</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer_size</span>
</span><span id="L-624"><a href="#L-624"><span class="linenos">624</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">count</span> <span class="o">//</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer_size</span><span class="p">):</span>
</span><span id="L-625"><a href="#L-625"><span class="linenos">625</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
</span><span id="L-626"><a href="#L-626"><span class="linenos">626</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\0</span><span class="s1">&#39;</span> <span class="o">*</span> <span class="p">(</span><span class="n">count</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer_size</span><span class="p">))</span>
</span><span id="L-627"><a href="#L-627"><span class="linenos">627</span></a>
</span><span id="L-628"><a href="#L-628"><span class="linenos">628</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="n">READ</span><span class="p">:</span>
</span><span id="L-629"><a href="#L-629"><span class="linenos">629</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_check_not_closed</span><span class="p">()</span>
</span><span id="L-630"><a href="#L-630"><span class="linenos">630</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="n">whence</span><span class="p">)</span>
</span><span id="L-631"><a href="#L-631"><span class="linenos">631</span></a>
</span><span id="L-632"><a href="#L-632"><span class="linenos">632</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span>
</span><span id="L-633"><a href="#L-633"><span class="linenos">633</span></a>
</span><span id="L-634"><a href="#L-634"><span class="linenos">634</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">readline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
</span><span id="L-635"><a href="#L-635"><span class="linenos">635</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Read a line of uncompressed bytes from the file.</span>
</span><span id="L-636"><a href="#L-636"><span class="linenos">636</span></a>
</span><span id="L-637"><a href="#L-637"><span class="linenos">637</span></a><span class="sd">        The terminating newline (if present) is retained. If size is</span>
</span><span id="L-638"><a href="#L-638"><span class="linenos">638</span></a><span class="sd">        non-negative, no more than size bytes will be read (in which</span>
</span><span id="L-639"><a href="#L-639"><span class="linenos">639</span></a><span class="sd">        case the line may be incomplete). Returns b&#39;&#39; if already at EOF.</span>
</span><span id="L-640"><a href="#L-640"><span class="linenos">640</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-641"><a href="#L-641"><span class="linenos">641</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_not_closed</span><span class="p">()</span>
</span><span id="L-642"><a href="#L-642"><span class="linenos">642</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">readline</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
</span><span id="L-643"><a href="#L-643"><span class="linenos">643</span></a>
</span><span id="L-644"><a href="#L-644"><span class="linenos">644</span></a><span class="k">def</span><span class="w"> </span><span class="nf">_open_t</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;rb&quot;</span><span class="p">,</span>
</span><span id="L-645"><a href="#L-645"><span class="linenos">645</span></a>         <span class="n">encoding</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-646"><a href="#L-646"><span class="linenos">646</span></a>         <span class="n">chunk_size</span><span class="o">=</span><span class="n">CHUNK_SIZE</span><span class="p">,</span>
</span><span id="L-647"><a href="#L-647"><span class="linenos">647</span></a>         <span class="n">cryptor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">cryptor_args</span><span class="p">):</span>
</span><span id="L-648"><a href="#L-648"><span class="linenos">648</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Open a Fernet file in binary or text mode.</span>
</span><span id="L-649"><a href="#L-649"><span class="linenos">649</span></a>
</span><span id="L-650"><a href="#L-650"><span class="linenos">650</span></a><span class="sd">    The filename argument can be an actual filename (a str or bytes object), or</span>
</span><span id="L-651"><a href="#L-651"><span class="linenos">651</span></a><span class="sd">    an existing file object to read from or write to.</span>
</span><span id="L-652"><a href="#L-652"><span class="linenos">652</span></a>
</span><span id="L-653"><a href="#L-653"><span class="linenos">653</span></a><span class="sd">    The mode argument can be &quot;r&quot;, &quot;rb&quot;, &quot;w&quot;, &quot;wb&quot;, &quot;x&quot;, &quot;xb&quot;, &quot;a&quot; or &quot;ab&quot; for</span>
</span><span id="L-654"><a href="#L-654"><span class="linenos">654</span></a><span class="sd">    binary mode, or &quot;rt&quot;, &quot;wt&quot;, &quot;xt&quot; or &quot;at&quot; for text mode. The default mode is</span>
</span><span id="L-655"><a href="#L-655"><span class="linenos">655</span></a><span class="sd">    &quot;rb&quot;.</span>
</span><span id="L-656"><a href="#L-656"><span class="linenos">656</span></a>
</span><span id="L-657"><a href="#L-657"><span class="linenos">657</span></a><span class="sd">    For binary mode, this function is equivalent to the FernetFile constructor:</span>
</span><span id="L-658"><a href="#L-658"><span class="linenos">658</span></a><span class="sd">    FernetFile(filename, mode, fernet_key). In this case, the encoding, errors</span>
</span><span id="L-659"><a href="#L-659"><span class="linenos">659</span></a><span class="sd">    and newline arguments must not be provided.</span>
</span><span id="L-660"><a href="#L-660"><span class="linenos">660</span></a>
</span><span id="L-661"><a href="#L-661"><span class="linenos">661</span></a><span class="sd">    For text mode, a FernetFile object is created, and wrapped in an</span>
</span><span id="L-662"><a href="#L-662"><span class="linenos">662</span></a><span class="sd">    io.TextIOWrapper instance with the specified encoding, error handling</span>
</span><span id="L-663"><a href="#L-663"><span class="linenos">663</span></a><span class="sd">    behavior, and line ending(s).</span>
</span><span id="L-664"><a href="#L-664"><span class="linenos">664</span></a>
</span><span id="L-665"><a href="#L-665"><span class="linenos">665</span></a><span class="sd">    Encryption is done by chunks to reduce memory footprint. The default</span>
</span><span id="L-666"><a href="#L-666"><span class="linenos">666</span></a><span class="sd">    chunk_size is 64KB.</span>
</span><span id="L-667"><a href="#L-667"><span class="linenos">667</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-668"><a href="#L-668"><span class="linenos">668</span></a>    <span class="k">if</span> <span class="s2">&quot;t&quot;</span> <span class="ow">in</span> <span class="n">mode</span><span class="p">:</span>
</span><span id="L-669"><a href="#L-669"><span class="linenos">669</span></a>        <span class="k">if</span> <span class="s2">&quot;b&quot;</span> <span class="ow">in</span> <span class="n">mode</span><span class="p">:</span>
</span><span id="L-670"><a href="#L-670"><span class="linenos">670</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid mode: </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">mode</span><span class="p">,))</span>
</span><span id="L-671"><a href="#L-671"><span class="linenos">671</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-672"><a href="#L-672"><span class="linenos">672</span></a>        <span class="k">if</span> <span class="n">encoding</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-673"><a href="#L-673"><span class="linenos">673</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Argument &#39;encoding&#39; not supported in binary mode&quot;</span><span class="p">)</span>
</span><span id="L-674"><a href="#L-674"><span class="linenos">674</span></a>        <span class="k">if</span> <span class="n">errors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-675"><a href="#L-675"><span class="linenos">675</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Argument &#39;errors&#39; not supported in binary mode&quot;</span><span class="p">)</span>
</span><span id="L-676"><a href="#L-676"><span class="linenos">676</span></a>        <span class="k">if</span> <span class="n">newline</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-677"><a href="#L-677"><span class="linenos">677</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Argument &#39;newline&#39; not supported in binary mode&quot;</span><span class="p">)</span>
</span><span id="L-678"><a href="#L-678"><span class="linenos">678</span></a>
</span><span id="L-679"><a href="#L-679"><span class="linenos">679</span></a>    <span class="n">frnt_mode</span> <span class="o">=</span> <span class="n">mode</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;t&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="L-680"><a href="#L-680"><span class="linenos">680</span></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">)):</span>
</span><span id="L-681"><a href="#L-681"><span class="linenos">681</span></a>        <span class="n">binary_file</span> <span class="o">=</span> <span class="n">EncryptFile</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">frnt_mode</span><span class="p">,</span> <span class="n">chunk_size</span><span class="o">=</span><span class="n">chunk_size</span><span class="p">,</span> <span class="n">cryptor</span><span class="o">=</span><span class="n">cryptor</span><span class="p">,</span> <span class="o">**</span><span class="n">cryptor_args</span><span class="p">)</span>
</span><span id="L-682"><a href="#L-682"><span class="linenos">682</span></a>    <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;read&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;write&quot;</span><span class="p">):</span>
</span><span id="L-683"><a href="#L-683"><span class="linenos">683</span></a>        <span class="n">binary_file</span> <span class="o">=</span> <span class="n">EncryptFile</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">frnt_mode</span><span class="p">,</span> <span class="n">fileobj</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span> <span class="n">chunk_size</span><span class="o">=</span><span class="n">chunk_size</span><span class="p">,</span> <span class="n">cryptor</span><span class="o">=</span><span class="n">cryptor</span><span class="p">,</span> <span class="o">**</span><span class="n">cryptor_args</span><span class="p">)</span>
</span><span id="L-684"><a href="#L-684"><span class="linenos">684</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-685"><a href="#L-685"><span class="linenos">685</span></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;filename must be a str or bytes object, or a file&quot;</span><span class="p">)</span>
</span><span id="L-686"><a href="#L-686"><span class="linenos">686</span></a>
</span><span id="L-687"><a href="#L-687"><span class="linenos">687</span></a>    <span class="k">if</span> <span class="s2">&quot;t&quot;</span> <span class="ow">in</span> <span class="n">mode</span><span class="p">:</span>
</span><span id="L-688"><a href="#L-688"><span class="linenos">688</span></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">io</span><span class="p">,</span> <span class="s2">&quot;text_encoding&quot;</span><span class="p">):</span>
</span><span id="L-689"><a href="#L-689"><span class="linenos">689</span></a>            <span class="n">text_encoding</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">text_encoding</span>
</span><span id="L-690"><a href="#L-690"><span class="linenos">690</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-691"><a href="#L-691"><span class="linenos">691</span></a>            <span class="c1"># For python 3.9</span>
</span><span id="L-692"><a href="#L-692"><span class="linenos">692</span></a>            <span class="k">def</span><span class="w"> </span><span class="nf">text_encoding</span><span class="p">(</span><span class="n">encoding</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-693"><a href="#L-693"><span class="linenos">693</span></a>                <span class="k">if</span> <span class="n">encoding</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-694"><a href="#L-694"><span class="linenos">694</span></a>                    <span class="k">return</span> <span class="n">encoding</span>
</span><span id="L-695"><a href="#L-695"><span class="linenos">695</span></a>                <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">utf8_mode</span><span class="p">:</span>
</span><span id="L-696"><a href="#L-696"><span class="linenos">696</span></a>                    <span class="k">return</span> <span class="s2">&quot;utf-8&quot;</span>
</span><span id="L-697"><a href="#L-697"><span class="linenos">697</span></a>                <span class="kn">import</span><span class="w"> </span><span class="nn">locale</span>
</span><span id="L-698"><a href="#L-698"><span class="linenos">698</span></a>                <span class="n">_</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">locale</span><span class="o">.</span><span class="n">getlocale</span><span class="p">()</span>
</span><span id="L-699"><a href="#L-699"><span class="linenos">699</span></a>                <span class="k">return</span> <span class="n">encoding</span>
</span><span id="L-700"><a href="#L-700"><span class="linenos">700</span></a>        <span class="n">encoding</span> <span class="o">=</span> <span class="n">text_encoding</span><span class="p">(</span><span class="n">encoding</span><span class="p">)</span>
</span><span id="L-701"><a href="#L-701"><span class="linenos">701</span></a>        <span class="k">return</span> <span class="n">io</span><span class="o">.</span><span class="n">TextIOWrapper</span><span class="p">(</span><span class="n">binary_file</span><span class="p">,</span> <span class="n">encoding</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> <span class="n">newline</span><span class="p">)</span>
</span><span id="L-702"><a href="#L-702"><span class="linenos">702</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-703"><a href="#L-703"><span class="linenos">703</span></a>        <span class="k">return</span> <span class="n">binary_file</span>
</span><span id="L-704"><a href="#L-704"><span class="linenos">704</span></a>
</span><span id="L-705"><a href="#L-705"><span class="linenos">705</span></a><span class="k">def</span><span class="w"> </span><span class="nf">_open_cls</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span>
</span><span id="L-706"><a href="#L-706"><span class="linenos">706</span></a>         <span class="n">encoding</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-707"><a href="#L-707"><span class="linenos">707</span></a>         <span class="n">chunk_size</span><span class="o">=</span><span class="n">CHUNK_SIZE</span><span class="p">,</span>
</span><span id="L-708"><a href="#L-708"><span class="linenos">708</span></a>         <span class="n">coffer_cls</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-709"><a href="#L-709"><span class="linenos">709</span></a>         <span class="n">level_or_option</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">zstd_dict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-710"><a href="#L-710"><span class="linenos">710</span></a>         <span class="n">cryptor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">cryptor_args</span><span class="p">):</span>
</span><span id="L-711"><a href="#L-711"><span class="linenos">711</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Open a Coffer file in binary or text mode.</span>
</span><span id="L-712"><a href="#L-712"><span class="linenos">712</span></a>
</span><span id="L-713"><a href="#L-713"><span class="linenos">713</span></a><span class="sd">    The filename argument can be an actual filename (a str or bytes object), or</span>
</span><span id="L-714"><a href="#L-714"><span class="linenos">714</span></a><span class="sd">    an existing file object to read from or write to.</span>
</span><span id="L-715"><a href="#L-715"><span class="linenos">715</span></a>
</span><span id="L-716"><a href="#L-716"><span class="linenos">716</span></a><span class="sd">    The mode argument can be &quot;r&quot;, &quot;rb&quot;, &quot;w&quot;, &quot;wb&quot;, &quot;x&quot;, &quot;xb&quot;, &quot;a&quot; or &quot;ab&quot; for</span>
</span><span id="L-717"><a href="#L-717"><span class="linenos">717</span></a><span class="sd">    binary mode. The default mode is &quot;rb&quot;.</span>
</span><span id="L-718"><a href="#L-718"><span class="linenos">718</span></a>
</span><span id="L-719"><a href="#L-719"><span class="linenos">719</span></a><span class="sd">    For binary mode, this function is equivalent to the CofferFile constructor:</span>
</span><span id="L-720"><a href="#L-720"><span class="linenos">720</span></a><span class="sd">    CofferFile(filename, mode, cryptor=cryptor, **cryptor_args).</span>
</span><span id="L-721"><a href="#L-721"><span class="linenos">721</span></a>
</span><span id="L-722"><a href="#L-722"><span class="linenos">722</span></a><span class="sd">    Encryption is done by chunks to reduce memory footprint. The default</span>
</span><span id="L-723"><a href="#L-723"><span class="linenos">723</span></a><span class="sd">    chunk_size is 64KB.</span>
</span><span id="L-724"><a href="#L-724"><span class="linenos">724</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-725"><a href="#L-725"><span class="linenos">725</span></a>    <span class="k">if</span> <span class="s2">&quot;t&quot;</span> <span class="ow">in</span> <span class="n">mode</span><span class="p">:</span>
</span><span id="L-726"><a href="#L-726"><span class="linenos">726</span></a>        <span class="k">if</span> <span class="s2">&quot;b&quot;</span> <span class="ow">in</span> <span class="n">mode</span><span class="p">:</span>
</span><span id="L-727"><a href="#L-727"><span class="linenos">727</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid mode: </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">mode</span><span class="p">,))</span>
</span><span id="L-728"><a href="#L-728"><span class="linenos">728</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-729"><a href="#L-729"><span class="linenos">729</span></a>        <span class="k">if</span> <span class="n">encoding</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-730"><a href="#L-730"><span class="linenos">730</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Argument &#39;encoding&#39; not supported in binary mode&quot;</span><span class="p">)</span>
</span><span id="L-731"><a href="#L-731"><span class="linenos">731</span></a>        <span class="k">if</span> <span class="n">errors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-732"><a href="#L-732"><span class="linenos">732</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Argument &#39;errors&#39; not supported in binary mode&quot;</span><span class="p">)</span>
</span><span id="L-733"><a href="#L-733"><span class="linenos">733</span></a>        <span class="k">if</span> <span class="n">newline</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-734"><a href="#L-734"><span class="linenos">734</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Argument &#39;newline&#39; not supported in binary mode&quot;</span><span class="p">)</span>
</span><span id="L-735"><a href="#L-735"><span class="linenos">735</span></a>
</span><span id="L-736"><a href="#L-736"><span class="linenos">736</span></a>    <span class="n">frnt_mode</span> <span class="o">=</span> <span class="n">mode</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;t&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="L-737"><a href="#L-737"><span class="linenos">737</span></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">)):</span>
</span><span id="L-738"><a href="#L-738"><span class="linenos">738</span></a>        <span class="n">binary_file</span> <span class="o">=</span> <span class="n">coffer_cls</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">frnt_mode</span><span class="p">,</span> <span class="n">fileobj</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">chunk_size</span><span class="o">=</span><span class="n">chunk_size</span><span class="p">,</span>
</span><span id="L-739"><a href="#L-739"><span class="linenos">739</span></a>            <span class="n">level_or_option</span><span class="o">=</span><span class="n">level_or_option</span><span class="p">,</span> <span class="n">zstd_dict</span><span class="o">=</span><span class="n">zstd_dict</span><span class="p">,</span>
</span><span id="L-740"><a href="#L-740"><span class="linenos">740</span></a>            <span class="n">cryptor</span><span class="o">=</span><span class="n">cryptor</span><span class="p">,</span> <span class="o">**</span><span class="n">cryptor_args</span><span class="p">)</span>
</span><span id="L-741"><a href="#L-741"><span class="linenos">741</span></a>    <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;read&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;write&quot;</span><span class="p">):</span>
</span><span id="L-742"><a href="#L-742"><span class="linenos">742</span></a>        <span class="n">binary_file</span> <span class="o">=</span> <span class="n">coffer_cls</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">frnt_mode</span><span class="p">,</span> <span class="n">fileobj</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span> <span class="n">chunk_size</span><span class="o">=</span><span class="n">chunk_size</span><span class="p">,</span>
</span><span id="L-743"><a href="#L-743"><span class="linenos">743</span></a>            <span class="n">level_or_option</span><span class="o">=</span><span class="n">level_or_option</span><span class="p">,</span> <span class="n">zstd_dict</span><span class="o">=</span><span class="n">zstd_dict</span><span class="p">,</span>
</span><span id="L-744"><a href="#L-744"><span class="linenos">744</span></a>            <span class="n">cryptor</span><span class="o">=</span><span class="n">cryptor</span><span class="p">,</span> <span class="o">**</span><span class="n">cryptor_args</span><span class="p">)</span>
</span><span id="L-745"><a href="#L-745"><span class="linenos">745</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-746"><a href="#L-746"><span class="linenos">746</span></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;filename must be a str or bytes object, or a file&quot;</span><span class="p">)</span>
</span><span id="L-747"><a href="#L-747"><span class="linenos">747</span></a>
</span><span id="L-748"><a href="#L-748"><span class="linenos">748</span></a>    <span class="k">if</span> <span class="s2">&quot;t&quot;</span> <span class="ow">in</span> <span class="n">mode</span><span class="p">:</span>
</span><span id="L-749"><a href="#L-749"><span class="linenos">749</span></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">io</span><span class="p">,</span> <span class="s2">&quot;text_encoding&quot;</span><span class="p">):</span>
</span><span id="L-750"><a href="#L-750"><span class="linenos">750</span></a>            <span class="n">text_encoding</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">text_encoding</span>
</span><span id="L-751"><a href="#L-751"><span class="linenos">751</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-752"><a href="#L-752"><span class="linenos">752</span></a>            <span class="c1"># For python 3.9</span>
</span><span id="L-753"><a href="#L-753"><span class="linenos">753</span></a>            <span class="k">def</span><span class="w"> </span><span class="nf">text_encoding</span><span class="p">(</span><span class="n">encoding</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-754"><a href="#L-754"><span class="linenos">754</span></a>                <span class="k">if</span> <span class="n">encoding</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-755"><a href="#L-755"><span class="linenos">755</span></a>                    <span class="k">return</span> <span class="n">encoding</span>
</span><span id="L-756"><a href="#L-756"><span class="linenos">756</span></a>                <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">utf8_mode</span><span class="p">:</span>
</span><span id="L-757"><a href="#L-757"><span class="linenos">757</span></a>                    <span class="k">return</span> <span class="s2">&quot;utf-8&quot;</span>
</span><span id="L-758"><a href="#L-758"><span class="linenos">758</span></a>                <span class="kn">import</span><span class="w"> </span><span class="nn">locale</span>
</span><span id="L-759"><a href="#L-759"><span class="linenos">759</span></a>                <span class="n">_</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">locale</span><span class="o">.</span><span class="n">getlocale</span><span class="p">()</span>
</span><span id="L-760"><a href="#L-760"><span class="linenos">760</span></a>                <span class="k">return</span> <span class="n">encoding</span>
</span><span id="L-761"><a href="#L-761"><span class="linenos">761</span></a>        <span class="n">encoding</span> <span class="o">=</span> <span class="n">text_encoding</span><span class="p">(</span><span class="n">encoding</span><span class="p">)</span>
</span><span id="L-762"><a href="#L-762"><span class="linenos">762</span></a>        <span class="k">return</span> <span class="n">io</span><span class="o">.</span><span class="n">TextIOWrapper</span><span class="p">(</span><span class="n">binary_file</span><span class="p">,</span> <span class="n">encoding</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> <span class="n">newline</span><span class="p">)</span>
</span><span id="L-763"><a href="#L-763"><span class="linenos">763</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-764"><a href="#L-764"><span class="linenos">764</span></a>        <span class="k">return</span> <span class="n">binary_file</span>
</span></pre></div>


            </section>
                <section id="EncryptFile">
                            <input id="EncryptFile-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">EncryptFile</span><wbr>(<span class="base"><a href="#BaseStream">BaseStream</a></span>):

                <label class="view-source-button" for="EncryptFile-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EncryptFile"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EncryptFile-352"><a href="#EncryptFile-352"><span class="linenos">352</span></a><span class="k">class</span><span class="w"> </span><span class="nc">EncryptFile</span><span class="p">(</span><span class="n">BaseStream</span><span class="p">):</span>
</span><span id="EncryptFile-353"><a href="#EncryptFile-353"><span class="linenos">353</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The CofferFile class simulates most of the methods of a file object with</span>
</span><span id="EncryptFile-354"><a href="#EncryptFile-354"><span class="linenos">354</span></a><span class="sd">    the exception of the truncate() method.</span>
</span><span id="EncryptFile-355"><a href="#EncryptFile-355"><span class="linenos">355</span></a>
</span><span id="EncryptFile-356"><a href="#EncryptFile-356"><span class="linenos">356</span></a><span class="sd">    This class only supports opening files in binary mode.</span>
</span><span id="EncryptFile-357"><a href="#EncryptFile-357"><span class="linenos">357</span></a>
</span><span id="EncryptFile-358"><a href="#EncryptFile-358"><span class="linenos">358</span></a><span class="sd">    `cofferfile.decorator`</span>
</span><span id="EncryptFile-359"><a href="#EncryptFile-359"><span class="linenos">359</span></a><span class="sd">    `cofferfile.aes`</span>
</span><span id="EncryptFile-360"><a href="#EncryptFile-360"><span class="linenos">360</span></a>
</span><span id="EncryptFile-361"><a href="#EncryptFile-361"><span class="linenos">361</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="EncryptFile-362"><a href="#EncryptFile-362"><span class="linenos">362</span></a>
</span><span id="EncryptFile-363"><a href="#EncryptFile-363"><span class="linenos">363</span></a>    <span class="n">myfileobj</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="EncryptFile-364"><a href="#EncryptFile-364"><span class="linenos">364</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot; Overridden with internal file object to be closed, if only a filename</span>
</span><span id="EncryptFile-365"><a href="#EncryptFile-365"><span class="linenos">365</span></a><span class="sd">    is passed in &quot;&quot;&quot;</span>
</span><span id="EncryptFile-366"><a href="#EncryptFile-366"><span class="linenos">366</span></a>
</span><span id="EncryptFile-367"><a href="#EncryptFile-367"><span class="linenos">367</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fileobj</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="EncryptFile-368"><a href="#EncryptFile-368"><span class="linenos">368</span></a>            <span class="n">chunk_size</span><span class="o">=</span><span class="n">CHUNK_SIZE</span><span class="p">,</span> <span class="n">write_buffer_size</span><span class="o">=</span><span class="n">WRITE_BUFFER_SIZE</span><span class="p">,</span>
</span><span id="EncryptFile-369"><a href="#EncryptFile-369"><span class="linenos">369</span></a>            <span class="n">cryptor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">cryptor_args</span><span class="p">):</span>
</span><span id="EncryptFile-370"><a href="#EncryptFile-370"><span class="linenos">370</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Constructor for the CofferFile class.</span>
</span><span id="EncryptFile-371"><a href="#EncryptFile-371"><span class="linenos">371</span></a>
</span><span id="EncryptFile-372"><a href="#EncryptFile-372"><span class="linenos">372</span></a><span class="sd">        At least one of fileobj and filename must be given a</span>
</span><span id="EncryptFile-373"><a href="#EncryptFile-373"><span class="linenos">373</span></a><span class="sd">        non-trivial value.</span>
</span><span id="EncryptFile-374"><a href="#EncryptFile-374"><span class="linenos">374</span></a>
</span><span id="EncryptFile-375"><a href="#EncryptFile-375"><span class="linenos">375</span></a><span class="sd">        The new class instance is based on fileobj, which can be a regular</span>
</span><span id="EncryptFile-376"><a href="#EncryptFile-376"><span class="linenos">376</span></a><span class="sd">        file, an io.BytesIO object, or any other object which simulates a file.</span>
</span><span id="EncryptFile-377"><a href="#EncryptFile-377"><span class="linenos">377</span></a><span class="sd">        It defaults to None, in which case filename is opened to provide</span>
</span><span id="EncryptFile-378"><a href="#EncryptFile-378"><span class="linenos">378</span></a><span class="sd">        a file object.</span>
</span><span id="EncryptFile-379"><a href="#EncryptFile-379"><span class="linenos">379</span></a>
</span><span id="EncryptFile-380"><a href="#EncryptFile-380"><span class="linenos">380</span></a><span class="sd">        When fileobj is not None, the filename argument is only used to be</span>
</span><span id="EncryptFile-381"><a href="#EncryptFile-381"><span class="linenos">381</span></a><span class="sd">        included in the gzip file header, which may include the original</span>
</span><span id="EncryptFile-382"><a href="#EncryptFile-382"><span class="linenos">382</span></a><span class="sd">        filename of the uncompressed file.  It defaults to the filename of</span>
</span><span id="EncryptFile-383"><a href="#EncryptFile-383"><span class="linenos">383</span></a><span class="sd">        fileobj, if discernible; otherwise, it defaults to the empty string,</span>
</span><span id="EncryptFile-384"><a href="#EncryptFile-384"><span class="linenos">384</span></a><span class="sd">        and in this case the original filename is not included in the header.</span>
</span><span id="EncryptFile-385"><a href="#EncryptFile-385"><span class="linenos">385</span></a>
</span><span id="EncryptFile-386"><a href="#EncryptFile-386"><span class="linenos">386</span></a><span class="sd">        The mode argument can be any of &#39;r&#39;, &#39;rb&#39;, &#39;a&#39;, &#39;ab&#39;, &#39;w&#39;, &#39;wb&#39;, &#39;x&#39;, or</span>
</span><span id="EncryptFile-387"><a href="#EncryptFile-387"><span class="linenos">387</span></a><span class="sd">        &#39;xb&#39; depending on whether the file will be read or written.  The default</span>
</span><span id="EncryptFile-388"><a href="#EncryptFile-388"><span class="linenos">388</span></a><span class="sd">        is the mode of fileobj if discernible; otherwise, the default is &#39;rb&#39;.</span>
</span><span id="EncryptFile-389"><a href="#EncryptFile-389"><span class="linenos">389</span></a><span class="sd">        A mode of &#39;r&#39; is equivalent to one of &#39;rb&#39;, and similarly for &#39;w&#39; and</span>
</span><span id="EncryptFile-390"><a href="#EncryptFile-390"><span class="linenos">390</span></a><span class="sd">        &#39;wb&#39;, &#39;a&#39; and &#39;ab&#39;, and &#39;x&#39; and &#39;xb&#39;.</span>
</span><span id="EncryptFile-391"><a href="#EncryptFile-391"><span class="linenos">391</span></a>
</span><span id="EncryptFile-392"><a href="#EncryptFile-392"><span class="linenos">392</span></a><span class="sd">        The fernet_key argument is the Coffer key used to crypt/decrypt data.</span>
</span><span id="EncryptFile-393"><a href="#EncryptFile-393"><span class="linenos">393</span></a>
</span><span id="EncryptFile-394"><a href="#EncryptFile-394"><span class="linenos">394</span></a><span class="sd">        Encryption is done by chunks to reduce memory footprint. The default</span>
</span><span id="EncryptFile-395"><a href="#EncryptFile-395"><span class="linenos">395</span></a><span class="sd">        chunk_size is 64KB.</span>
</span><span id="EncryptFile-396"><a href="#EncryptFile-396"><span class="linenos">396</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EncryptFile-397"><a href="#EncryptFile-397"><span class="linenos">397</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">chunk_size</span> <span class="o">=</span> <span class="n">chunk_size</span>
</span><span id="EncryptFile-398"><a href="#EncryptFile-398"><span class="linenos">398</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chunk_size</span> <span class="o">!=</span> <span class="n">CHUNK_SIZE</span> <span class="ow">and</span> <span class="n">write_buffer_size</span> <span class="o">==</span> <span class="n">WRITE_BUFFER_SIZE</span><span class="p">:</span>
</span><span id="EncryptFile-399"><a href="#EncryptFile-399"><span class="linenos">399</span></a>            <span class="n">write_buffer_size</span> <span class="o">=</span> <span class="mi">5</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chunk_size</span> <span class="o">+</span> <span class="n">META_SIZE</span><span class="p">)</span>
</span><span id="EncryptFile-400"><a href="#EncryptFile-400"><span class="linenos">400</span></a>        <span class="k">if</span> <span class="n">mode</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;t&#39;</span> <span class="ow">in</span> <span class="n">mode</span> <span class="ow">or</span> <span class="s1">&#39;U&#39;</span> <span class="ow">in</span> <span class="n">mode</span><span class="p">):</span>
</span><span id="EncryptFile-401"><a href="#EncryptFile-401"><span class="linenos">401</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid mode: </span><span class="si">{!r}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mode</span><span class="p">))</span>
</span><span id="EncryptFile-402"><a href="#EncryptFile-402"><span class="linenos">402</span></a>        <span class="k">if</span> <span class="n">mode</span> <span class="ow">and</span> <span class="s1">&#39;b&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">mode</span><span class="p">:</span>
</span><span id="EncryptFile-403"><a href="#EncryptFile-403"><span class="linenos">403</span></a>            <span class="n">mode</span> <span class="o">+=</span> <span class="s1">&#39;b&#39;</span>
</span><span id="EncryptFile-404"><a href="#EncryptFile-404"><span class="linenos">404</span></a>        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="EncryptFile-405"><a href="#EncryptFile-405"><span class="linenos">405</span></a>            <span class="n">filename</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">fileobj</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="EncryptFile-406"><a href="#EncryptFile-406"><span class="linenos">406</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">)):</span>
</span><span id="EncryptFile-407"><a href="#EncryptFile-407"><span class="linenos">407</span></a>                <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span><span id="EncryptFile-408"><a href="#EncryptFile-408"><span class="linenos">408</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="EncryptFile-409"><a href="#EncryptFile-409"><span class="linenos">409</span></a>            <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">fspath</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</span><span id="EncryptFile-410"><a href="#EncryptFile-410"><span class="linenos">410</span></a>        <span class="k">if</span> <span class="n">fileobj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="EncryptFile-411"><a href="#EncryptFile-411"><span class="linenos">411</span></a>            <span class="n">fileobj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">myfileobj</span> <span class="o">=</span> <span class="n">builtins</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span> <span class="ow">or</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span>
</span><span id="EncryptFile-412"><a href="#EncryptFile-412"><span class="linenos">412</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="EncryptFile-413"><a href="#EncryptFile-413"><span class="linenos">413</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">myfileobj</span> <span class="o">=</span> <span class="n">fileobj</span>
</span><span id="EncryptFile-414"><a href="#EncryptFile-414"><span class="linenos">414</span></a>        <span class="k">if</span> <span class="n">mode</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="EncryptFile-415"><a href="#EncryptFile-415"><span class="linenos">415</span></a>            <span class="n">mode</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">fileobj</span><span class="p">,</span> <span class="s1">&#39;mode&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span>
</span><span id="EncryptFile-416"><a href="#EncryptFile-416"><span class="linenos">416</span></a>
</span><span id="EncryptFile-417"><a href="#EncryptFile-417"><span class="linenos">417</span></a>        <span class="n">cryptor_cls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cryptor_factory</span><span class="p">(</span><span class="n">cryptor</span><span class="p">)</span>
</span><span id="EncryptFile-418"><a href="#EncryptFile-418"><span class="linenos">418</span></a>
</span><span id="EncryptFile-419"><a href="#EncryptFile-419"><span class="linenos">419</span></a>        <span class="k">if</span> <span class="n">mode</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">):</span>
</span><span id="EncryptFile-420"><a href="#EncryptFile-420"><span class="linenos">420</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">READ</span>
</span><span id="EncryptFile-421"><a href="#EncryptFile-421"><span class="linenos">421</span></a>            <span class="n">raw</span> <span class="o">=</span> <span class="n">DecryptReader</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">myfileobj</span><span class="p">,</span>
</span><span id="EncryptFile-422"><a href="#EncryptFile-422"><span class="linenos">422</span></a>                <span class="n">cryptor_cls</span><span class="p">,</span> <span class="n">trailing_error</span><span class="o">=</span><span class="ne">OSError</span><span class="p">,</span> <span class="o">**</span><span class="n">cryptor_args</span><span class="p">)</span>
</span><span id="EncryptFile-423"><a href="#EncryptFile-423"><span class="linenos">423</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BufferedReader</span><span class="p">(</span><span class="n">raw</span><span class="p">)</span>
</span><span id="EncryptFile-424"><a href="#EncryptFile-424"><span class="linenos">424</span></a>
</span><span id="EncryptFile-425"><a href="#EncryptFile-425"><span class="linenos">425</span></a>        <span class="k">elif</span> <span class="n">mode</span><span class="o">.</span><span class="n">startswith</span><span class="p">((</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">)):</span>
</span><span id="EncryptFile-426"><a href="#EncryptFile-426"><span class="linenos">426</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">WRITE</span>
</span><span id="EncryptFile-427"><a href="#EncryptFile-427"><span class="linenos">427</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_init_write</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</span><span id="EncryptFile-428"><a href="#EncryptFile-428"><span class="linenos">428</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">crypt</span> <span class="o">=</span> <span class="n">cryptor_cls</span><span class="p">(</span><span class="n">chunk_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">chunk_size</span><span class="p">,</span> <span class="o">**</span><span class="n">cryptor_args</span><span class="p">)</span>
</span><span id="EncryptFile-429"><a href="#EncryptFile-429"><span class="linenos">429</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_buffer_size</span> <span class="o">=</span> <span class="n">write_buffer_size</span>
</span><span id="EncryptFile-430"><a href="#EncryptFile-430"><span class="linenos">430</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BufferedWriter</span><span class="p">(</span><span class="n">_WriteBufferStream</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span>
</span><span id="EncryptFile-431"><a href="#EncryptFile-431"><span class="linenos">431</span></a>                                             <span class="n">buffer_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_buffer_size</span><span class="p">)</span>
</span><span id="EncryptFile-432"><a href="#EncryptFile-432"><span class="linenos">432</span></a>
</span><span id="EncryptFile-433"><a href="#EncryptFile-433"><span class="linenos">433</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="EncryptFile-434"><a href="#EncryptFile-434"><span class="linenos">434</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid mode: </span><span class="si">{!r}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mode</span><span class="p">))</span>
</span><span id="EncryptFile-435"><a href="#EncryptFile-435"><span class="linenos">435</span></a>
</span><span id="EncryptFile-436"><a href="#EncryptFile-436"><span class="linenos">436</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fileobj</span> <span class="o">=</span> <span class="n">fileobj</span>
</span><span id="EncryptFile-437"><a href="#EncryptFile-437"><span class="linenos">437</span></a>        <span class="c1"># ~ log.debug(&quot;Init CofferFile&quot;)</span>
</span><span id="EncryptFile-438"><a href="#EncryptFile-438"><span class="linenos">438</span></a>
</span><span id="EncryptFile-439"><a href="#EncryptFile-439"><span class="linenos">439</span></a>    <span class="c1"># ~ @property</span>
</span><span id="EncryptFile-440"><a href="#EncryptFile-440"><span class="linenos">440</span></a>    <span class="c1"># ~ def mtime(self):</span>
</span><span id="EncryptFile-441"><a href="#EncryptFile-441"><span class="linenos">441</span></a>        <span class="c1"># ~ &quot;&quot;&quot;Last modification time read from stream, or None&quot;&quot;&quot;</span>
</span><span id="EncryptFile-442"><a href="#EncryptFile-442"><span class="linenos">442</span></a>        <span class="c1"># ~ return self._buffer.raw._last_mtime</span>
</span><span id="EncryptFile-443"><a href="#EncryptFile-443"><span class="linenos">443</span></a>
</span><span id="EncryptFile-444"><a href="#EncryptFile-444"><span class="linenos">444</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="EncryptFile-445"><a href="#EncryptFile-445"><span class="linenos">445</span></a>        <span class="n">s</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">myfileobj</span><span class="p">)</span>
</span><span id="EncryptFile-446"><a href="#EncryptFile-446"><span class="linenos">446</span></a>        <span class="k">return</span> <span class="s1">&#39;&lt;EncryptFile &#39;</span> <span class="o">+</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nb">hex</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;&gt;&#39;</span>
</span><span id="EncryptFile-447"><a href="#EncryptFile-447"><span class="linenos">447</span></a>
</span><span id="EncryptFile-448"><a href="#EncryptFile-448"><span class="linenos">448</span></a>    <span class="nd">@classmethod</span>
</span><span id="EncryptFile-449"><a href="#EncryptFile-449"><span class="linenos">449</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">cryptor_factory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="EncryptFile-450"><a href="#EncryptFile-450"><span class="linenos">450</span></a>        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="EncryptFile-451"><a href="#EncryptFile-451"><span class="linenos">451</span></a>            <span class="k">return</span> <span class="n">entry_points</span><span class="p">(</span><span class="n">group</span><span class="o">=</span><span class="s1">&#39;cofferfile.cryptor&#39;</span><span class="p">)</span>
</span><span id="EncryptFile-452"><a href="#EncryptFile-452"><span class="linenos">452</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="EncryptFile-453"><a href="#EncryptFile-453"><span class="linenos">453</span></a>            <span class="n">crpt</span> <span class="o">=</span> <span class="n">entry_points</span><span class="p">(</span><span class="n">group</span><span class="o">=</span><span class="s1">&#39;cofferfile.cryptor&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
</span><span id="EncryptFile-454"><a href="#EncryptFile-454"><span class="linenos">454</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">crpt</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="EncryptFile-455"><a href="#EncryptFile-455"><span class="linenos">455</span></a>                <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s2">&quot;Problem loading </span><span class="si">%s</span><span class="s2"> : found </span><span class="si">%s</span><span class="s2"> matches&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">crpt</span><span class="p">)))</span>
</span><span id="EncryptFile-456"><a href="#EncryptFile-456"><span class="linenos">456</span></a>            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">crpt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
</span><span id="EncryptFile-457"><a href="#EncryptFile-457"><span class="linenos">457</span></a>
</span><span id="EncryptFile-458"><a href="#EncryptFile-458"><span class="linenos">458</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_init_write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
</span><span id="EncryptFile-459"><a href="#EncryptFile-459"><span class="linenos">459</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">filename</span>
</span><span id="EncryptFile-460"><a href="#EncryptFile-460"><span class="linenos">460</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="EncryptFile-461"><a href="#EncryptFile-461"><span class="linenos">461</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">writebuf</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="EncryptFile-462"><a href="#EncryptFile-462"><span class="linenos">462</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">bufsize</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="EncryptFile-463"><a href="#EncryptFile-463"><span class="linenos">463</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Current file offset for seek(), tell(), etc</span>
</span><span id="EncryptFile-464"><a href="#EncryptFile-464"><span class="linenos">464</span></a>
</span><span id="EncryptFile-465"><a href="#EncryptFile-465"><span class="linenos">465</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">tell</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="EncryptFile-466"><a href="#EncryptFile-466"><span class="linenos">466</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the current file position.&quot;&quot;&quot;</span>
</span><span id="EncryptFile-467"><a href="#EncryptFile-467"><span class="linenos">467</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_not_closed</span><span class="p">()</span>
</span><span id="EncryptFile-468"><a href="#EncryptFile-468"><span class="linenos">468</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="EncryptFile-469"><a href="#EncryptFile-469"><span class="linenos">469</span></a>        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>
</span><span id="EncryptFile-470"><a href="#EncryptFile-470"><span class="linenos">470</span></a>
</span><span id="EncryptFile-471"><a href="#EncryptFile-471"><span class="linenos">471</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
</span><span id="EncryptFile-472"><a href="#EncryptFile-472"><span class="linenos">472</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Write a byte string to the file.</span>
</span><span id="EncryptFile-473"><a href="#EncryptFile-473"><span class="linenos">473</span></a>
</span><span id="EncryptFile-474"><a href="#EncryptFile-474"><span class="linenos">474</span></a><span class="sd">        Returns the number of uncompressed bytes written, which is</span>
</span><span id="EncryptFile-475"><a href="#EncryptFile-475"><span class="linenos">475</span></a><span class="sd">        always the length of data in bytes. Note that due to buffering,</span>
</span><span id="EncryptFile-476"><a href="#EncryptFile-476"><span class="linenos">476</span></a><span class="sd">        the file on disk may not reflect the data written until close()</span>
</span><span id="EncryptFile-477"><a href="#EncryptFile-477"><span class="linenos">477</span></a><span class="sd">        is called.</span>
</span><span id="EncryptFile-478"><a href="#EncryptFile-478"><span class="linenos">478</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EncryptFile-479"><a href="#EncryptFile-479"><span class="linenos">479</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_can_write</span><span class="p">()</span>
</span><span id="EncryptFile-480"><a href="#EncryptFile-480"><span class="linenos">480</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="EncryptFile-481"><a href="#EncryptFile-481"><span class="linenos">481</span></a>
</span><span id="EncryptFile-482"><a href="#EncryptFile-482"><span class="linenos">482</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_write_raw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
</span><span id="EncryptFile-483"><a href="#EncryptFile-483"><span class="linenos">483</span></a>        <span class="c1"># Called by our self._buffer underlying WriteBufferStream.</span>
</span><span id="EncryptFile-484"><a href="#EncryptFile-484"><span class="linenos">484</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="nb">bytes</span><span class="p">,</span> <span class="nb">bytearray</span><span class="p">)):</span>
</span><span id="EncryptFile-485"><a href="#EncryptFile-485"><span class="linenos">485</span></a>            <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="EncryptFile-486"><a href="#EncryptFile-486"><span class="linenos">486</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="EncryptFile-487"><a href="#EncryptFile-487"><span class="linenos">487</span></a>            <span class="c1"># ~ print(type(data))</span>
</span><span id="EncryptFile-488"><a href="#EncryptFile-488"><span class="linenos">488</span></a>            <span class="c1"># accept any data that supports the buffer protocol</span>
</span><span id="EncryptFile-489"><a href="#EncryptFile-489"><span class="linenos">489</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="nb">memoryview</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="EncryptFile-490"><a href="#EncryptFile-490"><span class="linenos">490</span></a>            <span class="n">length</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">nbytes</span>
</span><span id="EncryptFile-491"><a href="#EncryptFile-491"><span class="linenos">491</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">tobytes</span><span class="p">()</span>
</span><span id="EncryptFile-492"><a href="#EncryptFile-492"><span class="linenos">492</span></a>
</span><span id="EncryptFile-493"><a href="#EncryptFile-493"><span class="linenos">493</span></a>        <span class="k">if</span> <span class="n">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="EncryptFile-494"><a href="#EncryptFile-494"><span class="linenos">494</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">fileobj</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">crypt</span><span class="o">.</span><span class="n">crypt</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
</span><span id="EncryptFile-495"><a href="#EncryptFile-495"><span class="linenos">495</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">+=</span> <span class="n">length</span>
</span><span id="EncryptFile-496"><a href="#EncryptFile-496"><span class="linenos">496</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">+=</span> <span class="n">length</span>
</span><span id="EncryptFile-497"><a href="#EncryptFile-497"><span class="linenos">497</span></a>
</span><span id="EncryptFile-498"><a href="#EncryptFile-498"><span class="linenos">498</span></a>        <span class="k">return</span> <span class="n">length</span>
</span><span id="EncryptFile-499"><a href="#EncryptFile-499"><span class="linenos">499</span></a>
</span><span id="EncryptFile-500"><a href="#EncryptFile-500"><span class="linenos">500</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
</span><span id="EncryptFile-501"><a href="#EncryptFile-501"><span class="linenos">501</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Read up to size uncompressed bytes from the file.</span>
</span><span id="EncryptFile-502"><a href="#EncryptFile-502"><span class="linenos">502</span></a>
</span><span id="EncryptFile-503"><a href="#EncryptFile-503"><span class="linenos">503</span></a><span class="sd">        If size is negative or omitted, read until EOF is reached.</span>
</span><span id="EncryptFile-504"><a href="#EncryptFile-504"><span class="linenos">504</span></a><span class="sd">        Returns b&#39;&#39; if the file is already at EOF.</span>
</span><span id="EncryptFile-505"><a href="#EncryptFile-505"><span class="linenos">505</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EncryptFile-506"><a href="#EncryptFile-506"><span class="linenos">506</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_can_read</span><span class="p">()</span>
</span><span id="EncryptFile-507"><a href="#EncryptFile-507"><span class="linenos">507</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
</span><span id="EncryptFile-508"><a href="#EncryptFile-508"><span class="linenos">508</span></a>
</span><span id="EncryptFile-509"><a href="#EncryptFile-509"><span class="linenos">509</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">read1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
</span><span id="EncryptFile-510"><a href="#EncryptFile-510"><span class="linenos">510</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Read up to size uncompressed bytes, while trying to avoid</span>
</span><span id="EncryptFile-511"><a href="#EncryptFile-511"><span class="linenos">511</span></a><span class="sd">        making multiple reads from the underlying stream. Reads up to a</span>
</span><span id="EncryptFile-512"><a href="#EncryptFile-512"><span class="linenos">512</span></a><span class="sd">        buffer&#39;s worth of data if size is negative.</span>
</span><span id="EncryptFile-513"><a href="#EncryptFile-513"><span class="linenos">513</span></a>
</span><span id="EncryptFile-514"><a href="#EncryptFile-514"><span class="linenos">514</span></a><span class="sd">        Returns b&#39;&#39; if the file is at EOF.</span>
</span><span id="EncryptFile-515"><a href="#EncryptFile-515"><span class="linenos">515</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EncryptFile-516"><a href="#EncryptFile-516"><span class="linenos">516</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_can_read</span><span class="p">()</span>
</span><span id="EncryptFile-517"><a href="#EncryptFile-517"><span class="linenos">517</span></a>        <span class="k">if</span> <span class="n">size</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="EncryptFile-518"><a href="#EncryptFile-518"><span class="linenos">518</span></a>            <span class="n">size</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">DEFAULT_BUFFER_SIZE</span>
</span><span id="EncryptFile-519"><a href="#EncryptFile-519"><span class="linenos">519</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read1</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
</span><span id="EncryptFile-520"><a href="#EncryptFile-520"><span class="linenos">520</span></a>
</span><span id="EncryptFile-521"><a href="#EncryptFile-521"><span class="linenos">521</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">peek</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
</span><span id="EncryptFile-522"><a href="#EncryptFile-522"><span class="linenos">522</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return buffered data without advancing the file position.</span>
</span><span id="EncryptFile-523"><a href="#EncryptFile-523"><span class="linenos">523</span></a>
</span><span id="EncryptFile-524"><a href="#EncryptFile-524"><span class="linenos">524</span></a><span class="sd">        Always returns at least one byte of data, unless at EOF.</span>
</span><span id="EncryptFile-525"><a href="#EncryptFile-525"><span class="linenos">525</span></a><span class="sd">        The exact number of bytes returned is unspecified.</span>
</span><span id="EncryptFile-526"><a href="#EncryptFile-526"><span class="linenos">526</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EncryptFile-527"><a href="#EncryptFile-527"><span class="linenos">527</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_can_read</span><span class="p">()</span>
</span><span id="EncryptFile-528"><a href="#EncryptFile-528"><span class="linenos">528</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">peek</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</span><span id="EncryptFile-529"><a href="#EncryptFile-529"><span class="linenos">529</span></a>
</span><span id="EncryptFile-530"><a href="#EncryptFile-530"><span class="linenos">530</span></a>    <span class="nd">@property</span>
</span><span id="EncryptFile-531"><a href="#EncryptFile-531"><span class="linenos">531</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">closed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="EncryptFile-532"><a href="#EncryptFile-532"><span class="linenos">532</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;True if this file is closed.&quot;&quot;&quot;</span>
</span><span id="EncryptFile-533"><a href="#EncryptFile-533"><span class="linenos">533</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fileobj</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span id="EncryptFile-534"><a href="#EncryptFile-534"><span class="linenos">534</span></a>
</span><span id="EncryptFile-535"><a href="#EncryptFile-535"><span class="linenos">535</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="EncryptFile-536"><a href="#EncryptFile-536"><span class="linenos">536</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Flush and close the file.</span>
</span><span id="EncryptFile-537"><a href="#EncryptFile-537"><span class="linenos">537</span></a>
</span><span id="EncryptFile-538"><a href="#EncryptFile-538"><span class="linenos">538</span></a><span class="sd">        May be called more than once without error. Once the file is</span>
</span><span id="EncryptFile-539"><a href="#EncryptFile-539"><span class="linenos">539</span></a><span class="sd">        closed, any other operation on it will raise a ValueError.</span>
</span><span id="EncryptFile-540"><a href="#EncryptFile-540"><span class="linenos">540</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EncryptFile-541"><a href="#EncryptFile-541"><span class="linenos">541</span></a>        <span class="n">fileobj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fileobj</span>
</span><span id="EncryptFile-542"><a href="#EncryptFile-542"><span class="linenos">542</span></a>        <span class="k">if</span> <span class="n">fileobj</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">closed</span><span class="p">:</span>
</span><span id="EncryptFile-543"><a href="#EncryptFile-543"><span class="linenos">543</span></a>            <span class="k">return</span>
</span><span id="EncryptFile-544"><a href="#EncryptFile-544"><span class="linenos">544</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="EncryptFile-545"><a href="#EncryptFile-545"><span class="linenos">545</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="n">WRITE</span><span class="p">:</span>
</span><span id="EncryptFile-546"><a href="#EncryptFile-546"><span class="linenos">546</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="EncryptFile-547"><a href="#EncryptFile-547"><span class="linenos">547</span></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="n">READ</span><span class="p">:</span>
</span><span id="EncryptFile-548"><a href="#EncryptFile-548"><span class="linenos">548</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="EncryptFile-549"><a href="#EncryptFile-549"><span class="linenos">549</span></a>        <span class="k">finally</span><span class="p">:</span>
</span><span id="EncryptFile-550"><a href="#EncryptFile-550"><span class="linenos">550</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">fileobj</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="EncryptFile-551"><a href="#EncryptFile-551"><span class="linenos">551</span></a>            <span class="n">myfileobj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">myfileobj</span>
</span><span id="EncryptFile-552"><a href="#EncryptFile-552"><span class="linenos">552</span></a>            <span class="k">if</span> <span class="n">myfileobj</span><span class="p">:</span>
</span><span id="EncryptFile-553"><a href="#EncryptFile-553"><span class="linenos">553</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">myfileobj</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="EncryptFile-554"><a href="#EncryptFile-554"><span class="linenos">554</span></a>                <span class="n">myfileobj</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="EncryptFile-555"><a href="#EncryptFile-555"><span class="linenos">555</span></a>
</span><span id="EncryptFile-556"><a href="#EncryptFile-556"><span class="linenos">556</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">flush</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="EncryptFile-557"><a href="#EncryptFile-557"><span class="linenos">557</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Flush buffers to disk.&quot;&quot;&quot;</span>
</span><span id="EncryptFile-558"><a href="#EncryptFile-558"><span class="linenos">558</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_not_closed</span><span class="p">()</span>
</span><span id="EncryptFile-559"><a href="#EncryptFile-559"><span class="linenos">559</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="n">WRITE</span><span class="p">:</span>
</span><span id="EncryptFile-560"><a href="#EncryptFile-560"><span class="linenos">560</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="EncryptFile-561"><a href="#EncryptFile-561"><span class="linenos">561</span></a>            <span class="c1"># Ensure the compressor&#39;s buffer is flushed</span>
</span><span id="EncryptFile-562"><a href="#EncryptFile-562"><span class="linenos">562</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">fileobj</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">crypt</span><span class="o">.</span><span class="n">flush</span><span class="p">())</span>
</span><span id="EncryptFile-563"><a href="#EncryptFile-563"><span class="linenos">563</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">fileobj</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="EncryptFile-564"><a href="#EncryptFile-564"><span class="linenos">564</span></a>
</span><span id="EncryptFile-565"><a href="#EncryptFile-565"><span class="linenos">565</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">fileno</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="EncryptFile-566"><a href="#EncryptFile-566"><span class="linenos">566</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Invoke the underlying file object&#39;s fileno() method.</span>
</span><span id="EncryptFile-567"><a href="#EncryptFile-567"><span class="linenos">567</span></a>
</span><span id="EncryptFile-568"><a href="#EncryptFile-568"><span class="linenos">568</span></a><span class="sd">        This will raise AttributeError if the underlying file object</span>
</span><span id="EncryptFile-569"><a href="#EncryptFile-569"><span class="linenos">569</span></a><span class="sd">        doesn&#39;t support fileno().</span>
</span><span id="EncryptFile-570"><a href="#EncryptFile-570"><span class="linenos">570</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EncryptFile-571"><a href="#EncryptFile-571"><span class="linenos">571</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_not_closed</span><span class="p">()</span>
</span><span id="EncryptFile-572"><a href="#EncryptFile-572"><span class="linenos">572</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fileobj</span><span class="o">.</span><span class="n">fileno</span><span class="p">()</span>
</span><span id="EncryptFile-573"><a href="#EncryptFile-573"><span class="linenos">573</span></a>
</span><span id="EncryptFile-574"><a href="#EncryptFile-574"><span class="linenos">574</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">rewind</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="EncryptFile-575"><a href="#EncryptFile-575"><span class="linenos">575</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;Return the uncompressed stream file position indicator to the</span>
</span><span id="EncryptFile-576"><a href="#EncryptFile-576"><span class="linenos">576</span></a><span class="sd">        beginning of the file</span>
</span><span id="EncryptFile-577"><a href="#EncryptFile-577"><span class="linenos">577</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="EncryptFile-578"><a href="#EncryptFile-578"><span class="linenos">578</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">!=</span> <span class="n">READ</span><span class="p">:</span>
</span><span id="EncryptFile-579"><a href="#EncryptFile-579"><span class="linenos">579</span></a>            <span class="k">raise</span> <span class="n">io</span><span class="o">.</span><span class="n">UnsupportedOperation</span><span class="p">(</span><span class="s2">&quot;Can&#39;t rewind in write mode&quot;</span><span class="p">)</span>
</span><span id="EncryptFile-580"><a href="#EncryptFile-580"><span class="linenos">580</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="EncryptFile-581"><a href="#EncryptFile-581"><span class="linenos">581</span></a>
</span><span id="EncryptFile-582"><a href="#EncryptFile-582"><span class="linenos">582</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">readable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="EncryptFile-583"><a href="#EncryptFile-583"><span class="linenos">583</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return whether the file was opened for reading.&quot;&quot;&quot;</span>
</span><span id="EncryptFile-584"><a href="#EncryptFile-584"><span class="linenos">584</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_not_closed</span><span class="p">()</span>
</span><span id="EncryptFile-585"><a href="#EncryptFile-585"><span class="linenos">585</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="n">READ</span>
</span><span id="EncryptFile-586"><a href="#EncryptFile-586"><span class="linenos">586</span></a>
</span><span id="EncryptFile-587"><a href="#EncryptFile-587"><span class="linenos">587</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">writable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="EncryptFile-588"><a href="#EncryptFile-588"><span class="linenos">588</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return whether the file was opened for writing.&quot;&quot;&quot;</span>
</span><span id="EncryptFile-589"><a href="#EncryptFile-589"><span class="linenos">589</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_not_closed</span><span class="p">()</span>
</span><span id="EncryptFile-590"><a href="#EncryptFile-590"><span class="linenos">590</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="n">WRITE</span>
</span><span id="EncryptFile-591"><a href="#EncryptFile-591"><span class="linenos">591</span></a>
</span><span id="EncryptFile-592"><a href="#EncryptFile-592"><span class="linenos">592</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">seekable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="EncryptFile-593"><a href="#EncryptFile-593"><span class="linenos">593</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return whether the file supports seeking.&quot;&quot;&quot;</span>
</span><span id="EncryptFile-594"><a href="#EncryptFile-594"><span class="linenos">594</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">readable</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">seekable</span><span class="p">()</span>
</span><span id="EncryptFile-595"><a href="#EncryptFile-595"><span class="linenos">595</span></a>
</span><span id="EncryptFile-596"><a href="#EncryptFile-596"><span class="linenos">596</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">seek</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">whence</span><span class="o">=</span><span class="n">io</span><span class="o">.</span><span class="n">SEEK_SET</span><span class="p">):</span>
</span><span id="EncryptFile-597"><a href="#EncryptFile-597"><span class="linenos">597</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Change the file position.</span>
</span><span id="EncryptFile-598"><a href="#EncryptFile-598"><span class="linenos">598</span></a>
</span><span id="EncryptFile-599"><a href="#EncryptFile-599"><span class="linenos">599</span></a><span class="sd">        The new position is specified by offset, relative to the</span>
</span><span id="EncryptFile-600"><a href="#EncryptFile-600"><span class="linenos">600</span></a><span class="sd">        position indicated by whence. Values for whence are:</span>
</span><span id="EncryptFile-601"><a href="#EncryptFile-601"><span class="linenos">601</span></a>
</span><span id="EncryptFile-602"><a href="#EncryptFile-602"><span class="linenos">602</span></a><span class="sd">            0: start of stream (default); offset must not be negative</span>
</span><span id="EncryptFile-603"><a href="#EncryptFile-603"><span class="linenos">603</span></a><span class="sd">            1: current stream position</span>
</span><span id="EncryptFile-604"><a href="#EncryptFile-604"><span class="linenos">604</span></a><span class="sd">            2: end of stream; offset must not be positive</span>
</span><span id="EncryptFile-605"><a href="#EncryptFile-605"><span class="linenos">605</span></a>
</span><span id="EncryptFile-606"><a href="#EncryptFile-606"><span class="linenos">606</span></a><span class="sd">        Returns the new file position.</span>
</span><span id="EncryptFile-607"><a href="#EncryptFile-607"><span class="linenos">607</span></a>
</span><span id="EncryptFile-608"><a href="#EncryptFile-608"><span class="linenos">608</span></a><span class="sd">        Note that seeking is emulated, so depending on the parameters,</span>
</span><span id="EncryptFile-609"><a href="#EncryptFile-609"><span class="linenos">609</span></a><span class="sd">        this operation may be extremely slow.</span>
</span><span id="EncryptFile-610"><a href="#EncryptFile-610"><span class="linenos">610</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EncryptFile-611"><a href="#EncryptFile-611"><span class="linenos">611</span></a>        <span class="c1"># ~ self._check_can_seek()</span>
</span><span id="EncryptFile-612"><a href="#EncryptFile-612"><span class="linenos">612</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="n">WRITE</span><span class="p">:</span>
</span><span id="EncryptFile-613"><a href="#EncryptFile-613"><span class="linenos">613</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_check_not_closed</span><span class="p">()</span>
</span><span id="EncryptFile-614"><a href="#EncryptFile-614"><span class="linenos">614</span></a>            <span class="c1"># Flush buffer to ensure validity of self.offset</span>
</span><span id="EncryptFile-615"><a href="#EncryptFile-615"><span class="linenos">615</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="EncryptFile-616"><a href="#EncryptFile-616"><span class="linenos">616</span></a>            <span class="k">if</span> <span class="n">whence</span> <span class="o">!=</span> <span class="n">io</span><span class="o">.</span><span class="n">SEEK_SET</span><span class="p">:</span>
</span><span id="EncryptFile-617"><a href="#EncryptFile-617"><span class="linenos">617</span></a>                <span class="k">if</span> <span class="n">whence</span> <span class="o">==</span> <span class="n">io</span><span class="o">.</span><span class="n">SEEK_CUR</span><span class="p">:</span>
</span><span id="EncryptFile-618"><a href="#EncryptFile-618"><span class="linenos">618</span></a>                    <span class="n">offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">+</span> <span class="n">offset</span>
</span><span id="EncryptFile-619"><a href="#EncryptFile-619"><span class="linenos">619</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="EncryptFile-620"><a href="#EncryptFile-620"><span class="linenos">620</span></a>                    <span class="k">raise</span> <span class="n">io</span><span class="o">.</span><span class="n">UnsupportedOperation</span><span class="p">(</span><span class="s1">&#39;Seek from end not supported&#39;</span><span class="p">)</span>
</span><span id="EncryptFile-621"><a href="#EncryptFile-621"><span class="linenos">621</span></a>            <span class="k">if</span> <span class="n">offset</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">:</span>
</span><span id="EncryptFile-622"><a href="#EncryptFile-622"><span class="linenos">622</span></a>                <span class="k">raise</span> <span class="n">io</span><span class="o">.</span><span class="n">UnsupportedOperation</span><span class="p">(</span><span class="s1">&#39;Negative seek in write mode not supported&#39;</span><span class="p">)</span>
</span><span id="EncryptFile-623"><a href="#EncryptFile-623"><span class="linenos">623</span></a>            <span class="n">count</span> <span class="o">=</span> <span class="n">offset</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span>
</span><span id="EncryptFile-624"><a href="#EncryptFile-624"><span class="linenos">624</span></a>            <span class="n">chunk</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\0</span><span class="s1">&#39;</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer_size</span>
</span><span id="EncryptFile-625"><a href="#EncryptFile-625"><span class="linenos">625</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">count</span> <span class="o">//</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer_size</span><span class="p">):</span>
</span><span id="EncryptFile-626"><a href="#EncryptFile-626"><span class="linenos">626</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
</span><span id="EncryptFile-627"><a href="#EncryptFile-627"><span class="linenos">627</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\0</span><span class="s1">&#39;</span> <span class="o">*</span> <span class="p">(</span><span class="n">count</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer_size</span><span class="p">))</span>
</span><span id="EncryptFile-628"><a href="#EncryptFile-628"><span class="linenos">628</span></a>
</span><span id="EncryptFile-629"><a href="#EncryptFile-629"><span class="linenos">629</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="n">READ</span><span class="p">:</span>
</span><span id="EncryptFile-630"><a href="#EncryptFile-630"><span class="linenos">630</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_check_not_closed</span><span class="p">()</span>
</span><span id="EncryptFile-631"><a href="#EncryptFile-631"><span class="linenos">631</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="n">whence</span><span class="p">)</span>
</span><span id="EncryptFile-632"><a href="#EncryptFile-632"><span class="linenos">632</span></a>
</span><span id="EncryptFile-633"><a href="#EncryptFile-633"><span class="linenos">633</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span>
</span><span id="EncryptFile-634"><a href="#EncryptFile-634"><span class="linenos">634</span></a>
</span><span id="EncryptFile-635"><a href="#EncryptFile-635"><span class="linenos">635</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">readline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
</span><span id="EncryptFile-636"><a href="#EncryptFile-636"><span class="linenos">636</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Read a line of uncompressed bytes from the file.</span>
</span><span id="EncryptFile-637"><a href="#EncryptFile-637"><span class="linenos">637</span></a>
</span><span id="EncryptFile-638"><a href="#EncryptFile-638"><span class="linenos">638</span></a><span class="sd">        The terminating newline (if present) is retained. If size is</span>
</span><span id="EncryptFile-639"><a href="#EncryptFile-639"><span class="linenos">639</span></a><span class="sd">        non-negative, no more than size bytes will be read (in which</span>
</span><span id="EncryptFile-640"><a href="#EncryptFile-640"><span class="linenos">640</span></a><span class="sd">        case the line may be incomplete). Returns b&#39;&#39; if already at EOF.</span>
</span><span id="EncryptFile-641"><a href="#EncryptFile-641"><span class="linenos">641</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EncryptFile-642"><a href="#EncryptFile-642"><span class="linenos">642</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_not_closed</span><span class="p">()</span>
</span><span id="EncryptFile-643"><a href="#EncryptFile-643"><span class="linenos">643</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">readline</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>The CofferFile class simulates most of the methods of a file object with
the exception of the truncate() method.</p>

<p>This class only supports opening files in binary mode.</p>

<p><code><a href="cofferfile/decorator.html">cofferfile.decorator</a></code>
<code><a href="cofferfile/aes.html">cofferfile.aes</a></code></p>
</div>


                            <div id="EncryptFile.__init__" class="classattr">
                                        <input id="EncryptFile.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">EncryptFile</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">filename</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">mode</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">fileobj</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">chunk_size</span><span class="o">=</span><span class="mi">65504</span>,</span><span class="param">	<span class="n">write_buffer_size</span><span class="o">=</span><span class="mi">327680</span>,</span><span class="param">	<span class="n">cryptor</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="o">**</span><span class="n">cryptor_args</span></span>)</span>

                <label class="view-source-button" for="EncryptFile.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EncryptFile.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EncryptFile.__init__-367"><a href="#EncryptFile.__init__-367"><span class="linenos">367</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fileobj</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="EncryptFile.__init__-368"><a href="#EncryptFile.__init__-368"><span class="linenos">368</span></a>            <span class="n">chunk_size</span><span class="o">=</span><span class="n">CHUNK_SIZE</span><span class="p">,</span> <span class="n">write_buffer_size</span><span class="o">=</span><span class="n">WRITE_BUFFER_SIZE</span><span class="p">,</span>
</span><span id="EncryptFile.__init__-369"><a href="#EncryptFile.__init__-369"><span class="linenos">369</span></a>            <span class="n">cryptor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">cryptor_args</span><span class="p">):</span>
</span><span id="EncryptFile.__init__-370"><a href="#EncryptFile.__init__-370"><span class="linenos">370</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Constructor for the CofferFile class.</span>
</span><span id="EncryptFile.__init__-371"><a href="#EncryptFile.__init__-371"><span class="linenos">371</span></a>
</span><span id="EncryptFile.__init__-372"><a href="#EncryptFile.__init__-372"><span class="linenos">372</span></a><span class="sd">        At least one of fileobj and filename must be given a</span>
</span><span id="EncryptFile.__init__-373"><a href="#EncryptFile.__init__-373"><span class="linenos">373</span></a><span class="sd">        non-trivial value.</span>
</span><span id="EncryptFile.__init__-374"><a href="#EncryptFile.__init__-374"><span class="linenos">374</span></a>
</span><span id="EncryptFile.__init__-375"><a href="#EncryptFile.__init__-375"><span class="linenos">375</span></a><span class="sd">        The new class instance is based on fileobj, which can be a regular</span>
</span><span id="EncryptFile.__init__-376"><a href="#EncryptFile.__init__-376"><span class="linenos">376</span></a><span class="sd">        file, an io.BytesIO object, or any other object which simulates a file.</span>
</span><span id="EncryptFile.__init__-377"><a href="#EncryptFile.__init__-377"><span class="linenos">377</span></a><span class="sd">        It defaults to None, in which case filename is opened to provide</span>
</span><span id="EncryptFile.__init__-378"><a href="#EncryptFile.__init__-378"><span class="linenos">378</span></a><span class="sd">        a file object.</span>
</span><span id="EncryptFile.__init__-379"><a href="#EncryptFile.__init__-379"><span class="linenos">379</span></a>
</span><span id="EncryptFile.__init__-380"><a href="#EncryptFile.__init__-380"><span class="linenos">380</span></a><span class="sd">        When fileobj is not None, the filename argument is only used to be</span>
</span><span id="EncryptFile.__init__-381"><a href="#EncryptFile.__init__-381"><span class="linenos">381</span></a><span class="sd">        included in the gzip file header, which may include the original</span>
</span><span id="EncryptFile.__init__-382"><a href="#EncryptFile.__init__-382"><span class="linenos">382</span></a><span class="sd">        filename of the uncompressed file.  It defaults to the filename of</span>
</span><span id="EncryptFile.__init__-383"><a href="#EncryptFile.__init__-383"><span class="linenos">383</span></a><span class="sd">        fileobj, if discernible; otherwise, it defaults to the empty string,</span>
</span><span id="EncryptFile.__init__-384"><a href="#EncryptFile.__init__-384"><span class="linenos">384</span></a><span class="sd">        and in this case the original filename is not included in the header.</span>
</span><span id="EncryptFile.__init__-385"><a href="#EncryptFile.__init__-385"><span class="linenos">385</span></a>
</span><span id="EncryptFile.__init__-386"><a href="#EncryptFile.__init__-386"><span class="linenos">386</span></a><span class="sd">        The mode argument can be any of &#39;r&#39;, &#39;rb&#39;, &#39;a&#39;, &#39;ab&#39;, &#39;w&#39;, &#39;wb&#39;, &#39;x&#39;, or</span>
</span><span id="EncryptFile.__init__-387"><a href="#EncryptFile.__init__-387"><span class="linenos">387</span></a><span class="sd">        &#39;xb&#39; depending on whether the file will be read or written.  The default</span>
</span><span id="EncryptFile.__init__-388"><a href="#EncryptFile.__init__-388"><span class="linenos">388</span></a><span class="sd">        is the mode of fileobj if discernible; otherwise, the default is &#39;rb&#39;.</span>
</span><span id="EncryptFile.__init__-389"><a href="#EncryptFile.__init__-389"><span class="linenos">389</span></a><span class="sd">        A mode of &#39;r&#39; is equivalent to one of &#39;rb&#39;, and similarly for &#39;w&#39; and</span>
</span><span id="EncryptFile.__init__-390"><a href="#EncryptFile.__init__-390"><span class="linenos">390</span></a><span class="sd">        &#39;wb&#39;, &#39;a&#39; and &#39;ab&#39;, and &#39;x&#39; and &#39;xb&#39;.</span>
</span><span id="EncryptFile.__init__-391"><a href="#EncryptFile.__init__-391"><span class="linenos">391</span></a>
</span><span id="EncryptFile.__init__-392"><a href="#EncryptFile.__init__-392"><span class="linenos">392</span></a><span class="sd">        The fernet_key argument is the Coffer key used to crypt/decrypt data.</span>
</span><span id="EncryptFile.__init__-393"><a href="#EncryptFile.__init__-393"><span class="linenos">393</span></a>
</span><span id="EncryptFile.__init__-394"><a href="#EncryptFile.__init__-394"><span class="linenos">394</span></a><span class="sd">        Encryption is done by chunks to reduce memory footprint. The default</span>
</span><span id="EncryptFile.__init__-395"><a href="#EncryptFile.__init__-395"><span class="linenos">395</span></a><span class="sd">        chunk_size is 64KB.</span>
</span><span id="EncryptFile.__init__-396"><a href="#EncryptFile.__init__-396"><span class="linenos">396</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EncryptFile.__init__-397"><a href="#EncryptFile.__init__-397"><span class="linenos">397</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">chunk_size</span> <span class="o">=</span> <span class="n">chunk_size</span>
</span><span id="EncryptFile.__init__-398"><a href="#EncryptFile.__init__-398"><span class="linenos">398</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chunk_size</span> <span class="o">!=</span> <span class="n">CHUNK_SIZE</span> <span class="ow">and</span> <span class="n">write_buffer_size</span> <span class="o">==</span> <span class="n">WRITE_BUFFER_SIZE</span><span class="p">:</span>
</span><span id="EncryptFile.__init__-399"><a href="#EncryptFile.__init__-399"><span class="linenos">399</span></a>            <span class="n">write_buffer_size</span> <span class="o">=</span> <span class="mi">5</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chunk_size</span> <span class="o">+</span> <span class="n">META_SIZE</span><span class="p">)</span>
</span><span id="EncryptFile.__init__-400"><a href="#EncryptFile.__init__-400"><span class="linenos">400</span></a>        <span class="k">if</span> <span class="n">mode</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;t&#39;</span> <span class="ow">in</span> <span class="n">mode</span> <span class="ow">or</span> <span class="s1">&#39;U&#39;</span> <span class="ow">in</span> <span class="n">mode</span><span class="p">):</span>
</span><span id="EncryptFile.__init__-401"><a href="#EncryptFile.__init__-401"><span class="linenos">401</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid mode: </span><span class="si">{!r}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mode</span><span class="p">))</span>
</span><span id="EncryptFile.__init__-402"><a href="#EncryptFile.__init__-402"><span class="linenos">402</span></a>        <span class="k">if</span> <span class="n">mode</span> <span class="ow">and</span> <span class="s1">&#39;b&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">mode</span><span class="p">:</span>
</span><span id="EncryptFile.__init__-403"><a href="#EncryptFile.__init__-403"><span class="linenos">403</span></a>            <span class="n">mode</span> <span class="o">+=</span> <span class="s1">&#39;b&#39;</span>
</span><span id="EncryptFile.__init__-404"><a href="#EncryptFile.__init__-404"><span class="linenos">404</span></a>        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="EncryptFile.__init__-405"><a href="#EncryptFile.__init__-405"><span class="linenos">405</span></a>            <span class="n">filename</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">fileobj</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="EncryptFile.__init__-406"><a href="#EncryptFile.__init__-406"><span class="linenos">406</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">)):</span>
</span><span id="EncryptFile.__init__-407"><a href="#EncryptFile.__init__-407"><span class="linenos">407</span></a>                <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span><span id="EncryptFile.__init__-408"><a href="#EncryptFile.__init__-408"><span class="linenos">408</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="EncryptFile.__init__-409"><a href="#EncryptFile.__init__-409"><span class="linenos">409</span></a>            <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">fspath</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</span><span id="EncryptFile.__init__-410"><a href="#EncryptFile.__init__-410"><span class="linenos">410</span></a>        <span class="k">if</span> <span class="n">fileobj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="EncryptFile.__init__-411"><a href="#EncryptFile.__init__-411"><span class="linenos">411</span></a>            <span class="n">fileobj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">myfileobj</span> <span class="o">=</span> <span class="n">builtins</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span> <span class="ow">or</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span>
</span><span id="EncryptFile.__init__-412"><a href="#EncryptFile.__init__-412"><span class="linenos">412</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="EncryptFile.__init__-413"><a href="#EncryptFile.__init__-413"><span class="linenos">413</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">myfileobj</span> <span class="o">=</span> <span class="n">fileobj</span>
</span><span id="EncryptFile.__init__-414"><a href="#EncryptFile.__init__-414"><span class="linenos">414</span></a>        <span class="k">if</span> <span class="n">mode</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="EncryptFile.__init__-415"><a href="#EncryptFile.__init__-415"><span class="linenos">415</span></a>            <span class="n">mode</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">fileobj</span><span class="p">,</span> <span class="s1">&#39;mode&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span>
</span><span id="EncryptFile.__init__-416"><a href="#EncryptFile.__init__-416"><span class="linenos">416</span></a>
</span><span id="EncryptFile.__init__-417"><a href="#EncryptFile.__init__-417"><span class="linenos">417</span></a>        <span class="n">cryptor_cls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cryptor_factory</span><span class="p">(</span><span class="n">cryptor</span><span class="p">)</span>
</span><span id="EncryptFile.__init__-418"><a href="#EncryptFile.__init__-418"><span class="linenos">418</span></a>
</span><span id="EncryptFile.__init__-419"><a href="#EncryptFile.__init__-419"><span class="linenos">419</span></a>        <span class="k">if</span> <span class="n">mode</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">):</span>
</span><span id="EncryptFile.__init__-420"><a href="#EncryptFile.__init__-420"><span class="linenos">420</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">READ</span>
</span><span id="EncryptFile.__init__-421"><a href="#EncryptFile.__init__-421"><span class="linenos">421</span></a>            <span class="n">raw</span> <span class="o">=</span> <span class="n">DecryptReader</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">myfileobj</span><span class="p">,</span>
</span><span id="EncryptFile.__init__-422"><a href="#EncryptFile.__init__-422"><span class="linenos">422</span></a>                <span class="n">cryptor_cls</span><span class="p">,</span> <span class="n">trailing_error</span><span class="o">=</span><span class="ne">OSError</span><span class="p">,</span> <span class="o">**</span><span class="n">cryptor_args</span><span class="p">)</span>
</span><span id="EncryptFile.__init__-423"><a href="#EncryptFile.__init__-423"><span class="linenos">423</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BufferedReader</span><span class="p">(</span><span class="n">raw</span><span class="p">)</span>
</span><span id="EncryptFile.__init__-424"><a href="#EncryptFile.__init__-424"><span class="linenos">424</span></a>
</span><span id="EncryptFile.__init__-425"><a href="#EncryptFile.__init__-425"><span class="linenos">425</span></a>        <span class="k">elif</span> <span class="n">mode</span><span class="o">.</span><span class="n">startswith</span><span class="p">((</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">)):</span>
</span><span id="EncryptFile.__init__-426"><a href="#EncryptFile.__init__-426"><span class="linenos">426</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">WRITE</span>
</span><span id="EncryptFile.__init__-427"><a href="#EncryptFile.__init__-427"><span class="linenos">427</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_init_write</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</span><span id="EncryptFile.__init__-428"><a href="#EncryptFile.__init__-428"><span class="linenos">428</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">crypt</span> <span class="o">=</span> <span class="n">cryptor_cls</span><span class="p">(</span><span class="n">chunk_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">chunk_size</span><span class="p">,</span> <span class="o">**</span><span class="n">cryptor_args</span><span class="p">)</span>
</span><span id="EncryptFile.__init__-429"><a href="#EncryptFile.__init__-429"><span class="linenos">429</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_buffer_size</span> <span class="o">=</span> <span class="n">write_buffer_size</span>
</span><span id="EncryptFile.__init__-430"><a href="#EncryptFile.__init__-430"><span class="linenos">430</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BufferedWriter</span><span class="p">(</span><span class="n">_WriteBufferStream</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span>
</span><span id="EncryptFile.__init__-431"><a href="#EncryptFile.__init__-431"><span class="linenos">431</span></a>                                             <span class="n">buffer_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_buffer_size</span><span class="p">)</span>
</span><span id="EncryptFile.__init__-432"><a href="#EncryptFile.__init__-432"><span class="linenos">432</span></a>
</span><span id="EncryptFile.__init__-433"><a href="#EncryptFile.__init__-433"><span class="linenos">433</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="EncryptFile.__init__-434"><a href="#EncryptFile.__init__-434"><span class="linenos">434</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid mode: </span><span class="si">{!r}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mode</span><span class="p">))</span>
</span><span id="EncryptFile.__init__-435"><a href="#EncryptFile.__init__-435"><span class="linenos">435</span></a>
</span><span id="EncryptFile.__init__-436"><a href="#EncryptFile.__init__-436"><span class="linenos">436</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fileobj</span> <span class="o">=</span> <span class="n">fileobj</span>
</span><span id="EncryptFile.__init__-437"><a href="#EncryptFile.__init__-437"><span class="linenos">437</span></a>        <span class="c1"># ~ log.debug(&quot;Init CofferFile&quot;)</span>
</span><span id="EncryptFile.__init__-438"><a href="#EncryptFile.__init__-438"><span class="linenos">438</span></a>
</span><span id="EncryptFile.__init__-439"><a href="#EncryptFile.__init__-439"><span class="linenos">439</span></a>    <span class="c1"># ~ @property</span>
</span><span id="EncryptFile.__init__-440"><a href="#EncryptFile.__init__-440"><span class="linenos">440</span></a>    <span class="c1"># ~ def mtime(self):</span>
</span><span id="EncryptFile.__init__-441"><a href="#EncryptFile.__init__-441"><span class="linenos">441</span></a>        <span class="c1"># ~ &quot;&quot;&quot;Last modification time read from stream, or None&quot;&quot;&quot;</span>
</span><span id="EncryptFile.__init__-442"><a href="#EncryptFile.__init__-442"><span class="linenos">442</span></a>        <span class="c1"># ~ return self._buffer.raw._last_mtime</span>
</span></pre></div>


            <div class="docstring"><p>Constructor for the CofferFile class.</p>

<p>At least one of fileobj and filename must be given a
non-trivial value.</p>

<p>The new class instance is based on fileobj, which can be a regular
file, an io.BytesIO object, or any other object which simulates a file.
It defaults to None, in which case filename is opened to provide
a file object.</p>

<p>When fileobj is not None, the filename argument is only used to be
included in the gzip file header, which may include the original
filename of the uncompressed file.  It defaults to the filename of
fileobj, if discernible; otherwise, it defaults to the empty string,
and in this case the original filename is not included in the header.</p>

<p>The mode argument can be any of 'r', 'rb', 'a', 'ab', 'w', 'wb', 'x', or
'xb' depending on whether the file will be read or written.  The default
is the mode of fileobj if discernible; otherwise, the default is 'rb'.
A mode of 'r' is equivalent to one of 'rb', and similarly for 'w' and
'wb', 'a' and 'ab', and 'x' and 'xb'.</p>

<p>The fernet_key argument is the Coffer key used to crypt/decrypt data.</p>

<p>Encryption is done by chunks to reduce memory footprint. The default
chunk_size is 64KB.</p>
</div>


                            </div>
                            <div id="EncryptFile.myfileobj" class="classattr">
                                <div class="attr variable">
            <span class="name">myfileobj</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#EncryptFile.myfileobj"></a>
    
            <div class="docstring"><p>Overridden with internal file object to be closed, if only a filename
is passed in</p>
</div>


                            </div>
                            <div id="EncryptFile.chunk_size" class="classattr">
                                <div class="attr variable">
            <span class="name">chunk_size</span>

        
    </div>
    <a class="headerlink" href="#EncryptFile.chunk_size"></a>
    
    

                            </div>
                            <div id="EncryptFile.fileobj" class="classattr">
                                <div class="attr variable">
            <span class="name">fileobj</span>

        
    </div>
    <a class="headerlink" href="#EncryptFile.fileobj"></a>
    
    

                            </div>
                            <div id="EncryptFile.cryptor_factory" class="classattr">
                                        <input id="EncryptFile.cryptor_factory-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-classmethod">@classmethod</div>

        <span class="def">def</span>
        <span class="name">cryptor_factory</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">name</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="EncryptFile.cryptor_factory-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EncryptFile.cryptor_factory"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EncryptFile.cryptor_factory-448"><a href="#EncryptFile.cryptor_factory-448"><span class="linenos">448</span></a>    <span class="nd">@classmethod</span>
</span><span id="EncryptFile.cryptor_factory-449"><a href="#EncryptFile.cryptor_factory-449"><span class="linenos">449</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">cryptor_factory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="EncryptFile.cryptor_factory-450"><a href="#EncryptFile.cryptor_factory-450"><span class="linenos">450</span></a>        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="EncryptFile.cryptor_factory-451"><a href="#EncryptFile.cryptor_factory-451"><span class="linenos">451</span></a>            <span class="k">return</span> <span class="n">entry_points</span><span class="p">(</span><span class="n">group</span><span class="o">=</span><span class="s1">&#39;cofferfile.cryptor&#39;</span><span class="p">)</span>
</span><span id="EncryptFile.cryptor_factory-452"><a href="#EncryptFile.cryptor_factory-452"><span class="linenos">452</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="EncryptFile.cryptor_factory-453"><a href="#EncryptFile.cryptor_factory-453"><span class="linenos">453</span></a>            <span class="n">crpt</span> <span class="o">=</span> <span class="n">entry_points</span><span class="p">(</span><span class="n">group</span><span class="o">=</span><span class="s1">&#39;cofferfile.cryptor&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
</span><span id="EncryptFile.cryptor_factory-454"><a href="#EncryptFile.cryptor_factory-454"><span class="linenos">454</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">crpt</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="EncryptFile.cryptor_factory-455"><a href="#EncryptFile.cryptor_factory-455"><span class="linenos">455</span></a>                <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s2">&quot;Problem loading </span><span class="si">%s</span><span class="s2"> : found </span><span class="si">%s</span><span class="s2"> matches&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">crpt</span><span class="p">)))</span>
</span><span id="EncryptFile.cryptor_factory-456"><a href="#EncryptFile.cryptor_factory-456"><span class="linenos">456</span></a>            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">crpt</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
</span></pre></div>


    

                            </div>
                            <div id="EncryptFile.tell" class="classattr">
                                        <input id="EncryptFile.tell-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">tell</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="EncryptFile.tell-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EncryptFile.tell"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EncryptFile.tell-465"><a href="#EncryptFile.tell-465"><span class="linenos">465</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">tell</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="EncryptFile.tell-466"><a href="#EncryptFile.tell-466"><span class="linenos">466</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the current file position.&quot;&quot;&quot;</span>
</span><span id="EncryptFile.tell-467"><a href="#EncryptFile.tell-467"><span class="linenos">467</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_not_closed</span><span class="p">()</span>
</span><span id="EncryptFile.tell-468"><a href="#EncryptFile.tell-468"><span class="linenos">468</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="EncryptFile.tell-469"><a href="#EncryptFile.tell-469"><span class="linenos">469</span></a>        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Return the current file position.</p>
</div>


                            </div>
                            <div id="EncryptFile.write" class="classattr">
                                        <input id="EncryptFile.write-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">write</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">data</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="EncryptFile.write-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EncryptFile.write"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EncryptFile.write-471"><a href="#EncryptFile.write-471"><span class="linenos">471</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
</span><span id="EncryptFile.write-472"><a href="#EncryptFile.write-472"><span class="linenos">472</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Write a byte string to the file.</span>
</span><span id="EncryptFile.write-473"><a href="#EncryptFile.write-473"><span class="linenos">473</span></a>
</span><span id="EncryptFile.write-474"><a href="#EncryptFile.write-474"><span class="linenos">474</span></a><span class="sd">        Returns the number of uncompressed bytes written, which is</span>
</span><span id="EncryptFile.write-475"><a href="#EncryptFile.write-475"><span class="linenos">475</span></a><span class="sd">        always the length of data in bytes. Note that due to buffering,</span>
</span><span id="EncryptFile.write-476"><a href="#EncryptFile.write-476"><span class="linenos">476</span></a><span class="sd">        the file on disk may not reflect the data written until close()</span>
</span><span id="EncryptFile.write-477"><a href="#EncryptFile.write-477"><span class="linenos">477</span></a><span class="sd">        is called.</span>
</span><span id="EncryptFile.write-478"><a href="#EncryptFile.write-478"><span class="linenos">478</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EncryptFile.write-479"><a href="#EncryptFile.write-479"><span class="linenos">479</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_can_write</span><span class="p">()</span>
</span><span id="EncryptFile.write-480"><a href="#EncryptFile.write-480"><span class="linenos">480</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Write a byte string to the file.</p>

<p>Returns the number of uncompressed bytes written, which is
always the length of data in bytes. Note that due to buffering,
the file on disk may not reflect the data written until close()
is called.</p>
</div>


                            </div>
                            <div id="EncryptFile.read" class="classattr">
                                        <input id="EncryptFile.read-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">read</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">size</span><span class="o">=-</span><span class="mi">1</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="EncryptFile.read-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EncryptFile.read"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EncryptFile.read-500"><a href="#EncryptFile.read-500"><span class="linenos">500</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
</span><span id="EncryptFile.read-501"><a href="#EncryptFile.read-501"><span class="linenos">501</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Read up to size uncompressed bytes from the file.</span>
</span><span id="EncryptFile.read-502"><a href="#EncryptFile.read-502"><span class="linenos">502</span></a>
</span><span id="EncryptFile.read-503"><a href="#EncryptFile.read-503"><span class="linenos">503</span></a><span class="sd">        If size is negative or omitted, read until EOF is reached.</span>
</span><span id="EncryptFile.read-504"><a href="#EncryptFile.read-504"><span class="linenos">504</span></a><span class="sd">        Returns b&#39;&#39; if the file is already at EOF.</span>
</span><span id="EncryptFile.read-505"><a href="#EncryptFile.read-505"><span class="linenos">505</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EncryptFile.read-506"><a href="#EncryptFile.read-506"><span class="linenos">506</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_can_read</span><span class="p">()</span>
</span><span id="EncryptFile.read-507"><a href="#EncryptFile.read-507"><span class="linenos">507</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Read up to size uncompressed bytes from the file.</p>

<p>If size is negative or omitted, read until EOF is reached.
Returns b'' if the file is already at EOF.</p>
</div>


                            </div>
                            <div id="EncryptFile.read1" class="classattr">
                                        <input id="EncryptFile.read1-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">read1</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">size</span><span class="o">=-</span><span class="mi">1</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="EncryptFile.read1-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EncryptFile.read1"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EncryptFile.read1-509"><a href="#EncryptFile.read1-509"><span class="linenos">509</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">read1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
</span><span id="EncryptFile.read1-510"><a href="#EncryptFile.read1-510"><span class="linenos">510</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Read up to size uncompressed bytes, while trying to avoid</span>
</span><span id="EncryptFile.read1-511"><a href="#EncryptFile.read1-511"><span class="linenos">511</span></a><span class="sd">        making multiple reads from the underlying stream. Reads up to a</span>
</span><span id="EncryptFile.read1-512"><a href="#EncryptFile.read1-512"><span class="linenos">512</span></a><span class="sd">        buffer&#39;s worth of data if size is negative.</span>
</span><span id="EncryptFile.read1-513"><a href="#EncryptFile.read1-513"><span class="linenos">513</span></a>
</span><span id="EncryptFile.read1-514"><a href="#EncryptFile.read1-514"><span class="linenos">514</span></a><span class="sd">        Returns b&#39;&#39; if the file is at EOF.</span>
</span><span id="EncryptFile.read1-515"><a href="#EncryptFile.read1-515"><span class="linenos">515</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EncryptFile.read1-516"><a href="#EncryptFile.read1-516"><span class="linenos">516</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_can_read</span><span class="p">()</span>
</span><span id="EncryptFile.read1-517"><a href="#EncryptFile.read1-517"><span class="linenos">517</span></a>        <span class="k">if</span> <span class="n">size</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="EncryptFile.read1-518"><a href="#EncryptFile.read1-518"><span class="linenos">518</span></a>            <span class="n">size</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">DEFAULT_BUFFER_SIZE</span>
</span><span id="EncryptFile.read1-519"><a href="#EncryptFile.read1-519"><span class="linenos">519</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">read1</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Read up to size uncompressed bytes, while trying to avoid
making multiple reads from the underlying stream. Reads up to a
buffer's worth of data if size is negative.</p>

<p>Returns b'' if the file is at EOF.</p>
</div>


                            </div>
                            <div id="EncryptFile.peek" class="classattr">
                                        <input id="EncryptFile.peek-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">peek</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">n</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="EncryptFile.peek-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EncryptFile.peek"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EncryptFile.peek-521"><a href="#EncryptFile.peek-521"><span class="linenos">521</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">peek</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
</span><span id="EncryptFile.peek-522"><a href="#EncryptFile.peek-522"><span class="linenos">522</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return buffered data without advancing the file position.</span>
</span><span id="EncryptFile.peek-523"><a href="#EncryptFile.peek-523"><span class="linenos">523</span></a>
</span><span id="EncryptFile.peek-524"><a href="#EncryptFile.peek-524"><span class="linenos">524</span></a><span class="sd">        Always returns at least one byte of data, unless at EOF.</span>
</span><span id="EncryptFile.peek-525"><a href="#EncryptFile.peek-525"><span class="linenos">525</span></a><span class="sd">        The exact number of bytes returned is unspecified.</span>
</span><span id="EncryptFile.peek-526"><a href="#EncryptFile.peek-526"><span class="linenos">526</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EncryptFile.peek-527"><a href="#EncryptFile.peek-527"><span class="linenos">527</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_can_read</span><span class="p">()</span>
</span><span id="EncryptFile.peek-528"><a href="#EncryptFile.peek-528"><span class="linenos">528</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">peek</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Return buffered data without advancing the file position.</p>

<p>Always returns at least one byte of data, unless at EOF.
The exact number of bytes returned is unspecified.</p>
</div>


                            </div>
                            <div id="EncryptFile.closed" class="classattr">
                                        <input id="EncryptFile.closed-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">closed</span>

                <label class="view-source-button" for="EncryptFile.closed-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EncryptFile.closed"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EncryptFile.closed-530"><a href="#EncryptFile.closed-530"><span class="linenos">530</span></a>    <span class="nd">@property</span>
</span><span id="EncryptFile.closed-531"><a href="#EncryptFile.closed-531"><span class="linenos">531</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">closed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="EncryptFile.closed-532"><a href="#EncryptFile.closed-532"><span class="linenos">532</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;True if this file is closed.&quot;&quot;&quot;</span>
</span><span id="EncryptFile.closed-533"><a href="#EncryptFile.closed-533"><span class="linenos">533</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fileobj</span> <span class="ow">is</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>True if this file is closed.</p>
</div>


                            </div>
                            <div id="EncryptFile.close" class="classattr">
                                        <input id="EncryptFile.close-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">close</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="EncryptFile.close-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EncryptFile.close"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EncryptFile.close-535"><a href="#EncryptFile.close-535"><span class="linenos">535</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="EncryptFile.close-536"><a href="#EncryptFile.close-536"><span class="linenos">536</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Flush and close the file.</span>
</span><span id="EncryptFile.close-537"><a href="#EncryptFile.close-537"><span class="linenos">537</span></a>
</span><span id="EncryptFile.close-538"><a href="#EncryptFile.close-538"><span class="linenos">538</span></a><span class="sd">        May be called more than once without error. Once the file is</span>
</span><span id="EncryptFile.close-539"><a href="#EncryptFile.close-539"><span class="linenos">539</span></a><span class="sd">        closed, any other operation on it will raise a ValueError.</span>
</span><span id="EncryptFile.close-540"><a href="#EncryptFile.close-540"><span class="linenos">540</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EncryptFile.close-541"><a href="#EncryptFile.close-541"><span class="linenos">541</span></a>        <span class="n">fileobj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fileobj</span>
</span><span id="EncryptFile.close-542"><a href="#EncryptFile.close-542"><span class="linenos">542</span></a>        <span class="k">if</span> <span class="n">fileobj</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">closed</span><span class="p">:</span>
</span><span id="EncryptFile.close-543"><a href="#EncryptFile.close-543"><span class="linenos">543</span></a>            <span class="k">return</span>
</span><span id="EncryptFile.close-544"><a href="#EncryptFile.close-544"><span class="linenos">544</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="EncryptFile.close-545"><a href="#EncryptFile.close-545"><span class="linenos">545</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="n">WRITE</span><span class="p">:</span>
</span><span id="EncryptFile.close-546"><a href="#EncryptFile.close-546"><span class="linenos">546</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="EncryptFile.close-547"><a href="#EncryptFile.close-547"><span class="linenos">547</span></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="n">READ</span><span class="p">:</span>
</span><span id="EncryptFile.close-548"><a href="#EncryptFile.close-548"><span class="linenos">548</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="EncryptFile.close-549"><a href="#EncryptFile.close-549"><span class="linenos">549</span></a>        <span class="k">finally</span><span class="p">:</span>
</span><span id="EncryptFile.close-550"><a href="#EncryptFile.close-550"><span class="linenos">550</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">fileobj</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="EncryptFile.close-551"><a href="#EncryptFile.close-551"><span class="linenos">551</span></a>            <span class="n">myfileobj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">myfileobj</span>
</span><span id="EncryptFile.close-552"><a href="#EncryptFile.close-552"><span class="linenos">552</span></a>            <span class="k">if</span> <span class="n">myfileobj</span><span class="p">:</span>
</span><span id="EncryptFile.close-553"><a href="#EncryptFile.close-553"><span class="linenos">553</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">myfileobj</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="EncryptFile.close-554"><a href="#EncryptFile.close-554"><span class="linenos">554</span></a>                <span class="n">myfileobj</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Flush and close the file.</p>

<p>May be called more than once without error. Once the file is
closed, any other operation on it will raise a ValueError.</p>
</div>


                            </div>
                            <div id="EncryptFile.flush" class="classattr">
                                        <input id="EncryptFile.flush-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">flush</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="EncryptFile.flush-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EncryptFile.flush"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EncryptFile.flush-556"><a href="#EncryptFile.flush-556"><span class="linenos">556</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">flush</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="EncryptFile.flush-557"><a href="#EncryptFile.flush-557"><span class="linenos">557</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Flush buffers to disk.&quot;&quot;&quot;</span>
</span><span id="EncryptFile.flush-558"><a href="#EncryptFile.flush-558"><span class="linenos">558</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_not_closed</span><span class="p">()</span>
</span><span id="EncryptFile.flush-559"><a href="#EncryptFile.flush-559"><span class="linenos">559</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="n">WRITE</span><span class="p">:</span>
</span><span id="EncryptFile.flush-560"><a href="#EncryptFile.flush-560"><span class="linenos">560</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="EncryptFile.flush-561"><a href="#EncryptFile.flush-561"><span class="linenos">561</span></a>            <span class="c1"># Ensure the compressor&#39;s buffer is flushed</span>
</span><span id="EncryptFile.flush-562"><a href="#EncryptFile.flush-562"><span class="linenos">562</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">fileobj</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">crypt</span><span class="o">.</span><span class="n">flush</span><span class="p">())</span>
</span><span id="EncryptFile.flush-563"><a href="#EncryptFile.flush-563"><span class="linenos">563</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">fileobj</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Flush buffers to disk.</p>
</div>


                            </div>
                            <div id="EncryptFile.fileno" class="classattr">
                                        <input id="EncryptFile.fileno-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">fileno</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="EncryptFile.fileno-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EncryptFile.fileno"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EncryptFile.fileno-565"><a href="#EncryptFile.fileno-565"><span class="linenos">565</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">fileno</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="EncryptFile.fileno-566"><a href="#EncryptFile.fileno-566"><span class="linenos">566</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Invoke the underlying file object&#39;s fileno() method.</span>
</span><span id="EncryptFile.fileno-567"><a href="#EncryptFile.fileno-567"><span class="linenos">567</span></a>
</span><span id="EncryptFile.fileno-568"><a href="#EncryptFile.fileno-568"><span class="linenos">568</span></a><span class="sd">        This will raise AttributeError if the underlying file object</span>
</span><span id="EncryptFile.fileno-569"><a href="#EncryptFile.fileno-569"><span class="linenos">569</span></a><span class="sd">        doesn&#39;t support fileno().</span>
</span><span id="EncryptFile.fileno-570"><a href="#EncryptFile.fileno-570"><span class="linenos">570</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EncryptFile.fileno-571"><a href="#EncryptFile.fileno-571"><span class="linenos">571</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_not_closed</span><span class="p">()</span>
</span><span id="EncryptFile.fileno-572"><a href="#EncryptFile.fileno-572"><span class="linenos">572</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fileobj</span><span class="o">.</span><span class="n">fileno</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Invoke the underlying file object's fileno() method.</p>

<p>This will raise AttributeError if the underlying file object
doesn't support fileno().</p>
</div>


                            </div>
                            <div id="EncryptFile.rewind" class="classattr">
                                        <input id="EncryptFile.rewind-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">rewind</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="EncryptFile.rewind-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EncryptFile.rewind"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EncryptFile.rewind-574"><a href="#EncryptFile.rewind-574"><span class="linenos">574</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">rewind</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="EncryptFile.rewind-575"><a href="#EncryptFile.rewind-575"><span class="linenos">575</span></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;Return the uncompressed stream file position indicator to the</span>
</span><span id="EncryptFile.rewind-576"><a href="#EncryptFile.rewind-576"><span class="linenos">576</span></a><span class="sd">        beginning of the file</span>
</span><span id="EncryptFile.rewind-577"><a href="#EncryptFile.rewind-577"><span class="linenos">577</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="EncryptFile.rewind-578"><a href="#EncryptFile.rewind-578"><span class="linenos">578</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">!=</span> <span class="n">READ</span><span class="p">:</span>
</span><span id="EncryptFile.rewind-579"><a href="#EncryptFile.rewind-579"><span class="linenos">579</span></a>            <span class="k">raise</span> <span class="n">io</span><span class="o">.</span><span class="n">UnsupportedOperation</span><span class="p">(</span><span class="s2">&quot;Can&#39;t rewind in write mode&quot;</span><span class="p">)</span>
</span><span id="EncryptFile.rewind-580"><a href="#EncryptFile.rewind-580"><span class="linenos">580</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Return the uncompressed stream file position indicator to the
beginning of the file</p>
</div>


                            </div>
                            <div id="EncryptFile.readable" class="classattr">
                                        <input id="EncryptFile.readable-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">readable</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="EncryptFile.readable-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EncryptFile.readable"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EncryptFile.readable-582"><a href="#EncryptFile.readable-582"><span class="linenos">582</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">readable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="EncryptFile.readable-583"><a href="#EncryptFile.readable-583"><span class="linenos">583</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return whether the file was opened for reading.&quot;&quot;&quot;</span>
</span><span id="EncryptFile.readable-584"><a href="#EncryptFile.readable-584"><span class="linenos">584</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_not_closed</span><span class="p">()</span>
</span><span id="EncryptFile.readable-585"><a href="#EncryptFile.readable-585"><span class="linenos">585</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="n">READ</span>
</span></pre></div>


            <div class="docstring"><p>Return whether the file was opened for reading.</p>
</div>


                            </div>
                            <div id="EncryptFile.writable" class="classattr">
                                        <input id="EncryptFile.writable-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">writable</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="EncryptFile.writable-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EncryptFile.writable"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EncryptFile.writable-587"><a href="#EncryptFile.writable-587"><span class="linenos">587</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">writable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="EncryptFile.writable-588"><a href="#EncryptFile.writable-588"><span class="linenos">588</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return whether the file was opened for writing.&quot;&quot;&quot;</span>
</span><span id="EncryptFile.writable-589"><a href="#EncryptFile.writable-589"><span class="linenos">589</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_not_closed</span><span class="p">()</span>
</span><span id="EncryptFile.writable-590"><a href="#EncryptFile.writable-590"><span class="linenos">590</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="n">WRITE</span>
</span></pre></div>


            <div class="docstring"><p>Return whether the file was opened for writing.</p>
</div>


                            </div>
                            <div id="EncryptFile.seekable" class="classattr">
                                        <input id="EncryptFile.seekable-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">seekable</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="EncryptFile.seekable-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EncryptFile.seekable"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EncryptFile.seekable-592"><a href="#EncryptFile.seekable-592"><span class="linenos">592</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">seekable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="EncryptFile.seekable-593"><a href="#EncryptFile.seekable-593"><span class="linenos">593</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return whether the file supports seeking.&quot;&quot;&quot;</span>
</span><span id="EncryptFile.seekable-594"><a href="#EncryptFile.seekable-594"><span class="linenos">594</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">readable</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">seekable</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Return whether the file supports seeking.</p>
</div>


                            </div>
                            <div id="EncryptFile.seek" class="classattr">
                                        <input id="EncryptFile.seek-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">seek</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">offset</span>, </span><span class="param"><span class="n">whence</span><span class="o">=</span><span class="mi">0</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="EncryptFile.seek-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EncryptFile.seek"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EncryptFile.seek-596"><a href="#EncryptFile.seek-596"><span class="linenos">596</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">seek</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">whence</span><span class="o">=</span><span class="n">io</span><span class="o">.</span><span class="n">SEEK_SET</span><span class="p">):</span>
</span><span id="EncryptFile.seek-597"><a href="#EncryptFile.seek-597"><span class="linenos">597</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Change the file position.</span>
</span><span id="EncryptFile.seek-598"><a href="#EncryptFile.seek-598"><span class="linenos">598</span></a>
</span><span id="EncryptFile.seek-599"><a href="#EncryptFile.seek-599"><span class="linenos">599</span></a><span class="sd">        The new position is specified by offset, relative to the</span>
</span><span id="EncryptFile.seek-600"><a href="#EncryptFile.seek-600"><span class="linenos">600</span></a><span class="sd">        position indicated by whence. Values for whence are:</span>
</span><span id="EncryptFile.seek-601"><a href="#EncryptFile.seek-601"><span class="linenos">601</span></a>
</span><span id="EncryptFile.seek-602"><a href="#EncryptFile.seek-602"><span class="linenos">602</span></a><span class="sd">            0: start of stream (default); offset must not be negative</span>
</span><span id="EncryptFile.seek-603"><a href="#EncryptFile.seek-603"><span class="linenos">603</span></a><span class="sd">            1: current stream position</span>
</span><span id="EncryptFile.seek-604"><a href="#EncryptFile.seek-604"><span class="linenos">604</span></a><span class="sd">            2: end of stream; offset must not be positive</span>
</span><span id="EncryptFile.seek-605"><a href="#EncryptFile.seek-605"><span class="linenos">605</span></a>
</span><span id="EncryptFile.seek-606"><a href="#EncryptFile.seek-606"><span class="linenos">606</span></a><span class="sd">        Returns the new file position.</span>
</span><span id="EncryptFile.seek-607"><a href="#EncryptFile.seek-607"><span class="linenos">607</span></a>
</span><span id="EncryptFile.seek-608"><a href="#EncryptFile.seek-608"><span class="linenos">608</span></a><span class="sd">        Note that seeking is emulated, so depending on the parameters,</span>
</span><span id="EncryptFile.seek-609"><a href="#EncryptFile.seek-609"><span class="linenos">609</span></a><span class="sd">        this operation may be extremely slow.</span>
</span><span id="EncryptFile.seek-610"><a href="#EncryptFile.seek-610"><span class="linenos">610</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EncryptFile.seek-611"><a href="#EncryptFile.seek-611"><span class="linenos">611</span></a>        <span class="c1"># ~ self._check_can_seek()</span>
</span><span id="EncryptFile.seek-612"><a href="#EncryptFile.seek-612"><span class="linenos">612</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="n">WRITE</span><span class="p">:</span>
</span><span id="EncryptFile.seek-613"><a href="#EncryptFile.seek-613"><span class="linenos">613</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_check_not_closed</span><span class="p">()</span>
</span><span id="EncryptFile.seek-614"><a href="#EncryptFile.seek-614"><span class="linenos">614</span></a>            <span class="c1"># Flush buffer to ensure validity of self.offset</span>
</span><span id="EncryptFile.seek-615"><a href="#EncryptFile.seek-615"><span class="linenos">615</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="EncryptFile.seek-616"><a href="#EncryptFile.seek-616"><span class="linenos">616</span></a>            <span class="k">if</span> <span class="n">whence</span> <span class="o">!=</span> <span class="n">io</span><span class="o">.</span><span class="n">SEEK_SET</span><span class="p">:</span>
</span><span id="EncryptFile.seek-617"><a href="#EncryptFile.seek-617"><span class="linenos">617</span></a>                <span class="k">if</span> <span class="n">whence</span> <span class="o">==</span> <span class="n">io</span><span class="o">.</span><span class="n">SEEK_CUR</span><span class="p">:</span>
</span><span id="EncryptFile.seek-618"><a href="#EncryptFile.seek-618"><span class="linenos">618</span></a>                    <span class="n">offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">+</span> <span class="n">offset</span>
</span><span id="EncryptFile.seek-619"><a href="#EncryptFile.seek-619"><span class="linenos">619</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="EncryptFile.seek-620"><a href="#EncryptFile.seek-620"><span class="linenos">620</span></a>                    <span class="k">raise</span> <span class="n">io</span><span class="o">.</span><span class="n">UnsupportedOperation</span><span class="p">(</span><span class="s1">&#39;Seek from end not supported&#39;</span><span class="p">)</span>
</span><span id="EncryptFile.seek-621"><a href="#EncryptFile.seek-621"><span class="linenos">621</span></a>            <span class="k">if</span> <span class="n">offset</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">:</span>
</span><span id="EncryptFile.seek-622"><a href="#EncryptFile.seek-622"><span class="linenos">622</span></a>                <span class="k">raise</span> <span class="n">io</span><span class="o">.</span><span class="n">UnsupportedOperation</span><span class="p">(</span><span class="s1">&#39;Negative seek in write mode not supported&#39;</span><span class="p">)</span>
</span><span id="EncryptFile.seek-623"><a href="#EncryptFile.seek-623"><span class="linenos">623</span></a>            <span class="n">count</span> <span class="o">=</span> <span class="n">offset</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span>
</span><span id="EncryptFile.seek-624"><a href="#EncryptFile.seek-624"><span class="linenos">624</span></a>            <span class="n">chunk</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\0</span><span class="s1">&#39;</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer_size</span>
</span><span id="EncryptFile.seek-625"><a href="#EncryptFile.seek-625"><span class="linenos">625</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">count</span> <span class="o">//</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer_size</span><span class="p">):</span>
</span><span id="EncryptFile.seek-626"><a href="#EncryptFile.seek-626"><span class="linenos">626</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
</span><span id="EncryptFile.seek-627"><a href="#EncryptFile.seek-627"><span class="linenos">627</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\0</span><span class="s1">&#39;</span> <span class="o">*</span> <span class="p">(</span><span class="n">count</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer_size</span><span class="p">))</span>
</span><span id="EncryptFile.seek-628"><a href="#EncryptFile.seek-628"><span class="linenos">628</span></a>
</span><span id="EncryptFile.seek-629"><a href="#EncryptFile.seek-629"><span class="linenos">629</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="n">READ</span><span class="p">:</span>
</span><span id="EncryptFile.seek-630"><a href="#EncryptFile.seek-630"><span class="linenos">630</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_check_not_closed</span><span class="p">()</span>
</span><span id="EncryptFile.seek-631"><a href="#EncryptFile.seek-631"><span class="linenos">631</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="n">whence</span><span class="p">)</span>
</span><span id="EncryptFile.seek-632"><a href="#EncryptFile.seek-632"><span class="linenos">632</span></a>
</span><span id="EncryptFile.seek-633"><a href="#EncryptFile.seek-633"><span class="linenos">633</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span>
</span></pre></div>


            <div class="docstring"><p>Change the file position.</p>

<p>The new position is specified by offset, relative to the
position indicated by whence. Values for whence are:</p>

<pre><code>0: start of stream (default); offset must not be negative
1: current stream position
2: end of stream; offset must not be positive
</code></pre>

<p>Returns the new file position.</p>

<p>Note that seeking is emulated, so depending on the parameters,
this operation may be extremely slow.</p>
</div>


                            </div>
                            <div id="EncryptFile.readline" class="classattr">
                                        <input id="EncryptFile.readline-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">readline</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">size</span><span class="o">=-</span><span class="mi">1</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="EncryptFile.readline-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#EncryptFile.readline"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="EncryptFile.readline-635"><a href="#EncryptFile.readline-635"><span class="linenos">635</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">readline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
</span><span id="EncryptFile.readline-636"><a href="#EncryptFile.readline-636"><span class="linenos">636</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Read a line of uncompressed bytes from the file.</span>
</span><span id="EncryptFile.readline-637"><a href="#EncryptFile.readline-637"><span class="linenos">637</span></a>
</span><span id="EncryptFile.readline-638"><a href="#EncryptFile.readline-638"><span class="linenos">638</span></a><span class="sd">        The terminating newline (if present) is retained. If size is</span>
</span><span id="EncryptFile.readline-639"><a href="#EncryptFile.readline-639"><span class="linenos">639</span></a><span class="sd">        non-negative, no more than size bytes will be read (in which</span>
</span><span id="EncryptFile.readline-640"><a href="#EncryptFile.readline-640"><span class="linenos">640</span></a><span class="sd">        case the line may be incomplete). Returns b&#39;&#39; if already at EOF.</span>
</span><span id="EncryptFile.readline-641"><a href="#EncryptFile.readline-641"><span class="linenos">641</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="EncryptFile.readline-642"><a href="#EncryptFile.readline-642"><span class="linenos">642</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_not_closed</span><span class="p">()</span>
</span><span id="EncryptFile.readline-643"><a href="#EncryptFile.readline-643"><span class="linenos">643</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_buffer</span><span class="o">.</span><span class="n">readline</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Read a line of uncompressed bytes from the file.</p>

<p>The terminating newline (if present) is retained. If size is
non-negative, no more than size bytes will be read (in which
case the line may be incomplete). Returns b'' if already at EOF.</p>
</div>


                            </div>
                </section>
                <section id="Cryptor">
                            <input id="Cryptor-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Cryptor</span>:

                <label class="view-source-button" for="Cryptor-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Cryptor"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Cryptor-223"><a href="#Cryptor-223"><span class="linenos">223</span></a><span class="k">class</span><span class="w"> </span><span class="nc">Cryptor</span><span class="p">():</span>
</span><span id="Cryptor-224"><a href="#Cryptor-224"><span class="linenos">224</span></a>
</span><span id="Cryptor-225"><a href="#Cryptor-225"><span class="linenos">225</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chunk_size</span><span class="o">=</span><span class="n">CHUNK_SIZE</span><span class="p">):</span>
</span><span id="Cryptor-226"><a href="#Cryptor-226"><span class="linenos">226</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">chunk_size</span> <span class="o">=</span> <span class="n">chunk_size</span>
</span><span id="Cryptor-227"><a href="#Cryptor-227"><span class="linenos">227</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_marks</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Cryptor-228"><a href="#Cryptor-228"><span class="linenos">228</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">eof</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Cryptor-229"><a href="#Cryptor-229"><span class="linenos">229</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">needs_input</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Cryptor-230"><a href="#Cryptor-230"><span class="linenos">230</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">unused_data</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Cryptor-231"><a href="#Cryptor-231"><span class="linenos">231</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">unsent_data</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span>
</span><span id="Cryptor-232"><a href="#Cryptor-232"><span class="linenos">232</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Cryptor-233"><a href="#Cryptor-233"><span class="linenos">233</span></a>        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Cryptor initialized&quot;</span><span class="p">)</span>
</span><span id="Cryptor-234"><a href="#Cryptor-234"><span class="linenos">234</span></a>
</span><span id="Cryptor-235"><a href="#Cryptor-235"><span class="linenos">235</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_encrypt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chunk</span><span class="p">):</span>
</span><span id="Cryptor-236"><a href="#Cryptor-236"><span class="linenos">236</span></a>        <span class="k">return</span> <span class="n">chunk</span>
</span><span id="Cryptor-237"><a href="#Cryptor-237"><span class="linenos">237</span></a>
</span><span id="Cryptor-238"><a href="#Cryptor-238"><span class="linenos">238</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">encode_meta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chunk_size</span><span class="p">):</span>
</span><span id="Cryptor-239"><a href="#Cryptor-239"><span class="linenos">239</span></a>        <span class="s2">&quot;always return 32 (META_SIZE) bytes string&quot;</span>
</span><span id="Cryptor-240"><a href="#Cryptor-240"><span class="linenos">240</span></a>        <span class="n">ret</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span>
</span><span id="Cryptor-241"><a href="#Cryptor-241"><span class="linenos">241</span></a>        <span class="n">ret</span> <span class="o">+=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&lt;I&#39;</span><span class="p">,</span> <span class="n">chunk_size</span><span class="p">)</span>
</span><span id="Cryptor-242"><a href="#Cryptor-242"><span class="linenos">242</span></a>        <span class="c1"># We add blank data for later</span>
</span><span id="Cryptor-243"><a href="#Cryptor-243"><span class="linenos">243</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">META_RESERV</span><span class="p">):</span>
</span><span id="Cryptor-244"><a href="#Cryptor-244"><span class="linenos">244</span></a>            <span class="n">ret</span> <span class="o">+=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&lt;I&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="Cryptor-245"><a href="#Cryptor-245"><span class="linenos">245</span></a>        <span class="k">return</span> <span class="n">ret</span>
</span><span id="Cryptor-246"><a href="#Cryptor-246"><span class="linenos">246</span></a>
</span><span id="Cryptor-247"><a href="#Cryptor-247"><span class="linenos">247</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">decode_meta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
</span><span id="Cryptor-248"><a href="#Cryptor-248"><span class="linenos">248</span></a>        <span class="s2">&quot;Only accept 0 or 32 (META_SIZE) bytes string&quot;</span>
</span><span id="Cryptor-249"><a href="#Cryptor-249"><span class="linenos">249</span></a>        <span class="n">meta</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:</span><span class="n">META_SIZE</span><span class="p">]</span>
</span><span id="Cryptor-250"><a href="#Cryptor-250"><span class="linenos">250</span></a>        <span class="n">size_chunk</span> <span class="o">=</span> <span class="n">meta</span><span class="p">[:</span><span class="n">META_CHUNK</span><span class="p">]</span>
</span><span id="Cryptor-251"><a href="#Cryptor-251"><span class="linenos">251</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">size_chunk</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Cryptor-252"><a href="#Cryptor-252"><span class="linenos">252</span></a>            <span class="k">return</span> <span class="mi">0</span>
</span><span id="Cryptor-253"><a href="#Cryptor-253"><span class="linenos">253</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">meta</span><span class="p">)</span> <span class="o">!=</span> <span class="n">META_SIZE</span><span class="p">:</span>
</span><span id="Cryptor-254"><a href="#Cryptor-254"><span class="linenos">254</span></a>            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;Meta informations corrupted : </span><span class="si">%s</span><span class="s2"> != </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">meta</span><span class="p">),</span> <span class="n">META_SIZE</span><span class="p">))</span>
</span><span id="Cryptor-255"><a href="#Cryptor-255"><span class="linenos">255</span></a>        <span class="n">size</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;&lt;I&#39;</span><span class="p">,</span> <span class="n">size_chunk</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Cryptor-256"><a href="#Cryptor-256"><span class="linenos">256</span></a>        <span class="k">return</span> <span class="n">size</span>
</span><span id="Cryptor-257"><a href="#Cryptor-257"><span class="linenos">257</span></a>
</span><span id="Cryptor-258"><a href="#Cryptor-258"><span class="linenos">258</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">crypt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
</span><span id="Cryptor-259"><a href="#Cryptor-259"><span class="linenos">259</span></a>        <span class="n">ret</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span>
</span><span id="Cryptor-260"><a href="#Cryptor-260"><span class="linenos">260</span></a>        <span class="n">beg</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Cryptor-261"><a href="#Cryptor-261"><span class="linenos">261</span></a>        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="Cryptor-262"><a href="#Cryptor-262"><span class="linenos">262</span></a>            <span class="n">chunk</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">beg</span><span class="p">:</span><span class="n">beg</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">chunk_size</span><span class="p">]</span>
</span><span id="Cryptor-263"><a href="#Cryptor-263"><span class="linenos">263</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Cryptor-264"><a href="#Cryptor-264"><span class="linenos">264</span></a>                <span class="k">break</span>
</span><span id="Cryptor-265"><a href="#Cryptor-265"><span class="linenos">265</span></a>            <span class="n">enc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_encrypt</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
</span><span id="Cryptor-266"><a href="#Cryptor-266"><span class="linenos">266</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_marks</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Cryptor-267"><a href="#Cryptor-267"><span class="linenos">267</span></a>            <span class="c1"># ~ log.debug(&quot;len enc %s, chunk size %s&quot; %</span>
</span><span id="Cryptor-268"><a href="#Cryptor-268"><span class="linenos">268</span></a>                <span class="c1"># ~ (len(enc), self.chunk_size))</span>
</span><span id="Cryptor-269"><a href="#Cryptor-269"><span class="linenos">269</span></a>            <span class="n">ret</span> <span class="o">+=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&lt;I&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">enc</span><span class="p">))</span>
</span><span id="Cryptor-270"><a href="#Cryptor-270"><span class="linenos">270</span></a>            <span class="c1"># ~ # We add blank data for later</span>
</span><span id="Cryptor-271"><a href="#Cryptor-271"><span class="linenos">271</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">META_RESERV</span><span class="p">):</span>
</span><span id="Cryptor-272"><a href="#Cryptor-272"><span class="linenos">272</span></a>                <span class="n">ret</span> <span class="o">+=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&lt;I&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="Cryptor-273"><a href="#Cryptor-273"><span class="linenos">273</span></a>            <span class="c1"># ~ ret += self.encode_meta(len(enc))</span>
</span><span id="Cryptor-274"><a href="#Cryptor-274"><span class="linenos">274</span></a>            <span class="n">ret</span> <span class="o">+=</span> <span class="n">enc</span>
</span><span id="Cryptor-275"><a href="#Cryptor-275"><span class="linenos">275</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">chunk_size</span><span class="p">:</span>
</span><span id="Cryptor-276"><a href="#Cryptor-276"><span class="linenos">276</span></a>                <span class="k">break</span>
</span><span id="Cryptor-277"><a href="#Cryptor-277"><span class="linenos">277</span></a>            <span class="n">beg</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chunk_size</span>
</span><span id="Cryptor-278"><a href="#Cryptor-278"><span class="linenos">278</span></a>
</span><span id="Cryptor-279"><a href="#Cryptor-279"><span class="linenos">279</span></a>        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;CofferEncryptor.compress : len ret </span><span class="si">%s</span><span class="s2">, chunk size </span><span class="si">%s</span><span class="s2">, marks </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span>
</span><span id="Cryptor-280"><a href="#Cryptor-280"><span class="linenos">280</span></a>            <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ret</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">chunk_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_marks</span><span class="p">))</span>
</span><span id="Cryptor-281"><a href="#Cryptor-281"><span class="linenos">281</span></a>        <span class="k">return</span> <span class="n">ret</span>
</span><span id="Cryptor-282"><a href="#Cryptor-282"><span class="linenos">282</span></a>
</span><span id="Cryptor-283"><a href="#Cryptor-283"><span class="linenos">283</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">flush</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Cryptor-284"><a href="#Cryptor-284"><span class="linenos">284</span></a>        <span class="k">return</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span>
</span><span id="Cryptor-285"><a href="#Cryptor-285"><span class="linenos">285</span></a>
</span><span id="Cryptor-286"><a href="#Cryptor-286"><span class="linenos">286</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_decrypt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chunk</span><span class="p">):</span>
</span><span id="Cryptor-287"><a href="#Cryptor-287"><span class="linenos">287</span></a>        <span class="k">return</span> <span class="n">chunk</span>
</span><span id="Cryptor-288"><a href="#Cryptor-288"><span class="linenos">288</span></a>
</span><span id="Cryptor-289"><a href="#Cryptor-289"><span class="linenos">289</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">decrypt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">size</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
</span><span id="Cryptor-290"><a href="#Cryptor-290"><span class="linenos">290</span></a>        <span class="n">beg</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Cryptor-291"><a href="#Cryptor-291"><span class="linenos">291</span></a>        <span class="n">ret</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span>
</span><span id="Cryptor-292"><a href="#Cryptor-292"><span class="linenos">292</span></a>        <span class="n">size_data</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Cryptor-293"><a href="#Cryptor-293"><span class="linenos">293</span></a>        <span class="c1"># ~ len_data = len(data)</span>
</span><span id="Cryptor-294"><a href="#Cryptor-294"><span class="linenos">294</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">eof</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Cryptor-295"><a href="#Cryptor-295"><span class="linenos">295</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">needs_input</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Cryptor-296"><a href="#Cryptor-296"><span class="linenos">296</span></a>        <span class="c1"># ~ log.debug(&quot;len data %s dat %s, size %s&quot; % (len(data), data[:15], size))</span>
</span><span id="Cryptor-297"><a href="#Cryptor-297"><span class="linenos">297</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">unused_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Cryptor-298"><a href="#Cryptor-298"><span class="linenos">298</span></a>            <span class="c1"># ~ log.debug(&quot;len self.unused_data %s&quot; % (len(self.unused_data)))</span>
</span><span id="Cryptor-299"><a href="#Cryptor-299"><span class="linenos">299</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unused_data</span> <span class="o">+</span> <span class="n">data</span>
</span><span id="Cryptor-300"><a href="#Cryptor-300"><span class="linenos">300</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">unused_data</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Cryptor-301"><a href="#Cryptor-301"><span class="linenos">301</span></a>        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="Cryptor-302"><a href="#Cryptor-302"><span class="linenos">302</span></a>            <span class="c1"># ~ size_data = self.decode_meta(data[beg:])</span>
</span><span id="Cryptor-303"><a href="#Cryptor-303"><span class="linenos">303</span></a>            <span class="c1"># ~ size_meta = data[beg:beg + META_SIZE]</span>
</span><span id="Cryptor-304"><a href="#Cryptor-304"><span class="linenos">304</span></a>            <span class="n">size_struct</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">beg</span><span class="p">:</span><span class="n">beg</span> <span class="o">+</span> <span class="n">META_CHUNK</span><span class="p">]</span>
</span><span id="Cryptor-305"><a href="#Cryptor-305"><span class="linenos">305</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">size_struct</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Cryptor-306"><a href="#Cryptor-306"><span class="linenos">306</span></a>            <span class="c1"># ~ if size_data == 0:</span>
</span><span id="Cryptor-307"><a href="#Cryptor-307"><span class="linenos">307</span></a>                <span class="c1"># ~ log.debug(&#39;len %s&#39;%len(size_struct))</span>
</span><span id="Cryptor-308"><a href="#Cryptor-308"><span class="linenos">308</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">needs_input</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Cryptor-309"><a href="#Cryptor-309"><span class="linenos">309</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">eof</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Cryptor-310"><a href="#Cryptor-310"><span class="linenos">310</span></a>                <span class="k">break</span>
</span><span id="Cryptor-311"><a href="#Cryptor-311"><span class="linenos">311</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">size_struct</span><span class="p">)</span> <span class="o">!=</span> <span class="n">META_CHUNK</span><span class="p">:</span>
</span><span id="Cryptor-312"><a href="#Cryptor-312"><span class="linenos">312</span></a>                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;Meta informations corrupted : </span><span class="si">%s</span><span class="s2"> != </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">size_struct</span><span class="p">),</span> <span class="n">META_CHUNK</span><span class="p">))</span>
</span><span id="Cryptor-313"><a href="#Cryptor-313"><span class="linenos">313</span></a>            <span class="n">size_data</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;&lt;I&#39;</span><span class="p">,</span> <span class="n">size_struct</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Cryptor-314"><a href="#Cryptor-314"><span class="linenos">314</span></a>            <span class="c1"># ~ size_data2 = self.decode_meta(data[beg:])</span>
</span><span id="Cryptor-315"><a href="#Cryptor-315"><span class="linenos">315</span></a>            <span class="c1"># ~ print(size_data, &#39; = &#39;, size_data2)</span>
</span><span id="Cryptor-316"><a href="#Cryptor-316"><span class="linenos">316</span></a>            <span class="n">chunk</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">beg</span> <span class="o">+</span> <span class="n">META_SIZE</span><span class="p">:</span><span class="n">beg</span> <span class="o">+</span> <span class="n">size_data</span> <span class="o">+</span> <span class="n">META_SIZE</span><span class="p">]</span>
</span><span id="Cryptor-317"><a href="#Cryptor-317"><span class="linenos">317</span></a>
</span><span id="Cryptor-318"><a href="#Cryptor-318"><span class="linenos">318</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">size_data</span><span class="p">:</span>
</span><span id="Cryptor-319"><a href="#Cryptor-319"><span class="linenos">319</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">unused_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">beg</span><span class="p">:]</span>
</span><span id="Cryptor-320"><a href="#Cryptor-320"><span class="linenos">320</span></a>                <span class="k">break</span>
</span><span id="Cryptor-321"><a href="#Cryptor-321"><span class="linenos">321</span></a>            <span class="n">ret</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_decrypt</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
</span><span id="Cryptor-322"><a href="#Cryptor-322"><span class="linenos">322</span></a>            <span class="n">beg</span> <span class="o">+=</span> <span class="n">size_data</span> <span class="o">+</span> <span class="n">META_SIZE</span>
</span><span id="Cryptor-323"><a href="#Cryptor-323"><span class="linenos">323</span></a>
</span><span id="Cryptor-324"><a href="#Cryptor-324"><span class="linenos">324</span></a>        <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unsent_data</span> <span class="o">+</span> <span class="n">ret</span>
</span><span id="Cryptor-325"><a href="#Cryptor-325"><span class="linenos">325</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eof</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Cryptor-326"><a href="#Cryptor-326"><span class="linenos">326</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">eof</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Cryptor-327"><a href="#Cryptor-327"><span class="linenos">327</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eof</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Cryptor-328"><a href="#Cryptor-328"><span class="linenos">328</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">needs_input</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Cryptor-329"><a href="#Cryptor-329"><span class="linenos">329</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="Cryptor-330"><a href="#Cryptor-330"><span class="linenos">330</span></a>        <span class="k">if</span> <span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">size</span><span class="p">:</span>
</span><span id="Cryptor-331"><a href="#Cryptor-331"><span class="linenos">331</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">unsent_data</span> <span class="o">=</span> <span class="n">ret</span><span class="p">[</span><span class="n">size</span><span class="p">:]</span>
</span><span id="Cryptor-332"><a href="#Cryptor-332"><span class="linenos">332</span></a>            <span class="n">ret</span> <span class="o">=</span> <span class="n">ret</span><span class="p">[:</span><span class="n">size</span><span class="p">]</span>
</span><span id="Cryptor-333"><a href="#Cryptor-333"><span class="linenos">333</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Cryptor-334"><a href="#Cryptor-334"><span class="linenos">334</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">unsent_data</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span>
</span><span id="Cryptor-335"><a href="#Cryptor-335"><span class="linenos">335</span></a>        <span class="k">return</span> <span class="n">ret</span>
</span></pre></div>


    

                            <div id="Cryptor.__init__" class="classattr">
                                        <input id="Cryptor.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">Cryptor</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">chunk_size</span><span class="o">=</span><span class="mi">65504</span></span>)</span>

                <label class="view-source-button" for="Cryptor.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Cryptor.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Cryptor.__init__-225"><a href="#Cryptor.__init__-225"><span class="linenos">225</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chunk_size</span><span class="o">=</span><span class="n">CHUNK_SIZE</span><span class="p">):</span>
</span><span id="Cryptor.__init__-226"><a href="#Cryptor.__init__-226"><span class="linenos">226</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">chunk_size</span> <span class="o">=</span> <span class="n">chunk_size</span>
</span><span id="Cryptor.__init__-227"><a href="#Cryptor.__init__-227"><span class="linenos">227</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_marks</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Cryptor.__init__-228"><a href="#Cryptor.__init__-228"><span class="linenos">228</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">eof</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Cryptor.__init__-229"><a href="#Cryptor.__init__-229"><span class="linenos">229</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">needs_input</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Cryptor.__init__-230"><a href="#Cryptor.__init__-230"><span class="linenos">230</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">unused_data</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Cryptor.__init__-231"><a href="#Cryptor.__init__-231"><span class="linenos">231</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">unsent_data</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span>
</span><span id="Cryptor.__init__-232"><a href="#Cryptor.__init__-232"><span class="linenos">232</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Cryptor.__init__-233"><a href="#Cryptor.__init__-233"><span class="linenos">233</span></a>        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Cryptor initialized&quot;</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Cryptor.chunk_size" class="classattr">
                                <div class="attr variable">
            <span class="name">chunk_size</span>

        
    </div>
    <a class="headerlink" href="#Cryptor.chunk_size"></a>
    
    

                            </div>
                            <div id="Cryptor.eof" class="classattr">
                                <div class="attr variable">
            <span class="name">eof</span>

        
    </div>
    <a class="headerlink" href="#Cryptor.eof"></a>
    
    

                            </div>
                            <div id="Cryptor.needs_input" class="classattr">
                                <div class="attr variable">
            <span class="name">needs_input</span>

        
    </div>
    <a class="headerlink" href="#Cryptor.needs_input"></a>
    
    

                            </div>
                            <div id="Cryptor.unused_data" class="classattr">
                                <div class="attr variable">
            <span class="name">unused_data</span>

        
    </div>
    <a class="headerlink" href="#Cryptor.unused_data"></a>
    
    

                            </div>
                            <div id="Cryptor.unsent_data" class="classattr">
                                <div class="attr variable">
            <span class="name">unsent_data</span>

        
    </div>
    <a class="headerlink" href="#Cryptor.unsent_data"></a>
    
    

                            </div>
                            <div id="Cryptor.pos" class="classattr">
                                <div class="attr variable">
            <span class="name">pos</span>

        
    </div>
    <a class="headerlink" href="#Cryptor.pos"></a>
    
    

                            </div>
                            <div id="Cryptor.encode_meta" class="classattr">
                                        <input id="Cryptor.encode_meta-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">encode_meta</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">chunk_size</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Cryptor.encode_meta-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Cryptor.encode_meta"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Cryptor.encode_meta-238"><a href="#Cryptor.encode_meta-238"><span class="linenos">238</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">encode_meta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chunk_size</span><span class="p">):</span>
</span><span id="Cryptor.encode_meta-239"><a href="#Cryptor.encode_meta-239"><span class="linenos">239</span></a>        <span class="s2">&quot;always return 32 (META_SIZE) bytes string&quot;</span>
</span><span id="Cryptor.encode_meta-240"><a href="#Cryptor.encode_meta-240"><span class="linenos">240</span></a>        <span class="n">ret</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span>
</span><span id="Cryptor.encode_meta-241"><a href="#Cryptor.encode_meta-241"><span class="linenos">241</span></a>        <span class="n">ret</span> <span class="o">+=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&lt;I&#39;</span><span class="p">,</span> <span class="n">chunk_size</span><span class="p">)</span>
</span><span id="Cryptor.encode_meta-242"><a href="#Cryptor.encode_meta-242"><span class="linenos">242</span></a>        <span class="c1"># We add blank data for later</span>
</span><span id="Cryptor.encode_meta-243"><a href="#Cryptor.encode_meta-243"><span class="linenos">243</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">META_RESERV</span><span class="p">):</span>
</span><span id="Cryptor.encode_meta-244"><a href="#Cryptor.encode_meta-244"><span class="linenos">244</span></a>            <span class="n">ret</span> <span class="o">+=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&lt;I&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="Cryptor.encode_meta-245"><a href="#Cryptor.encode_meta-245"><span class="linenos">245</span></a>        <span class="k">return</span> <span class="n">ret</span>
</span></pre></div>


            <div class="docstring"><p>always return 32 (META_SIZE) bytes string</p>
</div>


                            </div>
                            <div id="Cryptor.decode_meta" class="classattr">
                                        <input id="Cryptor.decode_meta-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">decode_meta</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">data</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Cryptor.decode_meta-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Cryptor.decode_meta"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Cryptor.decode_meta-247"><a href="#Cryptor.decode_meta-247"><span class="linenos">247</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">decode_meta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
</span><span id="Cryptor.decode_meta-248"><a href="#Cryptor.decode_meta-248"><span class="linenos">248</span></a>        <span class="s2">&quot;Only accept 0 or 32 (META_SIZE) bytes string&quot;</span>
</span><span id="Cryptor.decode_meta-249"><a href="#Cryptor.decode_meta-249"><span class="linenos">249</span></a>        <span class="n">meta</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:</span><span class="n">META_SIZE</span><span class="p">]</span>
</span><span id="Cryptor.decode_meta-250"><a href="#Cryptor.decode_meta-250"><span class="linenos">250</span></a>        <span class="n">size_chunk</span> <span class="o">=</span> <span class="n">meta</span><span class="p">[:</span><span class="n">META_CHUNK</span><span class="p">]</span>
</span><span id="Cryptor.decode_meta-251"><a href="#Cryptor.decode_meta-251"><span class="linenos">251</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">size_chunk</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Cryptor.decode_meta-252"><a href="#Cryptor.decode_meta-252"><span class="linenos">252</span></a>            <span class="k">return</span> <span class="mi">0</span>
</span><span id="Cryptor.decode_meta-253"><a href="#Cryptor.decode_meta-253"><span class="linenos">253</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">meta</span><span class="p">)</span> <span class="o">!=</span> <span class="n">META_SIZE</span><span class="p">:</span>
</span><span id="Cryptor.decode_meta-254"><a href="#Cryptor.decode_meta-254"><span class="linenos">254</span></a>            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;Meta informations corrupted : </span><span class="si">%s</span><span class="s2"> != </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">meta</span><span class="p">),</span> <span class="n">META_SIZE</span><span class="p">))</span>
</span><span id="Cryptor.decode_meta-255"><a href="#Cryptor.decode_meta-255"><span class="linenos">255</span></a>        <span class="n">size</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;&lt;I&#39;</span><span class="p">,</span> <span class="n">size_chunk</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Cryptor.decode_meta-256"><a href="#Cryptor.decode_meta-256"><span class="linenos">256</span></a>        <span class="k">return</span> <span class="n">size</span>
</span></pre></div>


            <div class="docstring"><p>Only accept 0 or 32 (META_SIZE) bytes string</p>
</div>


                            </div>
                            <div id="Cryptor.crypt" class="classattr">
                                        <input id="Cryptor.crypt-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">crypt</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">data</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Cryptor.crypt-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Cryptor.crypt"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Cryptor.crypt-258"><a href="#Cryptor.crypt-258"><span class="linenos">258</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">crypt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
</span><span id="Cryptor.crypt-259"><a href="#Cryptor.crypt-259"><span class="linenos">259</span></a>        <span class="n">ret</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span>
</span><span id="Cryptor.crypt-260"><a href="#Cryptor.crypt-260"><span class="linenos">260</span></a>        <span class="n">beg</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Cryptor.crypt-261"><a href="#Cryptor.crypt-261"><span class="linenos">261</span></a>        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="Cryptor.crypt-262"><a href="#Cryptor.crypt-262"><span class="linenos">262</span></a>            <span class="n">chunk</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">beg</span><span class="p">:</span><span class="n">beg</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">chunk_size</span><span class="p">]</span>
</span><span id="Cryptor.crypt-263"><a href="#Cryptor.crypt-263"><span class="linenos">263</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Cryptor.crypt-264"><a href="#Cryptor.crypt-264"><span class="linenos">264</span></a>                <span class="k">break</span>
</span><span id="Cryptor.crypt-265"><a href="#Cryptor.crypt-265"><span class="linenos">265</span></a>            <span class="n">enc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_encrypt</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
</span><span id="Cryptor.crypt-266"><a href="#Cryptor.crypt-266"><span class="linenos">266</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_marks</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Cryptor.crypt-267"><a href="#Cryptor.crypt-267"><span class="linenos">267</span></a>            <span class="c1"># ~ log.debug(&quot;len enc %s, chunk size %s&quot; %</span>
</span><span id="Cryptor.crypt-268"><a href="#Cryptor.crypt-268"><span class="linenos">268</span></a>                <span class="c1"># ~ (len(enc), self.chunk_size))</span>
</span><span id="Cryptor.crypt-269"><a href="#Cryptor.crypt-269"><span class="linenos">269</span></a>            <span class="n">ret</span> <span class="o">+=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&lt;I&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">enc</span><span class="p">))</span>
</span><span id="Cryptor.crypt-270"><a href="#Cryptor.crypt-270"><span class="linenos">270</span></a>            <span class="c1"># ~ # We add blank data for later</span>
</span><span id="Cryptor.crypt-271"><a href="#Cryptor.crypt-271"><span class="linenos">271</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">META_RESERV</span><span class="p">):</span>
</span><span id="Cryptor.crypt-272"><a href="#Cryptor.crypt-272"><span class="linenos">272</span></a>                <span class="n">ret</span> <span class="o">+=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">&#39;&lt;I&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="Cryptor.crypt-273"><a href="#Cryptor.crypt-273"><span class="linenos">273</span></a>            <span class="c1"># ~ ret += self.encode_meta(len(enc))</span>
</span><span id="Cryptor.crypt-274"><a href="#Cryptor.crypt-274"><span class="linenos">274</span></a>            <span class="n">ret</span> <span class="o">+=</span> <span class="n">enc</span>
</span><span id="Cryptor.crypt-275"><a href="#Cryptor.crypt-275"><span class="linenos">275</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">chunk_size</span><span class="p">:</span>
</span><span id="Cryptor.crypt-276"><a href="#Cryptor.crypt-276"><span class="linenos">276</span></a>                <span class="k">break</span>
</span><span id="Cryptor.crypt-277"><a href="#Cryptor.crypt-277"><span class="linenos">277</span></a>            <span class="n">beg</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chunk_size</span>
</span><span id="Cryptor.crypt-278"><a href="#Cryptor.crypt-278"><span class="linenos">278</span></a>
</span><span id="Cryptor.crypt-279"><a href="#Cryptor.crypt-279"><span class="linenos">279</span></a>        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;CofferEncryptor.compress : len ret </span><span class="si">%s</span><span class="s2">, chunk size </span><span class="si">%s</span><span class="s2">, marks </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span>
</span><span id="Cryptor.crypt-280"><a href="#Cryptor.crypt-280"><span class="linenos">280</span></a>            <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ret</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">chunk_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_marks</span><span class="p">))</span>
</span><span id="Cryptor.crypt-281"><a href="#Cryptor.crypt-281"><span class="linenos">281</span></a>        <span class="k">return</span> <span class="n">ret</span>
</span></pre></div>


    

                            </div>
                            <div id="Cryptor.flush" class="classattr">
                                        <input id="Cryptor.flush-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">flush</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Cryptor.flush-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Cryptor.flush"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Cryptor.flush-283"><a href="#Cryptor.flush-283"><span class="linenos">283</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">flush</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Cryptor.flush-284"><a href="#Cryptor.flush-284"><span class="linenos">284</span></a>        <span class="k">return</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span>
</span></pre></div>


    

                            </div>
                            <div id="Cryptor.decrypt" class="classattr">
                                        <input id="Cryptor.decrypt-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">decrypt</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">data</span>, </span><span class="param"><span class="n">size</span><span class="o">=-</span><span class="mi">1</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Cryptor.decrypt-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Cryptor.decrypt"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Cryptor.decrypt-289"><a href="#Cryptor.decrypt-289"><span class="linenos">289</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">decrypt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">size</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
</span><span id="Cryptor.decrypt-290"><a href="#Cryptor.decrypt-290"><span class="linenos">290</span></a>        <span class="n">beg</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Cryptor.decrypt-291"><a href="#Cryptor.decrypt-291"><span class="linenos">291</span></a>        <span class="n">ret</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span>
</span><span id="Cryptor.decrypt-292"><a href="#Cryptor.decrypt-292"><span class="linenos">292</span></a>        <span class="n">size_data</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Cryptor.decrypt-293"><a href="#Cryptor.decrypt-293"><span class="linenos">293</span></a>        <span class="c1"># ~ len_data = len(data)</span>
</span><span id="Cryptor.decrypt-294"><a href="#Cryptor.decrypt-294"><span class="linenos">294</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">eof</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Cryptor.decrypt-295"><a href="#Cryptor.decrypt-295"><span class="linenos">295</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">needs_input</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Cryptor.decrypt-296"><a href="#Cryptor.decrypt-296"><span class="linenos">296</span></a>        <span class="c1"># ~ log.debug(&quot;len data %s dat %s, size %s&quot; % (len(data), data[:15], size))</span>
</span><span id="Cryptor.decrypt-297"><a href="#Cryptor.decrypt-297"><span class="linenos">297</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">unused_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Cryptor.decrypt-298"><a href="#Cryptor.decrypt-298"><span class="linenos">298</span></a>            <span class="c1"># ~ log.debug(&quot;len self.unused_data %s&quot; % (len(self.unused_data)))</span>
</span><span id="Cryptor.decrypt-299"><a href="#Cryptor.decrypt-299"><span class="linenos">299</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unused_data</span> <span class="o">+</span> <span class="n">data</span>
</span><span id="Cryptor.decrypt-300"><a href="#Cryptor.decrypt-300"><span class="linenos">300</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">unused_data</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Cryptor.decrypt-301"><a href="#Cryptor.decrypt-301"><span class="linenos">301</span></a>        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="Cryptor.decrypt-302"><a href="#Cryptor.decrypt-302"><span class="linenos">302</span></a>            <span class="c1"># ~ size_data = self.decode_meta(data[beg:])</span>
</span><span id="Cryptor.decrypt-303"><a href="#Cryptor.decrypt-303"><span class="linenos">303</span></a>            <span class="c1"># ~ size_meta = data[beg:beg + META_SIZE]</span>
</span><span id="Cryptor.decrypt-304"><a href="#Cryptor.decrypt-304"><span class="linenos">304</span></a>            <span class="n">size_struct</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">beg</span><span class="p">:</span><span class="n">beg</span> <span class="o">+</span> <span class="n">META_CHUNK</span><span class="p">]</span>
</span><span id="Cryptor.decrypt-305"><a href="#Cryptor.decrypt-305"><span class="linenos">305</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">size_struct</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Cryptor.decrypt-306"><a href="#Cryptor.decrypt-306"><span class="linenos">306</span></a>            <span class="c1"># ~ if size_data == 0:</span>
</span><span id="Cryptor.decrypt-307"><a href="#Cryptor.decrypt-307"><span class="linenos">307</span></a>                <span class="c1"># ~ log.debug(&#39;len %s&#39;%len(size_struct))</span>
</span><span id="Cryptor.decrypt-308"><a href="#Cryptor.decrypt-308"><span class="linenos">308</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">needs_input</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Cryptor.decrypt-309"><a href="#Cryptor.decrypt-309"><span class="linenos">309</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">eof</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Cryptor.decrypt-310"><a href="#Cryptor.decrypt-310"><span class="linenos">310</span></a>                <span class="k">break</span>
</span><span id="Cryptor.decrypt-311"><a href="#Cryptor.decrypt-311"><span class="linenos">311</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">size_struct</span><span class="p">)</span> <span class="o">!=</span> <span class="n">META_CHUNK</span><span class="p">:</span>
</span><span id="Cryptor.decrypt-312"><a href="#Cryptor.decrypt-312"><span class="linenos">312</span></a>                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s2">&quot;Meta informations corrupted : </span><span class="si">%s</span><span class="s2"> != </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">size_struct</span><span class="p">),</span> <span class="n">META_CHUNK</span><span class="p">))</span>
</span><span id="Cryptor.decrypt-313"><a href="#Cryptor.decrypt-313"><span class="linenos">313</span></a>            <span class="n">size_data</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;&lt;I&#39;</span><span class="p">,</span> <span class="n">size_struct</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Cryptor.decrypt-314"><a href="#Cryptor.decrypt-314"><span class="linenos">314</span></a>            <span class="c1"># ~ size_data2 = self.decode_meta(data[beg:])</span>
</span><span id="Cryptor.decrypt-315"><a href="#Cryptor.decrypt-315"><span class="linenos">315</span></a>            <span class="c1"># ~ print(size_data, &#39; = &#39;, size_data2)</span>
</span><span id="Cryptor.decrypt-316"><a href="#Cryptor.decrypt-316"><span class="linenos">316</span></a>            <span class="n">chunk</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">beg</span> <span class="o">+</span> <span class="n">META_SIZE</span><span class="p">:</span><span class="n">beg</span> <span class="o">+</span> <span class="n">size_data</span> <span class="o">+</span> <span class="n">META_SIZE</span><span class="p">]</span>
</span><span id="Cryptor.decrypt-317"><a href="#Cryptor.decrypt-317"><span class="linenos">317</span></a>
</span><span id="Cryptor.decrypt-318"><a href="#Cryptor.decrypt-318"><span class="linenos">318</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">size_data</span><span class="p">:</span>
</span><span id="Cryptor.decrypt-319"><a href="#Cryptor.decrypt-319"><span class="linenos">319</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">unused_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">beg</span><span class="p">:]</span>
</span><span id="Cryptor.decrypt-320"><a href="#Cryptor.decrypt-320"><span class="linenos">320</span></a>                <span class="k">break</span>
</span><span id="Cryptor.decrypt-321"><a href="#Cryptor.decrypt-321"><span class="linenos">321</span></a>            <span class="n">ret</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_decrypt</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
</span><span id="Cryptor.decrypt-322"><a href="#Cryptor.decrypt-322"><span class="linenos">322</span></a>            <span class="n">beg</span> <span class="o">+=</span> <span class="n">size_data</span> <span class="o">+</span> <span class="n">META_SIZE</span>
</span><span id="Cryptor.decrypt-323"><a href="#Cryptor.decrypt-323"><span class="linenos">323</span></a>
</span><span id="Cryptor.decrypt-324"><a href="#Cryptor.decrypt-324"><span class="linenos">324</span></a>        <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unsent_data</span> <span class="o">+</span> <span class="n">ret</span>
</span><span id="Cryptor.decrypt-325"><a href="#Cryptor.decrypt-325"><span class="linenos">325</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eof</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Cryptor.decrypt-326"><a href="#Cryptor.decrypt-326"><span class="linenos">326</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">eof</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Cryptor.decrypt-327"><a href="#Cryptor.decrypt-327"><span class="linenos">327</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eof</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Cryptor.decrypt-328"><a href="#Cryptor.decrypt-328"><span class="linenos">328</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">needs_input</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Cryptor.decrypt-329"><a href="#Cryptor.decrypt-329"><span class="linenos">329</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="Cryptor.decrypt-330"><a href="#Cryptor.decrypt-330"><span class="linenos">330</span></a>        <span class="k">if</span> <span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">size</span><span class="p">:</span>
</span><span id="Cryptor.decrypt-331"><a href="#Cryptor.decrypt-331"><span class="linenos">331</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">unsent_data</span> <span class="o">=</span> <span class="n">ret</span><span class="p">[</span><span class="n">size</span><span class="p">:]</span>
</span><span id="Cryptor.decrypt-332"><a href="#Cryptor.decrypt-332"><span class="linenos">332</span></a>            <span class="n">ret</span> <span class="o">=</span> <span class="n">ret</span><span class="p">[:</span><span class="n">size</span><span class="p">]</span>
</span><span id="Cryptor.decrypt-333"><a href="#Cryptor.decrypt-333"><span class="linenos">333</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Cryptor.decrypt-334"><a href="#Cryptor.decrypt-334"><span class="linenos">334</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">unsent_data</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span>
</span><span id="Cryptor.decrypt-335"><a href="#Cryptor.decrypt-335"><span class="linenos">335</span></a>        <span class="k">return</span> <span class="n">ret</span>
</span></pre></div>


    

                            </div>
                </section>
                <section id="_open_t">
                            <input id="_open_t-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">_open_t</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">filename</span>,</span><span class="param">	<span class="n">mode</span><span class="o">=</span><span class="s1">&#39;rb&#39;</span>,</span><span class="param">	<span class="n">encoding</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">errors</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">newline</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">chunk_size</span><span class="o">=</span><span class="mi">65504</span>,</span><span class="param">	<span class="n">cryptor</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="o">**</span><span class="n">cryptor_args</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="_open_t-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#_open_t"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="_open_t-645"><a href="#_open_t-645"><span class="linenos">645</span></a><span class="k">def</span><span class="w"> </span><span class="nf">_open_t</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;rb&quot;</span><span class="p">,</span>
</span><span id="_open_t-646"><a href="#_open_t-646"><span class="linenos">646</span></a>         <span class="n">encoding</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="_open_t-647"><a href="#_open_t-647"><span class="linenos">647</span></a>         <span class="n">chunk_size</span><span class="o">=</span><span class="n">CHUNK_SIZE</span><span class="p">,</span>
</span><span id="_open_t-648"><a href="#_open_t-648"><span class="linenos">648</span></a>         <span class="n">cryptor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">cryptor_args</span><span class="p">):</span>
</span><span id="_open_t-649"><a href="#_open_t-649"><span class="linenos">649</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Open a Fernet file in binary or text mode.</span>
</span><span id="_open_t-650"><a href="#_open_t-650"><span class="linenos">650</span></a>
</span><span id="_open_t-651"><a href="#_open_t-651"><span class="linenos">651</span></a><span class="sd">    The filename argument can be an actual filename (a str or bytes object), or</span>
</span><span id="_open_t-652"><a href="#_open_t-652"><span class="linenos">652</span></a><span class="sd">    an existing file object to read from or write to.</span>
</span><span id="_open_t-653"><a href="#_open_t-653"><span class="linenos">653</span></a>
</span><span id="_open_t-654"><a href="#_open_t-654"><span class="linenos">654</span></a><span class="sd">    The mode argument can be &quot;r&quot;, &quot;rb&quot;, &quot;w&quot;, &quot;wb&quot;, &quot;x&quot;, &quot;xb&quot;, &quot;a&quot; or &quot;ab&quot; for</span>
</span><span id="_open_t-655"><a href="#_open_t-655"><span class="linenos">655</span></a><span class="sd">    binary mode, or &quot;rt&quot;, &quot;wt&quot;, &quot;xt&quot; or &quot;at&quot; for text mode. The default mode is</span>
</span><span id="_open_t-656"><a href="#_open_t-656"><span class="linenos">656</span></a><span class="sd">    &quot;rb&quot;.</span>
</span><span id="_open_t-657"><a href="#_open_t-657"><span class="linenos">657</span></a>
</span><span id="_open_t-658"><a href="#_open_t-658"><span class="linenos">658</span></a><span class="sd">    For binary mode, this function is equivalent to the FernetFile constructor:</span>
</span><span id="_open_t-659"><a href="#_open_t-659"><span class="linenos">659</span></a><span class="sd">    FernetFile(filename, mode, fernet_key). In this case, the encoding, errors</span>
</span><span id="_open_t-660"><a href="#_open_t-660"><span class="linenos">660</span></a><span class="sd">    and newline arguments must not be provided.</span>
</span><span id="_open_t-661"><a href="#_open_t-661"><span class="linenos">661</span></a>
</span><span id="_open_t-662"><a href="#_open_t-662"><span class="linenos">662</span></a><span class="sd">    For text mode, a FernetFile object is created, and wrapped in an</span>
</span><span id="_open_t-663"><a href="#_open_t-663"><span class="linenos">663</span></a><span class="sd">    io.TextIOWrapper instance with the specified encoding, error handling</span>
</span><span id="_open_t-664"><a href="#_open_t-664"><span class="linenos">664</span></a><span class="sd">    behavior, and line ending(s).</span>
</span><span id="_open_t-665"><a href="#_open_t-665"><span class="linenos">665</span></a>
</span><span id="_open_t-666"><a href="#_open_t-666"><span class="linenos">666</span></a><span class="sd">    Encryption is done by chunks to reduce memory footprint. The default</span>
</span><span id="_open_t-667"><a href="#_open_t-667"><span class="linenos">667</span></a><span class="sd">    chunk_size is 64KB.</span>
</span><span id="_open_t-668"><a href="#_open_t-668"><span class="linenos">668</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="_open_t-669"><a href="#_open_t-669"><span class="linenos">669</span></a>    <span class="k">if</span> <span class="s2">&quot;t&quot;</span> <span class="ow">in</span> <span class="n">mode</span><span class="p">:</span>
</span><span id="_open_t-670"><a href="#_open_t-670"><span class="linenos">670</span></a>        <span class="k">if</span> <span class="s2">&quot;b&quot;</span> <span class="ow">in</span> <span class="n">mode</span><span class="p">:</span>
</span><span id="_open_t-671"><a href="#_open_t-671"><span class="linenos">671</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid mode: </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">mode</span><span class="p">,))</span>
</span><span id="_open_t-672"><a href="#_open_t-672"><span class="linenos">672</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="_open_t-673"><a href="#_open_t-673"><span class="linenos">673</span></a>        <span class="k">if</span> <span class="n">encoding</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="_open_t-674"><a href="#_open_t-674"><span class="linenos">674</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Argument &#39;encoding&#39; not supported in binary mode&quot;</span><span class="p">)</span>
</span><span id="_open_t-675"><a href="#_open_t-675"><span class="linenos">675</span></a>        <span class="k">if</span> <span class="n">errors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="_open_t-676"><a href="#_open_t-676"><span class="linenos">676</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Argument &#39;errors&#39; not supported in binary mode&quot;</span><span class="p">)</span>
</span><span id="_open_t-677"><a href="#_open_t-677"><span class="linenos">677</span></a>        <span class="k">if</span> <span class="n">newline</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="_open_t-678"><a href="#_open_t-678"><span class="linenos">678</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Argument &#39;newline&#39; not supported in binary mode&quot;</span><span class="p">)</span>
</span><span id="_open_t-679"><a href="#_open_t-679"><span class="linenos">679</span></a>
</span><span id="_open_t-680"><a href="#_open_t-680"><span class="linenos">680</span></a>    <span class="n">frnt_mode</span> <span class="o">=</span> <span class="n">mode</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;t&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="_open_t-681"><a href="#_open_t-681"><span class="linenos">681</span></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">)):</span>
</span><span id="_open_t-682"><a href="#_open_t-682"><span class="linenos">682</span></a>        <span class="n">binary_file</span> <span class="o">=</span> <span class="n">EncryptFile</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">frnt_mode</span><span class="p">,</span> <span class="n">chunk_size</span><span class="o">=</span><span class="n">chunk_size</span><span class="p">,</span> <span class="n">cryptor</span><span class="o">=</span><span class="n">cryptor</span><span class="p">,</span> <span class="o">**</span><span class="n">cryptor_args</span><span class="p">)</span>
</span><span id="_open_t-683"><a href="#_open_t-683"><span class="linenos">683</span></a>    <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;read&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;write&quot;</span><span class="p">):</span>
</span><span id="_open_t-684"><a href="#_open_t-684"><span class="linenos">684</span></a>        <span class="n">binary_file</span> <span class="o">=</span> <span class="n">EncryptFile</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">frnt_mode</span><span class="p">,</span> <span class="n">fileobj</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span> <span class="n">chunk_size</span><span class="o">=</span><span class="n">chunk_size</span><span class="p">,</span> <span class="n">cryptor</span><span class="o">=</span><span class="n">cryptor</span><span class="p">,</span> <span class="o">**</span><span class="n">cryptor_args</span><span class="p">)</span>
</span><span id="_open_t-685"><a href="#_open_t-685"><span class="linenos">685</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="_open_t-686"><a href="#_open_t-686"><span class="linenos">686</span></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;filename must be a str or bytes object, or a file&quot;</span><span class="p">)</span>
</span><span id="_open_t-687"><a href="#_open_t-687"><span class="linenos">687</span></a>
</span><span id="_open_t-688"><a href="#_open_t-688"><span class="linenos">688</span></a>    <span class="k">if</span> <span class="s2">&quot;t&quot;</span> <span class="ow">in</span> <span class="n">mode</span><span class="p">:</span>
</span><span id="_open_t-689"><a href="#_open_t-689"><span class="linenos">689</span></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">io</span><span class="p">,</span> <span class="s2">&quot;text_encoding&quot;</span><span class="p">):</span>
</span><span id="_open_t-690"><a href="#_open_t-690"><span class="linenos">690</span></a>            <span class="n">text_encoding</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">text_encoding</span>
</span><span id="_open_t-691"><a href="#_open_t-691"><span class="linenos">691</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="_open_t-692"><a href="#_open_t-692"><span class="linenos">692</span></a>            <span class="c1"># For python 3.9</span>
</span><span id="_open_t-693"><a href="#_open_t-693"><span class="linenos">693</span></a>            <span class="k">def</span><span class="w"> </span><span class="nf">text_encoding</span><span class="p">(</span><span class="n">encoding</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="_open_t-694"><a href="#_open_t-694"><span class="linenos">694</span></a>                <span class="k">if</span> <span class="n">encoding</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="_open_t-695"><a href="#_open_t-695"><span class="linenos">695</span></a>                    <span class="k">return</span> <span class="n">encoding</span>
</span><span id="_open_t-696"><a href="#_open_t-696"><span class="linenos">696</span></a>                <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">utf8_mode</span><span class="p">:</span>
</span><span id="_open_t-697"><a href="#_open_t-697"><span class="linenos">697</span></a>                    <span class="k">return</span> <span class="s2">&quot;utf-8&quot;</span>
</span><span id="_open_t-698"><a href="#_open_t-698"><span class="linenos">698</span></a>                <span class="kn">import</span><span class="w"> </span><span class="nn">locale</span>
</span><span id="_open_t-699"><a href="#_open_t-699"><span class="linenos">699</span></a>                <span class="n">_</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">locale</span><span class="o">.</span><span class="n">getlocale</span><span class="p">()</span>
</span><span id="_open_t-700"><a href="#_open_t-700"><span class="linenos">700</span></a>                <span class="k">return</span> <span class="n">encoding</span>
</span><span id="_open_t-701"><a href="#_open_t-701"><span class="linenos">701</span></a>        <span class="n">encoding</span> <span class="o">=</span> <span class="n">text_encoding</span><span class="p">(</span><span class="n">encoding</span><span class="p">)</span>
</span><span id="_open_t-702"><a href="#_open_t-702"><span class="linenos">702</span></a>        <span class="k">return</span> <span class="n">io</span><span class="o">.</span><span class="n">TextIOWrapper</span><span class="p">(</span><span class="n">binary_file</span><span class="p">,</span> <span class="n">encoding</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> <span class="n">newline</span><span class="p">)</span>
</span><span id="_open_t-703"><a href="#_open_t-703"><span class="linenos">703</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="_open_t-704"><a href="#_open_t-704"><span class="linenos">704</span></a>        <span class="k">return</span> <span class="n">binary_file</span>
</span></pre></div>


            <div class="docstring"><p>Open a Fernet file in binary or text mode.</p>

<p>The filename argument can be an actual filename (a str or bytes object), or
an existing file object to read from or write to.</p>

<p>The mode argument can be "r", "rb", "w", "wb", "x", "xb", "a" or "ab" for
binary mode, or "rt", "wt", "xt" or "at" for text mode. The default mode is
"rb".</p>

<p>For binary mode, this function is equivalent to the FernetFile constructor:
FernetFile(filename, mode, fernet_key). In this case, the encoding, errors
and newline arguments must not be provided.</p>

<p>For text mode, a FernetFile object is created, and wrapped in an
io.TextIOWrapper instance with the specified encoding, error handling
behavior, and line ending(s).</p>

<p>Encryption is done by chunks to reduce memory footprint. The default
chunk_size is 64KB.</p>
</div>


                </section>
                <section id="_open_cls">
                            <input id="_open_cls-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">_open_cls</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">filename</span>,</span><span class="param">	<span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r&#39;</span>,</span><span class="param">	<span class="n">encoding</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">errors</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">newline</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">chunk_size</span><span class="o">=</span><span class="mi">65504</span>,</span><span class="param">	<span class="n">coffer_cls</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">level_or_option</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">zstd_dict</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">cryptor</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="o">**</span><span class="n">cryptor_args</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="_open_cls-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#_open_cls"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="_open_cls-706"><a href="#_open_cls-706"><span class="linenos">706</span></a><span class="k">def</span><span class="w"> </span><span class="nf">_open_cls</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span>
</span><span id="_open_cls-707"><a href="#_open_cls-707"><span class="linenos">707</span></a>         <span class="n">encoding</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="_open_cls-708"><a href="#_open_cls-708"><span class="linenos">708</span></a>         <span class="n">chunk_size</span><span class="o">=</span><span class="n">CHUNK_SIZE</span><span class="p">,</span>
</span><span id="_open_cls-709"><a href="#_open_cls-709"><span class="linenos">709</span></a>         <span class="n">coffer_cls</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="_open_cls-710"><a href="#_open_cls-710"><span class="linenos">710</span></a>         <span class="n">level_or_option</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">zstd_dict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="_open_cls-711"><a href="#_open_cls-711"><span class="linenos">711</span></a>         <span class="n">cryptor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">cryptor_args</span><span class="p">):</span>
</span><span id="_open_cls-712"><a href="#_open_cls-712"><span class="linenos">712</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Open a Coffer file in binary or text mode.</span>
</span><span id="_open_cls-713"><a href="#_open_cls-713"><span class="linenos">713</span></a>
</span><span id="_open_cls-714"><a href="#_open_cls-714"><span class="linenos">714</span></a><span class="sd">    The filename argument can be an actual filename (a str or bytes object), or</span>
</span><span id="_open_cls-715"><a href="#_open_cls-715"><span class="linenos">715</span></a><span class="sd">    an existing file object to read from or write to.</span>
</span><span id="_open_cls-716"><a href="#_open_cls-716"><span class="linenos">716</span></a>
</span><span id="_open_cls-717"><a href="#_open_cls-717"><span class="linenos">717</span></a><span class="sd">    The mode argument can be &quot;r&quot;, &quot;rb&quot;, &quot;w&quot;, &quot;wb&quot;, &quot;x&quot;, &quot;xb&quot;, &quot;a&quot; or &quot;ab&quot; for</span>
</span><span id="_open_cls-718"><a href="#_open_cls-718"><span class="linenos">718</span></a><span class="sd">    binary mode. The default mode is &quot;rb&quot;.</span>
</span><span id="_open_cls-719"><a href="#_open_cls-719"><span class="linenos">719</span></a>
</span><span id="_open_cls-720"><a href="#_open_cls-720"><span class="linenos">720</span></a><span class="sd">    For binary mode, this function is equivalent to the CofferFile constructor:</span>
</span><span id="_open_cls-721"><a href="#_open_cls-721"><span class="linenos">721</span></a><span class="sd">    CofferFile(filename, mode, cryptor=cryptor, **cryptor_args).</span>
</span><span id="_open_cls-722"><a href="#_open_cls-722"><span class="linenos">722</span></a>
</span><span id="_open_cls-723"><a href="#_open_cls-723"><span class="linenos">723</span></a><span class="sd">    Encryption is done by chunks to reduce memory footprint. The default</span>
</span><span id="_open_cls-724"><a href="#_open_cls-724"><span class="linenos">724</span></a><span class="sd">    chunk_size is 64KB.</span>
</span><span id="_open_cls-725"><a href="#_open_cls-725"><span class="linenos">725</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="_open_cls-726"><a href="#_open_cls-726"><span class="linenos">726</span></a>    <span class="k">if</span> <span class="s2">&quot;t&quot;</span> <span class="ow">in</span> <span class="n">mode</span><span class="p">:</span>
</span><span id="_open_cls-727"><a href="#_open_cls-727"><span class="linenos">727</span></a>        <span class="k">if</span> <span class="s2">&quot;b&quot;</span> <span class="ow">in</span> <span class="n">mode</span><span class="p">:</span>
</span><span id="_open_cls-728"><a href="#_open_cls-728"><span class="linenos">728</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid mode: </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">mode</span><span class="p">,))</span>
</span><span id="_open_cls-729"><a href="#_open_cls-729"><span class="linenos">729</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="_open_cls-730"><a href="#_open_cls-730"><span class="linenos">730</span></a>        <span class="k">if</span> <span class="n">encoding</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="_open_cls-731"><a href="#_open_cls-731"><span class="linenos">731</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Argument &#39;encoding&#39; not supported in binary mode&quot;</span><span class="p">)</span>
</span><span id="_open_cls-732"><a href="#_open_cls-732"><span class="linenos">732</span></a>        <span class="k">if</span> <span class="n">errors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="_open_cls-733"><a href="#_open_cls-733"><span class="linenos">733</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Argument &#39;errors&#39; not supported in binary mode&quot;</span><span class="p">)</span>
</span><span id="_open_cls-734"><a href="#_open_cls-734"><span class="linenos">734</span></a>        <span class="k">if</span> <span class="n">newline</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="_open_cls-735"><a href="#_open_cls-735"><span class="linenos">735</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Argument &#39;newline&#39; not supported in binary mode&quot;</span><span class="p">)</span>
</span><span id="_open_cls-736"><a href="#_open_cls-736"><span class="linenos">736</span></a>
</span><span id="_open_cls-737"><a href="#_open_cls-737"><span class="linenos">737</span></a>    <span class="n">frnt_mode</span> <span class="o">=</span> <span class="n">mode</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;t&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="_open_cls-738"><a href="#_open_cls-738"><span class="linenos">738</span></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">)):</span>
</span><span id="_open_cls-739"><a href="#_open_cls-739"><span class="linenos">739</span></a>        <span class="n">binary_file</span> <span class="o">=</span> <span class="n">coffer_cls</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">frnt_mode</span><span class="p">,</span> <span class="n">fileobj</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">chunk_size</span><span class="o">=</span><span class="n">chunk_size</span><span class="p">,</span>
</span><span id="_open_cls-740"><a href="#_open_cls-740"><span class="linenos">740</span></a>            <span class="n">level_or_option</span><span class="o">=</span><span class="n">level_or_option</span><span class="p">,</span> <span class="n">zstd_dict</span><span class="o">=</span><span class="n">zstd_dict</span><span class="p">,</span>
</span><span id="_open_cls-741"><a href="#_open_cls-741"><span class="linenos">741</span></a>            <span class="n">cryptor</span><span class="o">=</span><span class="n">cryptor</span><span class="p">,</span> <span class="o">**</span><span class="n">cryptor_args</span><span class="p">)</span>
</span><span id="_open_cls-742"><a href="#_open_cls-742"><span class="linenos">742</span></a>    <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;read&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;write&quot;</span><span class="p">):</span>
</span><span id="_open_cls-743"><a href="#_open_cls-743"><span class="linenos">743</span></a>        <span class="n">binary_file</span> <span class="o">=</span> <span class="n">coffer_cls</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">frnt_mode</span><span class="p">,</span> <span class="n">fileobj</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span> <span class="n">chunk_size</span><span class="o">=</span><span class="n">chunk_size</span><span class="p">,</span>
</span><span id="_open_cls-744"><a href="#_open_cls-744"><span class="linenos">744</span></a>            <span class="n">level_or_option</span><span class="o">=</span><span class="n">level_or_option</span><span class="p">,</span> <span class="n">zstd_dict</span><span class="o">=</span><span class="n">zstd_dict</span><span class="p">,</span>
</span><span id="_open_cls-745"><a href="#_open_cls-745"><span class="linenos">745</span></a>            <span class="n">cryptor</span><span class="o">=</span><span class="n">cryptor</span><span class="p">,</span> <span class="o">**</span><span class="n">cryptor_args</span><span class="p">)</span>
</span><span id="_open_cls-746"><a href="#_open_cls-746"><span class="linenos">746</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="_open_cls-747"><a href="#_open_cls-747"><span class="linenos">747</span></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;filename must be a str or bytes object, or a file&quot;</span><span class="p">)</span>
</span><span id="_open_cls-748"><a href="#_open_cls-748"><span class="linenos">748</span></a>
</span><span id="_open_cls-749"><a href="#_open_cls-749"><span class="linenos">749</span></a>    <span class="k">if</span> <span class="s2">&quot;t&quot;</span> <span class="ow">in</span> <span class="n">mode</span><span class="p">:</span>
</span><span id="_open_cls-750"><a href="#_open_cls-750"><span class="linenos">750</span></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">io</span><span class="p">,</span> <span class="s2">&quot;text_encoding&quot;</span><span class="p">):</span>
</span><span id="_open_cls-751"><a href="#_open_cls-751"><span class="linenos">751</span></a>            <span class="n">text_encoding</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">text_encoding</span>
</span><span id="_open_cls-752"><a href="#_open_cls-752"><span class="linenos">752</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="_open_cls-753"><a href="#_open_cls-753"><span class="linenos">753</span></a>            <span class="c1"># For python 3.9</span>
</span><span id="_open_cls-754"><a href="#_open_cls-754"><span class="linenos">754</span></a>            <span class="k">def</span><span class="w"> </span><span class="nf">text_encoding</span><span class="p">(</span><span class="n">encoding</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="_open_cls-755"><a href="#_open_cls-755"><span class="linenos">755</span></a>                <span class="k">if</span> <span class="n">encoding</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="_open_cls-756"><a href="#_open_cls-756"><span class="linenos">756</span></a>                    <span class="k">return</span> <span class="n">encoding</span>
</span><span id="_open_cls-757"><a href="#_open_cls-757"><span class="linenos">757</span></a>                <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">utf8_mode</span><span class="p">:</span>
</span><span id="_open_cls-758"><a href="#_open_cls-758"><span class="linenos">758</span></a>                    <span class="k">return</span> <span class="s2">&quot;utf-8&quot;</span>
</span><span id="_open_cls-759"><a href="#_open_cls-759"><span class="linenos">759</span></a>                <span class="kn">import</span><span class="w"> </span><span class="nn">locale</span>
</span><span id="_open_cls-760"><a href="#_open_cls-760"><span class="linenos">760</span></a>                <span class="n">_</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">locale</span><span class="o">.</span><span class="n">getlocale</span><span class="p">()</span>
</span><span id="_open_cls-761"><a href="#_open_cls-761"><span class="linenos">761</span></a>                <span class="k">return</span> <span class="n">encoding</span>
</span><span id="_open_cls-762"><a href="#_open_cls-762"><span class="linenos">762</span></a>        <span class="n">encoding</span> <span class="o">=</span> <span class="n">text_encoding</span><span class="p">(</span><span class="n">encoding</span><span class="p">)</span>
</span><span id="_open_cls-763"><a href="#_open_cls-763"><span class="linenos">763</span></a>        <span class="k">return</span> <span class="n">io</span><span class="o">.</span><span class="n">TextIOWrapper</span><span class="p">(</span><span class="n">binary_file</span><span class="p">,</span> <span class="n">encoding</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> <span class="n">newline</span><span class="p">)</span>
</span><span id="_open_cls-764"><a href="#_open_cls-764"><span class="linenos">764</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="_open_cls-765"><a href="#_open_cls-765"><span class="linenos">765</span></a>        <span class="k">return</span> <span class="n">binary_file</span>
</span></pre></div>


            <div class="docstring"><p>Open a Coffer file in binary or text mode.</p>

<p>The filename argument can be an actual filename (a str or bytes object), or
an existing file object to read from or write to.</p>

<p>The mode argument can be "r", "rb", "w", "wb", "x", "xb", "a" or "ab" for
binary mode. The default mode is "rb".</p>

<p>For binary mode, this function is equivalent to the CofferFile constructor:
CofferFile(filename, mode, cryptor=cryptor, **cryptor_args).</p>

<p>Encryption is done by chunks to reduce memory footprint. The default
chunk_size is 64KB.</p>
</div>


                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>